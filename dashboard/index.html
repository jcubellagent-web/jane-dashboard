<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Jane Dashboard v2</title>
    <link rel="icon" href="icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg: #000000;
            --bg-secondary: #0a0a0a;
            --card: rgba(20, 20, 20, 0.8);
            --card-hover: rgba(30, 30, 30, 0.9);
            --accent: #4ade80;
            --accent-dim: rgba(74, 222, 128, 0.2);
            --accent-blue: #4ade80;
            --accent-purple: #4ade80;
            --text: #f1f5f9;
            --text-dim: #64748b;
            --text-muted: #475569;
            --green: #4ade80;
            --amber: #4ade80;
            --red: #ef4444;
            --border: rgba(74, 222, 128, 0.15);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header - Optimized for 24" */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2.5rem;
            border-bottom: 1px solid rgba(74, 222, 128, 0.2);
            position: sticky;
            top: 0;
            /* Futuristic gradient background */
            background: 
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(74, 222, 128, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 60%, rgba(74, 222, 128, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse 40% 30% at 50% 80%, rgba(74, 222, 128, 0.03) 0%, transparent 50%),
                linear-gradient(180deg, rgba(15, 20, 25, 0.98) 0%, rgba(10, 15, 20, 0.99) 100%);
            backdrop-filter: blur(20px);
            box-shadow: 
                inset 0 -1px 0 rgba(74, 222, 128, 0.1),
                0 4px 20px rgba(0, 0, 0, 0.4);
            z-index: 100;
            height: 80px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* Horizontal scan lines */
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(74, 222, 128, 0.02) 2px,
                    rgba(74, 222, 128, 0.02) 4px
                ),
                /* Circuit traces */
                linear-gradient(90deg, transparent 49.5%, rgba(74, 222, 128, 0.05) 49.5%, rgba(74, 222, 128, 0.05) 50.5%, transparent 50.5%),
                linear-gradient(0deg, transparent 49.5%, rgba(74, 222, 128, 0.03) 49.5%, rgba(74, 222, 128, 0.03) 50.5%, transparent 50.5%);
            background-size: 100% 100%, 120px 100%, 100% 80px;
            pointer-events: none;
            opacity: 0.6;
        }
        
        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(74, 222, 128, 0.08) 20%,
                rgba(74, 222, 128, 0.2) 50%,
                rgba(74, 222, 128, 0.08) 80%,
                transparent 100%
            );
            filter: blur(12px);
            animation: headerSweep 6s ease-in-out infinite alternate;
            pointer-events: none;
        }
        
        /* Keep header content on top */
        .header-left, .header-center, .header-right {
            position: relative;
            z-index: 2;
        }
        
        @keyframes headerSweep {
            0% { transform: translateX(-20%); }
            100% { transform: translateX(180%); }
        }
        
        .header-left {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 1rem;
        }
        
        .header-left-text {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }
        
        .night-mode-btn {
            width: 50px;
            height: 50px;
            padding: 0;
            font-size: 0.5rem;
            font-family: 'SF Mono', 'Fira Code', monospace;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent);
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, rgba(74, 222, 128, 0.05) 100%);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 8px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
        }
        
        .night-mode-btn:hover {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.2) 0%, rgba(74, 222, 128, 0.1) 100%);
            border-color: rgba(74, 222, 128, 0.5);
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.2);
        }
        
        /* Night Mode Overlay - E-ink style */
        .night-mode-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000000;
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .night-mode-overlay.active {
            display: flex;
        }
        
        .night-mode-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
        }
        
        .eink-time {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 22rem;
            font-weight: 600;
            color: #2a6e4a;
            letter-spacing: -0.02em;
            line-height: 1;
        }
        
        .eink-ampm {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 3rem;
            font-weight: 600;
            color: #1e5438;
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
        }
        
        .eink-date {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 2.2rem;
            font-weight: 600;
            color: #3a5a4a;
            letter-spacing: 0.05em;
            margin-top: 1.5rem;
            text-transform: uppercase;
        }
        
        .eink-hint {
            position: absolute;
            bottom: 2rem;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.7rem;
            color: #222;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* DVD-style bouncing logo */
        .bouncing-logo {
            position: absolute;
            width: 120px;
            height: 120px;
            opacity: 0.6;
            transition: opacity 0.3s;
        }
        
        .bouncing-logo img {
            width: 100%;
            height: 100%;
            border-radius: 16px;
        }
        
        .bouncing-logo:hover {
            opacity: 0.85;
        }
        
        .logo {
            width: 44px;
            height: 44px;
            border-radius: 10px;
        }
        
        .brand-text {
            display: flex;
            flex-direction: column;
        }
        
        .brand-name {
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .brand-tagline {
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        .header-center {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .hello-greeting {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .header-time {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--accent);
            font-variant-numeric: tabular-nums;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .header-date {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }
        
        /* Icon SVGs for category labels */
        .cat-icon {
            width: 14px;
            height: 14px;
            fill: var(--accent);
            vertical-align: middle;
            margin-right: 4px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--accent-dim);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }
        
        /* Main Layout - Optimized for 24" monitor */
        .main-container {
            display: grid;
            grid-template-columns: 1.2fr 1fr 1fr;
            grid-auto-rows: min-content;
            gap: 1.25rem;
            padding: 1.5rem 2.5rem;
            max-width: 100%;
            margin: 0 auto;
            align-items: stretch;
            height: calc(100vh - 80px);
        }
        
        /* First row alignment */
        .left-column, .center-column, .card:first-of-type {
            align-self: stretch;
        }
        
        /* Cards - Floating effect with green border */
        .card {
            background: var(--card);
            border: 1px solid rgba(74, 222, 128, 0.25);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.2s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 8px rgba(74, 222, 128, 0.08);
        }
        
        .card:hover {
            background: var(--card-hover);
            border-color: rgba(74, 222, 128, 0.4);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6), 0 0 15px rgba(74, 222, 128, 0.15);
        }
        
        /* Last refresh timestamp */
        .last-refresh {
            font-size: 0.6rem;
            color: var(--text-dim);
            opacity: 0.7;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .card-icon {
            font-size: 1.3rem;
        }
        
        .card-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .card-timestamp {
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        .refresh-btn {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 50%;
            transition: all 0.2s;
            font-size: 1.1rem;
            font-weight: 300;
            line-height: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .refresh-btn:hover {
            color: #fff;
            text-shadow: 0 0 10px var(--accent);
            transform: scale(1.1);
        }
        
        .refresh-btn.spinning {
            animation: spin 0.5s linear infinite;
            color: #fff;
            text-shadow: 0 0 15px var(--accent), 0 0 30px var(--accent);
            transform: scale(1.2);
        }
        
        .refresh-all-btn {
            background: none;
            border: 1px solid var(--accent);
            color: var(--accent);
            cursor: pointer;
            padding: 0.5rem 0.7rem;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 1.3rem;
            font-weight: 300;
            line-height: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.5rem;
        }
        
        .refresh-all-btn:hover {
            color: #fff;
            border-color: #fff;
            text-shadow: 0 0 10px var(--accent);
            transform: scale(1.05);
        }
        
        .refresh-all-btn.spinning {
            animation: spin 0.5s linear infinite;
            color: #fff;
            border-color: #fff;
            text-shadow: 0 0 15px var(--accent), 0 0 30px var(--accent);
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Span columns */
        .card-wide {
            grid-column: span 2;
        }
        
        .card-full {
            grid-column: span 3;
        }
        
        /* Card Compact (for status card) */
        .card-compact {
            padding: 1rem;
        }
        
        .card-compact .card-header {
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
        }
        
        .card-compact .card-title {
            font-size: 0.95rem;
            gap: 0.5rem;
        }
        
        /* Market Ticker Widget - Compact */
        .card-ticker {
            padding: 0.4rem 0.6rem !important;
            min-height: auto !important;
        }
        
        .card-ticker .card-header.ticker-header {
            display: flex;
            padding: 0.4rem 0;
            margin-bottom: 0.4rem;
            border-bottom: 1px solid var(--border);
        }
        
        .ticker-header .card-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .ticker-logo-text {
            font-size: 0.55rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.12);
            padding: 2px 5px;
            border-radius: 3px;
            min-width: 14px;
            text-align: center;
        }
        
        .market-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .market-dot.crypto-market {
            background: #4ade80;
            box-shadow: 0 0 4px #4ade80;
        }
        
        .market-dot.stock-market.open {
            background: #4ade80;
            box-shadow: 0 0 4px #4ade80;
        }
        
        .market-dot.stock-market.closed {
            background: #ef4444;
            box-shadow: 0 0 4px #ef4444;
        }
        
        .ticker-row {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            align-items: stretch;
        }
        
        .ticker-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
        
        .ticker-logo {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .ticker-info {
            display: flex;
            align-items: baseline;
            gap: 0.3rem;
            flex: 1;
            white-space: nowrap;
        }
        
        .ticker-price {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .ticker-change {
            font-size: 0.6rem;
            font-weight: 500;
        }
        
        .ticker-change.positive { color: #4ade80; }
        .ticker-change.negative { color: #ef4444; }
        .ticker-change.neutral { color: var(--text-dim); }
        
        /* Solana Meme Coins Widget */
        .card-memecoins {
            margin-bottom: 0.75rem;
        }
        
        .solana-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .card-memecoins .card-header {
            padding-bottom: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .chain-filters {
            display: inline-flex;
            gap: 0.4rem;
            margin-left: 0.5rem;
        }
        
        .chain-badge {
            font-size: 0.7rem;
            opacity: 0.8;
        }
        
        .mcap-filter {
            font-size: 0.65rem;
            color: var(--text-dim);
            background: rgba(74, 222, 128, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            border: 1px solid rgba(74, 222, 128, 0.2);
        }
        
        .memecoins-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .memecoin-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            align-items: center;
            gap: 0.6rem;
            padding: 0.5rem 0.6rem;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(74, 222, 128, 0.1);
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
        }
        
        .memecoin-item:hover {
            background: rgba(74, 222, 128, 0.1);
            border-color: rgba(74, 222, 128, 0.3);
            transform: translateX(2px);
        }
        
        .memecoin-item.loading {
            display: flex;
            justify-content: center;
            color: var(--text-dim);
            font-size: 0.85rem;
        }
        
        .memecoin-rank {
            font-size: 0.7rem;
            color: var(--text-dim);
            width: 1.5rem;
            text-align: center;
        }
        
        .memecoin-info {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
            min-width: 0;
        }
        
        .memecoin-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .memecoin-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .memecoin-icon-placeholder {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            color: white;
            font-weight: 700;
        }
        
        .memecoin-symbol {
            font-size: 0.7rem;
            color: var(--text-dim);
        }
        
        .memecoin-chain {
            font-size: 0.6rem;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .memecoin-chain.solana { color: #9945FF; }
        .memecoin-chain.base { color: #0052FF; }
        .memecoin-chain.ethereum { color: #627EEA; }
        
        .memecoin-price {
            text-align: right;
        }
        
        .memecoin-price-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .memecoin-price-change {
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .memecoin-price-change.positive { color: #4ade80; }
        .memecoin-price-change.negative { color: #ef4444; }
        
        .memecoin-volume {
            text-align: right;
            min-width: 70px;
        }
        
        .memecoin-volume-label {
            font-size: 0.6rem;
            color: var(--text-dim);
        }
        
        .memecoin-volume-value {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent);
        }
        
        .memecoin-mcap {
            text-align: right;
            min-width: 60px;
        }
        
        .memecoin-mcap-label {
            font-size: 0.6rem;
            color: var(--text-dim);
        }
        
        .memecoin-mcap-value {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .memecoin-mcap-change {
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .memecoin-mcap-change.positive { color: #4ade80; }
        .memecoin-mcap-change.negative { color: #ef4444; }
        
        .memecoin-age {
            text-align: center;
            min-width: 32px;
        }
        
        .memecoin-age-value {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-dim);
            background: rgba(74, 222, 128, 0.1);
            padding: 0.15rem 0.35rem;
            border-radius: 4px;
        }
        
        .ticker-item.ticker-sub {
            padding-left: 0.5rem;
            opacity: 0.85;
            font-size: 0.9em;
        }
        
        .ticker-sub .ticker-logo {
            width: 14px;
            height: 14px;
        }
        
        .ticker-sub .ticker-price {
            font-size: 0.7rem;
        }
        
        .ticker-sub .ticker-change {
            font-size: 0.55rem;
        }
        
        .status-ticker-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .status-ticker-row .card-status {
            flex: 1 1 auto;
            margin-bottom: 0;
        }
        
        .status-ticker-row .card-ticker {
            flex: 1 1 auto;
            width: auto;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            margin-bottom: 0;
            padding: 0.5rem 0.6rem !important;
            overflow: hidden;
        }
        
        /* Right Column Container */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            height: 100%;
        }
        
        .right-column .card-memecoins {
            flex: 0 0 auto;
            max-height: 280px;
        }
        
        .right-column .card-memecoins .memecoins-list {
            max-height: 200px;
        }
        
        /* Prediction Markets - Full height right column */
        /* X Growth Widget */
        .card-xgrowth {
            flex: 0 1 auto;
        }
        .x-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .x-stat-item {
            text-align: center;
            padding: 0.4rem;
            background: rgba(74,222,128,0.05);
            border-radius: 6px;
        }
        .x-stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #fff;
        }
        .x-stat-label {
            font-size: 0.6rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .x-roadmap {
            border-top: 1px solid rgba(74,222,128,0.1);
            padding-top: 0.5rem;
        }
        .x-roadmap-title {
            font-size: 0.65rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.4rem;
            font-weight: 600;
        }
        .x-roadmap-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
        }
        .x-roadmap-pct {
            font-weight: 700;
            color: var(--accent);
            min-width: 32px;
            font-size: 0.8rem;
        }

        .card-predictions-full {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }
        
        .market-logos {
            display: inline-flex;
            gap: 0.5rem;
            margin-left: 0.75rem;
        }
        
        .market-logo {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            filter: brightness(0) invert(1);
            opacity: 0.9;
        }
        
        .predictions-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            flex: 1;
            overflow-y: auto;
        }
        
        .prediction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .prediction-item:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--accent);
        }
        
        .prediction-main {
            display: flex;
            flex-direction: column;
            flex: 1;
            margin-right: 0.75rem;
            min-width: 0;
        }
        
        .prediction-question {
            font-size: 0.75rem;
            line-height: 1.35;
        }
        
        .prediction-source {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 0.2rem;
        }
        
        .prediction-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        
        .prediction-volume {
            font-size: 0.75rem;
            color: #ffffff;
            opacity: 0.9;
        }
        
        .prediction-source-logo {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            opacity: 0.85;
            flex-shrink: 0;
        }
        
        .prediction-source-logo.logo-invert {
            filter: brightness(0) invert(1);
        }
        
        .prediction-source-logo.logo-white {
            /* Already white, no filter needed */
        }
        
        .prediction-odds {
            display: flex;
            gap: 0.5rem;
        }
        
        .odds-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .odds-yes {
            background: rgba(34, 197, 94, 0.2);
            color: var(--green);
        }
        
        .odds-no {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }
        
        .prediction-category {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-dim);
            padding: 0.5rem 0 0.25rem 0;
            margin-top: 0.5rem;
            border-top: 1px solid var(--border);
        }
        
        .prediction-category:first-child {
            margin-top: 0;
            border-top: none;
            padding-top: 0;
        }
        
        /* Kalshi Active Bets */
        .kalshi-bets-section {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }
        .kalshi-bets-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .kalshi-bets-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .kalshi-balance {
            font-size: 0.7rem;
            color: var(--text-dim);
            font-weight: 500;
        }
        .kalshi-history-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.2rem;
            position: relative;
        }
        .kalshi-bet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0.5rem;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
            border: 1px solid rgba(74, 222, 128, 0.1);
            margin-bottom: 0.35rem;
            font-size: 0.75rem;
        }
        .kalshi-bet-name {
            flex: 1;
            margin-right: 0.5rem;
            color: var(--text);
            line-height: 1.3;
        }
        .kalshi-bet-meta {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-shrink: 0;
        }
        .kalshi-side-badge {
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
        }
        .kalshi-side-yes {
            background: rgba(34, 197, 94, 0.2);
            color: var(--green);
        }
        .kalshi-side-no {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }
        .kalshi-pnl {
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 45px;
            text-align: right;
        }
        .kalshi-pnl.positive { color: var(--green); }
        .kalshi-pnl.negative { color: var(--red); }
        .kalshi-settled-popup {
            display: none;
            position: absolute;
            right: 0;
            top: 1.5rem;
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 10px;
            padding: 0.75rem;
            min-width: 280px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 50;
            backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
        }
        .kalshi-settled-popup.visible {
            display: block;
        }
        .kalshi-settled-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 0.5rem;
            padding-bottom: 0.3rem;
            border-bottom: 1px solid var(--border);
        }
        .kalshi-no-bets {
            font-size: 0.7rem;
            color: var(--text-dim);
            text-align: center;
            padding: 0.5rem;
        }
        
        /* AI News â€” compact half-height */
        .news-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .news-column-title {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-dim);
            margin-bottom: 0.3rem;
            padding-bottom: 0.2rem;
            border-bottom: 1px solid var(--border);
        }
        
        .news-list {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        
        .news-item {
            padding: 0.3rem 0.5rem;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .news-item:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .news-headline {
            font-size: 0.65rem;
            font-weight: 500;
            margin-bottom: 0.1rem;
            line-height: 1.2;
        }
        
        .news-meta {
            font-size: 0.55rem;
            color: var(--text-dim);
        }
        
        /* TikTok Stats */
        .tiktok-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.25rem;
        }
        
        .tiktok-handle {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .tiktok-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.25rem;
        }
        
        .tiktok-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
        }
        
        .tiktok-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }
        
        .tiktok-stat-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-top: 0.25rem;
        }
        
        .tiktok-stat-delta {
            font-size: 0.7rem;
            font-weight: 600;
            margin-top: 0.15rem;
            min-height: 1em;
        }
        
        .tiktok-stat-delta.positive {
            color: var(--green);
        }
        
        .tiktok-stat-delta.negative {
            color: var(--red);
        }
        
        .tiktok-stat-delta.neutral {
            color: var(--text-dim);
        }
        
        .tiktok-videos {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .tiktok-video {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            font-size: 0.85rem;
        }
        
        .tiktok-video-views {
            color: var(--accent-blue);
            font-weight: 500;
        }
        
        /* Tasks */
        .tasks-section {
            margin-bottom: 1.25rem;
        }
        
        .tasks-section-title {
            font-size: 0.8rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 0.75rem;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }
        
        .task-icon {
            font-size: 1rem;
        }
        
        .task-completed {
            opacity: 0.6;
        }
        
        .task-completed .task-name {
            text-decoration: line-through;
        }
        
        /* Connected Accounts - Tight Pills */
        .card-accounts {
            padding: 0.75rem;
            height: fit-content;
        }
        
        .card-accounts .card-header {
            margin-bottom: 0.5rem;
            padding-bottom: 0.35rem;
        }
        
        .card-accounts .card-title {
            font-size: 0.9rem;
        }
        
        .accounts-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
        }
        
        .account-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.04);
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 500;
            border: 1px solid var(--border);
        }
        
        .pill-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--green);
        }
        
        /* Status Card - Sleek Right Side */
        /* (old status-row styles removed) */
        
        /* WhatsApp FAB */
        .whatsapp-fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            border-radius: 50%;
            display: none; /* Hidden on desktop by default */
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            z-index: 1000;
        }
        
        /* Show chat fab only on mobile */
        @media (max-width: 768px) {
            .whatsapp-fab {
                display: flex;
            }
        }
        
        .whatsapp-fab:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px rgba(37, 211, 102, 0.5);
        }
        
        .whatsapp-fab:active {
            transform: scale(0.95);
        }
        
        /* Left Column - Stacked widgets (sets the row height) */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Center Column - Stacked widgets (stretches to match left) */
        .center-column {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        /* Right column card stretches */
        .main-container > .card {
            display: flex;
            flex-direction: column;
        }
        
        .main-container > .card .predictions-list {
            flex: 1;
            overflow-y: auto;
        }
        
        /* AI News - compact in center column */
        .card-news-fill {
            flex: 0 1 auto;
            display: flex;
            flex-direction: column;
        }
        
        .card-news-fill .news-two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        
        .news-col-title {
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-dim);
            margin-bottom: 0.25rem;
            padding-bottom: 0.15rem;
            border-bottom: 1px solid var(--border);
        }
        
        .card-news-fill .news-list {
            max-height: none;
        }
        
        /* Jane Status - Slim bar (left column) */
        .card-status-slim {
            padding: 0.4rem 0.75rem !important;
            margin-bottom: 0.5rem;
        }
        .status-slim-row {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }
        .status-slim-label {
            font-weight: 700;
            font-size: 0.7rem;
            color: var(--accent);
        }
        .status-slim-pill {
            font-size: 0.6rem;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
        }
        .status-slim-pill.green {
            color: var(--accent);
            font-weight: 700;
        }
        .status-slim-pill.dim {
            color: var(--text-dim);
        }
        .status-slim-divider {
            color: rgba(255,255,255,0.2);
            font-size: 0.5rem;
        }

        /* Jane Status - Prominent card (center) */
        .card-status {
            padding: 1rem 1.25rem;
        }
        
        .card-status .card-header {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }
        
        .status-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            padding: 0.75rem 0.5rem;
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.08) 0%, rgba(74, 222, 128, 0.02) 100%);
            border: 1px solid rgba(74, 222, 128, 0.1);
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .status-box:hover {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.12) 0%, rgba(74, 222, 128, 0.04) 100%);
            border-color: rgba(74, 222, 128, 0.2);
        }
        
        .status-box-label {
            display: block;
            font-size: 0.6rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.35rem;
            text-shadow: 0 0 8px rgba(74, 222, 128, 0.4);
        }
        
        .status-box-value {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
            text-align: center;
            width: 100%;
        }
        
        .status-box-value.blue { color: #ffffff; }
        
        .agents-row {
            font-size: 0.75rem;
            color: var(--text-dim);
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }
        
        /* Connected Accounts - Prominent */
        .card-connected {
            padding: 1rem;
        }
        
        .card-connected .card-header {
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
        }
        
        .card-connected .accounts-pills {
            gap: 0.5rem;
        }
        
        .card-connected .account-pill {
            padding: 0.4rem 0.7rem;
            font-size: 0.8rem;
        }
        
        .conn-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-dim);
            margin-bottom: 0.4rem;
            font-weight: 600;
        }
        .conn-divider {
            border-top: 1px solid rgba(255,255,255,0.06);
            margin: 0.5rem 0;
        }
        .conn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.25rem 0.75rem;
        }
        .conn-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.2rem 0;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        .conn-item img {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            flex-shrink: 0;
        }
        .conn-item img.logo-invert {
            filter: invert(1);
        }
        .conn-item .conn-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
            flex-shrink: 0;
            margin-left: auto;
        }
        
        /* TikTok Full (fills remaining left column) */
        .card-tiktok-full {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }
        
        .card-tiktok-full .tiktok-handle {
            font-size: 1.1rem;
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .card-tiktok-full .tiktok-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .card-tiktok-full .tiktok-stat {
            text-align: center;
            padding: 0.75rem;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }
        
        .card-tiktok-full .tiktok-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent);
        }
        
        .card-tiktok-full .tiktok-stat-label {
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-top: 0.25rem;
        }
        
        .tiktok-videos-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-dim);
            margin-bottom: 0.5rem;
            padding-bottom: 0.35rem;
            border-bottom: 1px solid var(--border);
        }
        
        .card-tiktok-full .tiktok-videos {
            max-height: 180px;
            overflow-y: auto;
        }
        
        /* Sorare Widget - Premium */
        .card-sorare {
            padding: 1rem;
            background: linear-gradient(135deg, rgba(255,215,0,0.03) 0%, transparent 50%);
        }
        
        .sorare-logo {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            filter: brightness(0) invert(1);
        }
        
        /* Fixture Status Bar */
        .sorare-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: rgba(255,215,0,0.08);
            border: 1px solid rgba(255,215,0,0.2);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        
        .sorare-gw {
            font-weight: 700;
            color: #ffd700;
            font-size: 0.9rem;
        }
        
        .sorare-countdown {
            font-size: 0.75rem;
            color: var(--text);
        }
        
        .sorare-countdown.live {
            color: #4ade80;
        }
        
        .sorare-countdown.ending {
            color: #f97316;
        }
        
        .sorare-status-badge {
            font-size: 0.6rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .sorare-status-badge.scheduled { background: rgba(100,100,100,0.3); color: #888; }
        .sorare-status-badge.live { background: rgba(74,222,128,0.2); color: #4ade80; }
        .sorare-status-badge.ending { background: rgba(249,115,22,0.2); color: #f97316; }
        .sorare-status-badge.final { background: rgba(255,215,0,0.2); color: #ffd700; }
        
        /* Lineup Cards */
        .sorare-lineups {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .sorare-lineup-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.5rem 0.6rem;
        }
        
        .sorare-lineup-card.live {
            border-color: rgba(74,222,128,0.3);
        }
        
        .sorare-lineup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.35rem;
        }
        
        .sorare-lineup-num {
            font-weight: 700;
            color: #ffd700;
            font-size: 0.8rem;
        }
        
        .sorare-lineup-rank {
            font-size: 0.7rem;
            color: var(--accent);
            font-weight: 600;
        }
        
        .sorare-lineup-score {
            font-size: 0.75rem;
            color: var(--text);
            font-weight: 600;
        }
        
        .sorare-lineup-players {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            font-size: 0.6rem;
            color: var(--text-dim);
        }
        
        .sorare-player {
            background: rgba(255,255,255,0.05);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
        }
        
        .sorare-player.playing {
            background: rgba(74,222,128,0.15);
            color: #4ade80;
        }
        
        .sorare-player.final {
            color: var(--text);
        }
        
        /* Summary Row */
        .sorare-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0.5rem;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
            font-size: 0.7rem;
        }
        
        .sorare-summary-item {
            text-align: center;
        }
        
        .sorare-summary-value {
            font-weight: 700;
            color: #ffd700;
        }
        
        .sorare-summary-label {
            font-size: 0.55rem;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .tiktok-video {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0.5rem;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
            margin-bottom: 0.4rem;
            font-size: 0.8rem;
        }
        
        .tiktok-video-views {
            color: var(--accent-blue);
            font-weight: 500;
        }
        
        /* Thinking Widget (base) */
        .thinking-widget {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 16px;
            padding: 1rem 1.25rem;
            box-shadow: 0 4px 30px rgba(74, 222, 128, 0.1), inset 0 0 60px rgba(74, 222, 128, 0.03);
        }
        
        /* Jane's Mind - Brain Map Widget */
        .mind-widget {
            border-color: rgba(74, 222, 128, 0.4);
            border-width: 2px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5), 0 0 20px rgba(74, 222, 128, 0.1), inset 0 0 80px rgba(74, 222, 128, 0.03);
            padding: 1.25rem 1.5rem;
            min-height: 480px;
        }
        
        .mind-logo {
            width: 24px;
            height: 24px;
            border-radius: 6px;
        }
        
        .mind-widget .thinking-header {
            border-bottom-color: rgba(74, 222, 128, 0.3);
            padding-bottom: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .mind-widget .thinking-title {
            color: var(--accent);
            font-size: 1rem;
            letter-spacing: 1.5px;
        }
        
        .mind-widget .thinking-status {
            color: var(--accent);
            font-size: 0.75rem;
        }
        
        .mind-body {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
        }
        
        .mind-model-legend {
            display: flex;
            gap: 12px;
            padding: 4px 0 8px 0;
            flex-wrap: wrap;
        }
        .model-dot {
            font-size: 0.7rem;
            color: var(--dot-color, #4ade80);
            opacity: 0.7;
        }
        .brain-map-container {
            flex-shrink: 0;
            width: 200px;
            height: 380px;
            position: relative;
            align-self: center;
            margin-top: auto;
            margin-bottom: auto;
        }
        
        .brain-map-container svg {
            width: 100%;
            height: 100%;
            transition: filter 0.8s ease;
        }
        
        /* ===== SCIENTIFIC MINIMALIST BRAIN ===== */
        
        /* Idle state â€” subtle pulse */
        .brain-idle svg {
            filter: drop-shadow(0 0 4px rgba(74, 222, 128, 0.1));
        }
        
        @keyframes sciPulse {
            0%, 100% { opacity: 0.15; transform: scale(0.97); }
            50% { opacity: 0.35; transform: scale(1.08); }
        }
        
        @keyframes sciHubPulse {
            0%, 100% { r: 14; fill-opacity: 0.12; filter: drop-shadow(0 0 4px rgba(74,222,128,0.15)); }
            50% { r: 17; fill-opacity: 0.3; filter: drop-shadow(0 0 15px rgba(74,222,128,0.5)); }
        }
        
        @keyframes hubOuterSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes hubOuterSpinReverse {
            0% { transform: rotate(360deg); }
            100% { transform: rotate(0deg); }
        }
        
        .hub-outer-ring {
            transform-origin: 100px 190px;
        }
        .brain-idle .hub-outer-ring {
            animation: hubOuterSpin 12s linear infinite;
        }
        .brain-active .hub-outer-ring {
            animation: hubOuterSpin 4s linear infinite;
            stroke: rgba(74,222,128,0.6);
            stroke-width: 1;
        }
        
        @keyframes sciNodePulse {
            0%, 100% { fill-opacity: 0.3; r: 2.5; }
            50% { fill-opacity: 0.75; r: 4; }
        }
        
        @keyframes sciLinePulse {
            0%, 100% { stroke-opacity: 0.1; }
            50% { stroke-opacity: 0.3; }
        }
        
        @keyframes sciLabelPulse {
            0%, 100% { fill-opacity: 0.3; }
            50% { fill-opacity: 0.7; }
        }
        
        @keyframes sciRingScan {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -628; }
        }
        @keyframes sciRingScanReverse {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: 628; }
        }
        
        @keyframes sciGridPulse {
            0%, 100% { stroke-opacity: 0.08; }
            50% { stroke-opacity: 0.18; }
        }
        
        /* Concentric reference rings */
        .sci-ring {
            fill: none;
            stroke: rgba(74,222,128,0.1);
            stroke-width: 0.5;
        }
        .brain-idle .sci-ring {
            animation: sciGridPulse 4s ease-in-out infinite;
        }
        .brain-idle .sci-ring:nth-child(2) { animation-delay: 0.8s; }
        .brain-idle .sci-ring:nth-child(3) { animation-delay: 1.6s; }
        
        /* Scanning ring (idle only) */
        .sci-scan-ring {
            fill: none;
            stroke: rgba(74,222,128,0.2);
            stroke-width: 0.8;
            transform-origin: 100px 190px;
        }
        /* Orbit 1 â€” large, CW */
        .sci-orbit-1 { stroke-dasharray: 25 603; }
        .brain-idle .sci-orbit-1 { animation: sciRingScan 8s linear infinite; }
        .brain-active .sci-orbit-1 { animation: sciRingScan 3s linear infinite; stroke: rgba(74,222,128,0.35); }
        /* Orbit 2 â€” medium, CCW */
        .sci-orbit-2 { stroke-dasharray: 20 295; }
        .brain-idle .sci-orbit-2 { animation: sciRingScanReverse 6s linear infinite; }
        .brain-active .sci-orbit-2 { animation: sciRingScanReverse 2.5s linear infinite; stroke: rgba(74,222,128,0.35); }
        /* Orbit 3 â€” small, CW fast */
        .sci-orbit-3 { stroke-dasharray: 15 236; }
        .brain-idle .sci-orbit-3 { animation: sciRingScan 5s linear infinite; }
        .brain-active .sci-orbit-3 { animation: sciRingScan 2s linear infinite; stroke: rgba(74,222,128,0.4); }
        /* Orbit 4 â€” large, CCW slow */
        .sci-orbit-4 { stroke-dasharray: 35 719; }
        .brain-idle .sci-orbit-4 { animation: sciRingScanReverse 10s linear infinite; }
        .brain-active .sci-orbit-4 { animation: sciRingScanReverse 4s linear infinite; stroke: rgba(74,222,128,0.3); }
        /* Orbit 5 â€” medium, CW */
        .sci-orbit-5 { stroke-dasharray: 18 385; }
        .brain-idle .sci-orbit-5 { animation: sciRingScan 7s linear infinite; }
        .brain-active .sci-orbit-5 { animation: sciRingScan 2.8s linear infinite; stroke: rgba(74,222,128,0.35); }
        
        /* Glow backdrop */
        .brain-idle #brain-glow {
            animation: sciPulse 4s ease-in-out infinite;
            transform-origin: 100px 190px;
        }
        
        /* Hub */
        .brain-idle #brain-hub {
            animation: sciHubPulse 5s ease-in-out infinite;
        }
        
        /* Nodes */
        .brain-idle .brain-node-circle {
            animation: sciNodePulse 3.5s ease-in-out infinite;
        }
        .brain-idle #brain-node-0 { animation-delay: 0s; }
        .brain-idle #brain-node-1 { animation-delay: 0.6s; }
        .brain-idle #brain-node-2 { animation-delay: 1.2s; }
        .brain-idle #brain-node-3 { animation-delay: 1.8s; }
        .brain-idle #brain-node-4 { animation-delay: 2.4s; }
        .brain-idle #brain-node-5 { animation-delay: 3.0s; }
        .brain-idle #brain-node-6 { animation-delay: 3.6s; }
        .brain-idle #brain-node-7 { animation-delay: 4.2s; }
        
        /* Lines */
        .brain-idle .brain-line {
            animation: sciLinePulse 3.5s ease-in-out infinite;
        }
        .brain-idle #brain-line-0 { animation-delay: 0s; }
        .brain-idle #brain-line-1 { animation-delay: 0.6s; }
        .brain-idle #brain-line-2 { animation-delay: 1.2s; }
        .brain-idle #brain-line-3 { animation-delay: 1.8s; }
        .brain-idle #brain-line-4 { animation-delay: 2.4s; }
        .brain-idle #brain-line-5 { animation-delay: 3.0s; }
        .brain-idle #brain-line-6 { animation-delay: 3.6s; }
        .brain-idle #brain-line-7 { animation-delay: 4.2s; }
        
        /* Labels */
        .brain-idle .brain-node-label {
            animation: sciLabelPulse 3.5s ease-in-out infinite;
        }
        
        /* Hub label breathing */
        @keyframes sciHubLabelPulse {
            0%, 100% { fill-opacity: 0.5; }
            50% { fill-opacity: 1; }
        }
        .brain-idle #brain-hub-label {
            animation: sciHubLabelPulse 3.5s ease-in-out infinite;
        }
        .brain-active #brain-hub-label {
            fill-opacity: 1 !important;
            fill: rgba(74,222,128,1);
            filter: drop-shadow(0 0 6px rgba(74,222,128,0.5));
        }
        .brain-idle #brain-hub-sublabel {
            animation: sciLabelPulse 3.5s ease-in-out infinite;
        }
        .brain-active #brain-hub-sublabel {
            fill-opacity: 0.8 !important;
            fill: rgba(74,222,128,0.7);
        }
        
        /* ===== ACTIVE STATE ===== */
        .brain-active svg {
            filter: drop-shadow(0 0 12px rgba(74, 222, 128, 0.3));
        }
        
        .brain-active #brain-hub {
            fill-opacity: 0.7 !important;
            stroke-opacity: 1 !important;
            filter: drop-shadow(0 0 8px rgba(74, 222, 128, 0.5));
        }
        
        .brain-active #brain-glow {
            opacity: 0.25;
            transition: opacity 0.5s ease;
        }
        
        .brain-hub {
            transition: all 0.5s ease;
        }
        
        .brain-node-circle {
            transition: all 0.4s ease;
            cursor: default;
        }
        
        .brain-node-label {
            font-size: 5px;
            font-family: 'SF Mono', 'Menlo', monospace;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            fill: rgba(74,222,128,0.3);
            text-anchor: middle;
            pointer-events: none;
            transition: fill 0.4s ease;
        }
        
        .brain-line {
            transition: stroke 0.4s ease, opacity 0.4s ease;
        }
        
        @keyframes pulseDot {
            0% { offset-distance: 0%; opacity: 1; }
            100% { offset-distance: 100%; opacity: 0; }
        }
        
        .pulse-dot {
            offset-distance: 0%;
            animation: pulseDot 1.5s linear infinite;
        }
        
        .mind-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 380px;
            overflow-y: auto;
        }
        
        .mind-section {
            padding-bottom: 0.6rem;
            border-bottom: 1px solid rgba(74, 222, 128, 0.12);
        }
        
        .mind-section:last-child { border-bottom: none; }
        
        .mind-section-label {
            font-size: 0.6rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
            font-weight: 600;
        }
        
        .mind-task-text {
            color: var(--accent);
            font-weight: 600;
            font-size: 0.95rem;
            line-height: 1.3;
        }
        
        .mind-thought-text {
            color: var(--accent);
            font-size: 0.8rem;
            font-style: italic;
            line-height: 1.3;
        }
        
        .mind-steps {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .mind-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 6px;
            transition: background 0.3s;
        }
        
        .mind-step.pending { color: var(--text-dim); }
        .mind-step.active { color: #4ade80; background: rgba(74, 222, 128, 0.08); }
        .mind-step.done { color: rgba(74, 222, 128, 0.6); }
        
        .step-indicator {
            font-size: 0.65rem;
            flex-shrink: 0;
            width: 14px;
            text-align: center;
        }
        
        .step-tool {
            font-size: 0.6rem;
            padding: 1px 5px;
            border-radius: 3px;
            margin-left: auto;
            flex-shrink: 0;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        
        .thought-prefix {
            flex-shrink: 0;
        }
        
        .waiting-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        /* Dashboard Operations widget */
        .ops-widget .thinking-title {
            color: var(--accent);
        }
        
        .thinking-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(74, 222, 128, 0.2);
        }
        
        .thinking-icon {
            font-size: 1rem;
        }
        
        .thinking-title {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .thinking-status {
            margin-left: auto;
            font-size: 0.65rem;
            color: var(--green);
            animation: pulse 2s ease-in-out infinite;
        }
        
        .thinking-content {
            font-family: 'SF Mono', 'Fira Code', 'Courier New', monospace;
            font-size: 0.75rem;
            line-height: 1.5;
            color: var(--accent);
            height: 90px;
            max-height: 90px;
            overflow: hidden;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }
        
        .ops-sessions {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid rgba(74, 222, 128, 0.15);
            margin-bottom: 0.5rem;
        }
        
        .ops-sessions-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .ops-sessions-header .cat-icon {
            width: 12px;
            height: 12px;
            fill: var(--accent);
        }
        
        .ops-sessions-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }
        
        .ops-session-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.5rem;
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.2);
            border-radius: 4px;
            font-size: 0.65rem;
            color: var(--text);
        }
        
        .ops-session-tag.active {
            background: rgba(74, 222, 128, 0.2);
            border-color: rgba(74, 222, 128, 0.4);
        }
        
        .ops-session-tag.idle {
            opacity: 0.6;
        }
        
        .ops-session-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
        }
        
        .ops-session-tag.idle .ops-session-dot {
            background: var(--text-dim);
        }
        
        .thinking-line {
            margin-bottom: 0.35rem;
            padding-left: 0.9rem;
            position: relative;
            opacity: 0;
            animation: typeIn 0.3s ease forwards;
        }
        
        .thinking-line::before {
            content: '>';
            position: absolute;
            left: 0;
            color: rgba(74, 222, 128, 0.5);
        }
        
        .thinking-line.old {
            opacity: 0.5;
            color: rgba(74, 222, 128, 0.6);
            text-shadow: none;
        }
        
        .thinking-cursor {
            display: inline-block;
            width: 8px;
            height: 14px;
            background: var(--accent);
            margin-left: 2px;
            animation: blink 1s step-end infinite;
        }
        
        @keyframes typeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Value change flash animations */
        @keyframes flashGreen {
            0% { background: rgba(0, 255, 100, 0.3); }
            100% { background: transparent; }
        }
        @keyframes flashRed {
            0% { background: rgba(255, 100, 100, 0.3); }
            100% { background: transparent; }
        }
        .flash-up {
            animation: flashGreen 0.5s ease-out;
        }
        .flash-down {
            animation: flashRed 0.5s ease-out;
        }
        
        /* Smooth value transitions */
        .ticker-price, .ticker-change {
            transition: color 0.3s ease;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }
        
        /* Cron Jobs */
        .cron-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .cron-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0.75rem;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            font-size: 0.85rem;
        }
        
        .cron-name {
            font-weight: 500;
        }
        
        .cron-schedule {
            font-size: 0.75rem;
            color: var(--text-dim);
            font-family: 'SF Mono', monospace;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="header-left-text">
                <div class="header-time" id="current-time">--:--</div>
                <div class="header-date" id="current-date">---</div>
            </div>
            <button class="night-mode-btn" onclick="toggleNightMode()">NIGHT<br>MODE</button>
            <button class="refresh-all-btn" id="refresh-all-btn" onclick="refreshAll()" title="Refresh all widgets">â†»</button>
        </div>
        
        <div class="header-center">
            <span class="hello-greeting">hi Josh</span>
        </div>
        
        <div class="header-right">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span id="system-status">Online</span>
            </div>
            <img src="icon-192.png" alt="Jane" class="logo">
            <div class="brand-text">
                <span class="brand-name">JANE</span>
                <span class="brand-tagline">Personal AI</span>
            </div>
        </div>
    </header>
    
    <!-- Main Grid -->
    <main class="main-container">
        <!-- Row 1 -->
        
        <!-- LEFT COLUMN: Jane's Mind + Dashboard Operations stacked -->
        <div class="left-column">
            <!-- Jane Status - Slim bar -->
            <div class="card card-status-slim">
                <div class="status-slim-row">
                    <img src="icon-192.png" alt="Jane" style="width:16px;height:16px;border-radius:3px;">
                    <span class="status-slim-label">Jane</span>
                    <span class="status-slim-pill" id="jane-model-slim">Model: --</span>
                    <span class="status-slim-pill green" id="plan-slim">Plan: Max</span>
                    <span class="status-slim-divider">Â·</span>
                    <span class="status-slim-pill dim" id="jane-age-slim">Age: --</span>
                    <span class="status-slim-divider">Â·</span>
                    <span class="status-slim-pill" id="cpu-slim">CPU: --%</span>
                    <span class="status-slim-divider">Â·</span>
                    <span class="status-slim-pill" id="ram-slim">RAM: --%</span>
                    <span class="status-slim-divider">Â·</span>
                    <span class="status-slim-pill" id="mini2-slim" title="Mac Mini #2 (compute node)">Mini2: --</span>
                </div>
            </div>
            <!-- Jane's Mind - Real reasoning/task tracking -->
            <div class="thinking-widget mind-widget">
                <div class="thinking-header">
                    <img src="icon-192.png" alt="Jane" class="mind-logo">
                    <span class="thinking-title">Jane's Mind</span>
                    <span class="thinking-status" id="mind-status">â— Active</span>
                </div>
                <div class="mind-model-legend" id="mind-model-legend">
                    <span class="model-dot" style="--dot-color:#4ade80">â— Opus</span>
                    <span class="model-dot" style="--dot-color:#8b5cf6">â— Sonnet</span>
                    <span class="model-dot" style="--dot-color:#facc15">â— Whisper</span>
                    <span class="model-dot" style="--dot-color:#f97316">â— Ollama</span>
                    <span class="model-dot" style="--dot-color:#ec4899">â— Stable Diffusion</span>
                </div>
                <div class="mind-body" style="flex-direction: row-reverse;">
                    <!-- Brain Map SVG -->
                    <div class="brain-map-container">
                        <svg id="brain-map" viewBox="0 0 200 380" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <radialGradient id="hubGlow" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" stop-color="rgba(74,222,128,0.15)"/>
                                    <stop offset="100%" stop-color="rgba(74,222,128,0)"/>
                                </radialGradient>
                            </defs>
                            <!-- Subtle glow -->
                            <circle cx="100" cy="190" r="40" fill="url(#hubGlow)" opacity="0.15" id="brain-glow"/>
                            <!-- Concentric reference rings (scientific grid) -->
                            <circle cx="100" cy="190" r="40" class="sci-ring"/>
                            <circle cx="100" cy="190" r="80" class="sci-ring"/>
                            <circle cx="100" cy="190" r="120" class="sci-ring"/>
                            <!-- Crosshair lines -->
                            <line x1="100" y1="60" x2="100" y2="320" stroke="rgba(74,222,128,0.03)" stroke-width="0.5"/>
                            <line x1="10" y1="190" x2="190" y2="190" stroke="rgba(74,222,128,0.03)" stroke-width="0.5"/>
                            <!-- Orbiting arcs -->
                            <circle cx="100" cy="190" r="100" class="sci-scan-ring sci-orbit-1"/>
                            <circle cx="100" cy="190" r="50" class="sci-scan-ring sci-orbit-2"/>
                            <circle cx="100" cy="190" r="40" class="sci-scan-ring sci-orbit-3"/>
                            <circle cx="100" cy="190" r="120" class="sci-scan-ring sci-orbit-4"/>
                            <circle cx="100" cy="190" r="64" class="sci-scan-ring sci-orbit-5"/>
                            <!-- Connection lines (drawn by JS) -->
                            <g id="brain-lines"></g>
                            <!-- Pulse dots (drawn by JS) -->
                            <g id="brain-pulses"></g>
                            <!-- Satellite nodes (drawn by JS) -->
                            <g id="brain-nodes"></g>
                            <!-- Center hub -->
                            <g id="brain-hub-group" class="brain-hub-group">
                                <circle cx="100" cy="190" r="22" fill="rgba(74,222,128,0.08)" stroke="rgba(74,222,128,0.3)" stroke-width="0.5" stroke-dasharray="4 4" class="hub-outer-ring" id="hub-outer-ring"/>
                                <circle cx="100" cy="190" r="15" fill="rgba(74,222,128,0.15)" stroke="rgba(74,222,128,0.5)" stroke-width="1" id="brain-hub" class="brain-hub"/>
                                <text x="100" y="187" text-anchor="middle" fill="rgba(74,222,128,0.7)" font-size="11" font-family="'SF Mono','Menlo',monospace" letter-spacing="4" font-weight="600" id="brain-hub-label">J</text>
                                <text x="100" y="199" text-anchor="middle" fill="rgba(74,222,128,0.4)" font-size="5" font-family="'SF Mono','Menlo',monospace" letter-spacing="1" font-weight="400" id="brain-hub-sublabel">JANE</text>
                            </g>
                        </svg>
                    </div>
                    <!-- Info Panel -->
                    <div class="mind-info">
                        <div class="mind-section">
                            <div class="mind-section-label">GOAL / OBJECTIVE</div>
                            <div class="mind-task-text" id="mind-current-task">Awaiting instructions...</div>
                        </div>
                        <div class="mind-section">
                            <div class="mind-section-label">THINKING &amp; DECISIONS</div>
                            <div class="mind-thought-text" id="mind-thought-text">Ready for your next request.</div>
                        </div>
                        <div class="mind-section">
                            <div class="mind-section-label">ACTIONS &amp; TOOLS</div>
                            <div class="mind-steps" id="mind-steps">
                                <!-- Steps populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Connected Accounts - Dynamic -->
            <div class="card card-connected">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon"><svg class="cat-icon" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg></span>
                        Connected Accounts
                        <span class="last-refresh" id="connections-refresh">--</span>
                    </div>
                    <div class="card-meta">
                        <button class="refresh-btn" onclick="refreshConnections(this)">â†»</button>
                    </div>
                </div>
                <div id="connections-container">
                    <div class="conn-section">
                        <div class="conn-section-title">My Accounts</div>
                        <div class="conn-grid" id="conn-accounts"></div>
                    </div>
                    <div class="conn-divider"></div>
                    <div class="conn-section">
                        <div class="conn-section-title">Data Connections</div>
                        <div class="conn-grid" id="conn-datasources"></div>
                    </div>
                </div>
            </div>
            
            <!-- Sorare Widget - Premium Limited Champion -->
            <div class="card card-sorare">
                <div class="card-header" style="margin-bottom: 0.5rem; padding-bottom: 0.5rem;">
                    <div class="card-title" style="font-size: 0.95rem;">
                        <img src="https://sorare.com/favicon.ico" alt="Sorare" class="sorare-logo">
                        Limited Champion
                        <span class="last-refresh" id="sorare-refresh">--</span>
                    </div>
                    <button class="refresh-btn" onclick="refreshSorare(this)">â†»</button>
                </div>
                
                <!-- Status Bar -->
                <div class="sorare-status-bar" id="sorare-status-bar">
                    <div>
                        <span class="sorare-gw" id="sorare-gw">GW--</span>
                        <span class="sorare-countdown" id="sorare-countdown">Loading...</span>
                    </div>
                    <span class="sorare-status-badge scheduled" id="sorare-status">--</span>
                </div>
                
                <!-- Lineups -->
                <div class="sorare-lineups" id="sorare-lineups">
                    <div class="sorare-lineup-card">
                        <div style="text-align:center; color:var(--text-dim); font-size:0.7rem;">Loading lineups...</div>
                    </div>
                </div>
                
                <!-- Summary Row -->
                <div class="sorare-summary">
                    <div class="sorare-summary-item">
                        <div class="sorare-summary-value" id="sorare-limited-count">--</div>
                        <div class="sorare-summary-label">Limited Cards</div>
                    </div>
                    <div class="sorare-summary-item">
                        <div class="sorare-summary-value" id="sorare-last-best">--</div>
                        <div class="sorare-summary-label">Last Best</div>
                    </div>
                    <div class="sorare-summary-item">
                        <div class="sorare-summary-value" id="sorare-field-size">--</div>
                        <div class="sorare-summary-label">Field Size</div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- CENTER COLUMN: Jane Status + Connected stacked -->
        <div class="center-column">
            <!-- Top row: Watch List -->
            <div class="status-ticker-row">
            <!-- Watch List - Compact -->
            <div class="card card-ticker">
                <div class="card-header ticker-header">
                    <div class="card-title">Watch List</div>
                    <button class="refresh-btn" onclick="refreshTicker(this)">â†»</button>
                </div>
                <div class="ticker-row">
                    <div class="ticker-item">
                        <span class="market-dot stock-market" id="ndaq-market-dot" title="Stock Market Hours"></span>
                        <img src="https://www.nasdaq.com/sites/acquia.prod/files/2020/09/24/nasdaq.jpg" alt="NDAQ" class="ticker-logo" style="width:20px; height:20px; border-radius:4px; object-fit:cover;">
                        <div class="ticker-info">
                            <span class="ticker-price" id="ticker-nasdaq">--</span>
                            <span class="ticker-change neutral" id="ticker-nasdaq-change">--</span>
                        </div>
                    </div>
                    <div class="ticker-item">
                        <span class="market-dot crypto-market" title="24/7 Market"></span>
                        <img src="https://assets.coingecko.com/coins/images/1/small/bitcoin.png" alt="BTC" class="ticker-logo">
                        <div class="ticker-info">
                            <span class="ticker-price" id="ticker-btc">--</span>
                            <span class="ticker-change neutral" id="ticker-btc-change">--</span>
                        </div>
                    </div>
                    <div class="ticker-item ticker-sub">
                        <span class="market-dot stock-market" id="ibit-market-dot" title="Stock Market"></span>
                        <span class="ticker-logo-text">IBIT</span>
                        <div class="ticker-info">
                            <span class="ticker-price" id="ticker-ibit">--</span>
                            <span class="ticker-change neutral" id="ticker-ibit-change">--</span>
                        </div>
                    </div>
                    <div class="ticker-item">
                        <span class="market-dot crypto-market" title="24/7 Market"></span>
                        <img src="https://assets.coingecko.com/coins/images/279/small/ethereum.png" alt="ETH" class="ticker-logo">
                        <div class="ticker-info">
                            <span class="ticker-price" id="ticker-eth">--</span>
                            <span class="ticker-change neutral" id="ticker-eth-change">--</span>
                        </div>
                    </div>
                    <div class="ticker-item">
                        <span class="market-dot crypto-market" title="24/7 Market"></span>
                        <img src="https://assets.coingecko.com/coins/images/4128/small/solana.png" alt="SOL" class="ticker-logo">
                        <div class="ticker-info">
                            <span class="ticker-price" id="ticker-sol">--</span>
                            <span class="ticker-change neutral" id="ticker-sol-change">--</span>
                        </div>
                    </div>
                </div>
            </div>
            </div><!-- end status-ticker-row -->
            
            <!-- AI News - fills remaining height -->
            <div class="card card-news-fill">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon"><svg class="cat-icon" viewBox="0 0 24 24"><path d="M21 11.18V9l-9-5-9 5v2.18l9 5 9-5zM12 14.68l-6-3.33V9l6 3.33L18 9v2.35l-6 3.33zm0 2.18l-6-3.33v2.35l6 3.33 6-3.33v-2.35l-6 3.33z"/></svg></span>
                        AI News
                        <span class="last-refresh" id="news-refresh">--</span>
                    </div>
                    <div class="card-meta">
                        <button class="refresh-btn" onclick="refreshNews(this)">â†»</button>
                    </div>
                </div>
                <div class="news-two-columns">
                    <div class="news-col">
                        <div class="news-col-title"><svg class="cat-icon" viewBox="0 0 24 24"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/></svg> Enterprise</div>
                        <div class="news-list" id="news-enterprise"></div>
                    </div>
                    <div class="news-col">
                        <div class="news-col-title"><svg class="cat-icon" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg> Retail</div>
                        <div class="news-list" id="news-retail"></div>
                    </div>
                </div>
            </div>
            <!-- X Growth Widget -->
            <div class="card card-xgrowth">
                <div class="card-header">
                    <div class="card-title" style="display:flex;align-items:center;gap:8px;">
                        <img id="x-profile-pic" src="https://pbs.twimg.com/profile_images/2020308693817147392/t3XaP-Il_200x200.jpg" alt="@AgentJc11443" style="width:28px;height:28px;border-radius:50%;border:2px solid var(--accent);object-fit:cover;">
                        <span>X Growth</span>
                        <span class="last-refresh" id="x-refresh">--</span>
                    </div>
                    <div class="card-meta">
                        <button class="refresh-btn" onclick="refreshXStats(this)">â†»</button>
                    </div>
                </div>
                <div class="x-stats-grid">
                    <div class="x-stat-item"><div class="x-stat-value" id="x-followers">--</div><div class="x-stat-label">Followers</div></div>
                    <div class="x-stat-item"><div class="x-stat-value" id="x-following">--</div><div class="x-stat-label">Following</div></div>
                    <div class="x-stat-item"><div class="x-stat-value" id="x-posts">--</div><div class="x-stat-label">Posts</div></div>
                    <div class="x-stat-item"><div class="x-stat-value" id="x-impressions">--</div><div class="x-stat-label">Impressions</div></div>
                    <div class="x-stat-item"><div class="x-stat-value" id="x-engagements">--</div><div class="x-stat-label">Engagements</div></div>
                    <div class="x-stat-item"><div class="x-stat-value" id="x-eng-rate">--</div><div class="x-stat-label">Eng. Rate</div></div>
                </div>
                <div class="x-roadmap">
                    <div class="x-roadmap-title">Growth Roadmap</div>
                    <div class="x-roadmap-items" id="x-roadmap-items">
                        <div class="x-roadmap-item"><span class="x-roadmap-pct">70%</span><span class="x-roadmap-text">Quality replies to high-follower accounts</span></div>
                        <div class="x-roadmap-item"><span class="x-roadmap-pct">20%</span><span class="x-roadmap-text">Original AI Ã— Crypto content</span></div>
                        <div class="x-roadmap-item"><span class="x-roadmap-pct">10%</span><span class="x-roadmap-text">Strategic follows & engagement</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- RIGHT COLUMN - Predictions -->
        <div class="right-column">
            <!-- Prediction Markets -->
            <div class="card card-predictions-full">
                <div class="card-header">
                    <div class="card-title">
                        Prediction Markets
                    <span class="market-logos">
                        <img src="https://polymarket.com/favicon.ico" alt="Polymarket" class="market-logo" title="Polymarket">
                        <img src="https://kalshi.com/favicon.ico" alt="Kalshi" class="market-logo" title="Kalshi">
                        <img src="https://manifold.markets/favicon.ico" alt="Manifold" class="market-logo" title="Manifold">
                        <img src="https://www.metaculus.com/favicon.ico" alt="Metaculus" class="market-logo" title="Metaculus">
                    </span>
                    <span class="last-refresh" id="predictions-refresh">--</span>
                </div>
                <div class="card-meta">
                    <button class="refresh-btn" onclick="refreshPredictions(this)">â†»</button>
                </div>
            </div>
            <!-- Kalshi Active Bets -->
            <div class="kalshi-bets-section" id="kalshi-bets-section">
                <div class="kalshi-bets-header">
                    <div class="kalshi-bets-title">
                        <img src="https://kalshi.com/favicon.ico" alt="K" style="width:14px;height:14px;border-radius:3px;filter:brightness(0) invert(1);">
                        My Active Bets
                        <span class="kalshi-balance" id="kalshi-balance"></span>
                    </div>
                    <div style="position:relative;">
                        <button class="kalshi-history-btn" id="kalshi-history-btn" onclick="toggleSettledPopup(event)">ðŸ“Š</button>
                        <div class="kalshi-settled-popup" id="kalshi-settled-popup"></div>
                    </div>
                </div>
                <div id="kalshi-bets-list">
                    <div class="kalshi-no-bets">Loading...</div>
                </div>
            </div>
            <div class="predictions-list" id="predictions-list">
                <div class="prediction-item">
                    <span class="prediction-question">Loading...</span>
                </div>
            </div>
            </div>
        </div><!-- end right-column -->
        
    </main>
    
    <!-- WhatsApp FAB -->
    <a href="https://wa.me/17175759384" class="whatsapp-fab" aria-label="Chat on WhatsApp">
        <svg viewBox="0 0 24 24" width="34" height="34" fill="white">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2z"/>
        </svg>
    </a>
    
    <script>
        // Global error handler â€” prevent any single error from killing the dashboard
        window.onerror = function(msg, url, line, col, error) {
            console.warn('Dashboard error caught:', msg, 'at line', line);
            return true; // Suppress error
        };
        window.addEventListener('unhandledrejection', function(e) {
            console.warn('Unhandled rejection:', e.reason?.message || e.reason);
            e.preventDefault();
        });
        
        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long',
                month: 'short', 
                day: 'numeric' 
            });
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        // Calculate Jane's age
        function updateJaneAge() {
            const birthDate = new Date('2026-01-31');
            const today = new Date();
            const ageDays = Math.floor((today - birthDate) / (1000 * 60 * 60 * 24));
            const el = document.getElementById('jane-age');
            if (el) el.textContent = ageDays + 'd';
            const slimEl = document.getElementById('jane-age-slim');
            if (slimEl) slimEl.textContent = 'Age: ' + ageDays + 'd';
        }
        updateJaneAge();
        
        // Fetch with timeout
        async function fetchWithTimeout(url, timeout = 8000) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(id);
                return await response.json();
            } catch (err) {
                clearTimeout(id);
                throw err;
            }
        }
        
        // Helper to spin refresh button
        function spinButton(btn, promise) {
            btn.classList.add('spinning');
            // Ensure minimum spin time of 600ms for visibility
            const minSpinTime = new Promise(resolve => setTimeout(resolve, 600));
            return Promise.all([promise, minSpinTime]).finally(() => btn.classList.remove('spinning'));
        }
        
        // Check if US stock market is open (9:30 AM - 4:00 PM ET, Mon-Fri)
        function isStockMarketOpen() {
            const now = new Date();
            const etOptions = { timeZone: 'America/New_York' };
            const etTime = new Date(now.toLocaleString('en-US', etOptions));
            const day = etTime.getDay(); // 0=Sun, 6=Sat
            const hours = etTime.getHours();
            const minutes = etTime.getMinutes();
            const timeInMinutes = hours * 60 + minutes;
            
            // Market open: 9:30 AM (570 min) to 4:00 PM (960 min), Mon-Fri
            const isWeekday = day >= 1 && day <= 5;
            const isDuringHours = timeInMinutes >= 570 && timeInMinutes < 960;
            
            return isWeekday && isDuringHours;
        }
        
        function updateMarketStatus() {
            const isOpen = isStockMarketOpen();
            // Update IBIT dot
            const ibitDot = document.getElementById('ibit-market-dot');
            if (ibitDot) {
                ibitDot.classList.remove('open', 'closed');
                ibitDot.classList.add(isOpen ? 'open' : 'closed');
                ibitDot.title = isOpen ? 'Stock Market Open' : 'Stock Market Closed';
            }
            // Update NDAQ dot
            const ndaqDot = document.getElementById('ndaq-market-dot');
            if (ndaqDot) {
                ndaqDot.classList.remove('open', 'closed');
                ndaqDot.classList.add(isOpen ? 'open' : 'closed');
                ndaqDot.title = isOpen ? 'Stock Market Open' : 'Stock Market Closed';
            }
        }
        
        // Market Ticker
        async function refreshTicker(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/ticker', 10000);
                    if (data && !data.error) {
                        const formatPrice = (p, decimals = 2) => {
                            if (!p) return '--';
                            if (p >= 10000) return '$' + Math.round(p).toLocaleString();
                            if (p >= 100) return '$' + p.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                            return '$' + p.toFixed(decimals);
                        };
                        
                        const formatChange = (c) => {
                            if (c === null || c === undefined) return { text: '--', class: 'neutral' };
                            const sign = c >= 0 ? '+' : '';
                            return { 
                                text: sign + c.toFixed(2) + '%', 
                                class: c > 0 ? 'positive' : c < 0 ? 'negative' : 'neutral' 
                            };
                        };
                        
                        const updateTicker = (id, price, change) => {
                            const priceEl = document.getElementById('ticker-' + id);
                            const changeEl = document.getElementById('ticker-' + id + '-change');
                            if (priceEl) priceEl.textContent = price;
                            if (changeEl) {
                                const c = formatChange(change);
                                changeEl.textContent = c.text;
                                changeEl.className = 'ticker-change ' + c.class;
                            }
                        };
                        
                        if (data.nasdaq) updateTicker('nasdaq', formatPrice(data.nasdaq.price, 2), data.nasdaq.change24h);
                        if (data.btc) updateTicker('btc', formatPrice(data.btc.price, 0), data.btc.change24h);
                        if (data.ibit) updateTicker('ibit', formatPrice(data.ibit.price), data.ibit.change24h);
                        if (data.eth) updateTicker('eth', formatPrice(data.eth.price, 0), data.eth.change24h);
                        if (data.sol) updateTicker('sol', formatPrice(data.sol.price), data.sol.change24h);
                        
                        // Update market status dots
                        updateMarketStatus();
                    }
                } catch (err) {
                    console.error('Ticker error:', err);
                }
            };
            if (btn) return spinButton(btn, doRefresh());
            return doRefresh();
        }
        
        // Connected Accounts
        // X Growth Stats
        async function refreshXStats(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/x-stats.json', 5000);
                    if (data) {
                        document.getElementById('x-followers').textContent = data.followers || 0;
                        document.getElementById('x-following').textContent = data.following || 0;
                        document.getElementById('x-posts').textContent = data.tweets || 0;
                        document.getElementById('x-impressions').textContent = data.impressions ? (data.impressions >= 1000 ? (data.impressions/1000).toFixed(1)+'K' : data.impressions) : '0';
                        document.getElementById('x-engagements').textContent = data.engagements || 0;
                        document.getElementById('x-eng-rate').textContent = String(data.engagementRate || '0%').replace(/%/g, '') + '%';
                        const el = document.getElementById('x-refresh');
                        if (el) el.textContent = new Date().toLocaleTimeString('en-US', {hour:'2-digit',minute:'2-digit'});
                    }
                } catch (err) { console.error('X stats error:', err); }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }

        async function refreshConnections(btn) {
            try {
                const res = await fetch('/api/connections');
                const data = await res.json();
                const render = (items, containerId) => {
                    const el = document.getElementById(containerId);
                    el.innerHTML = items.map(i => `
                        <div class="conn-item">
                            <img src="${i.icon}" alt="" class="${i.invert ? 'logo-invert' : ''}" onerror="this.style.display='none'">
                            <span title="${i.detail || ''}">${i.name}</span>
                            ${i.active ? '<span class="conn-dot"></span>' : ''}
                        </div>
                    `).join('');
                };
                render(data.accounts, 'conn-accounts');
                render(data.dataSources, 'conn-datasources');
                document.getElementById('connections-refresh').textContent = new Date().toLocaleTimeString();
            } catch(e) { console.error('connections', e); }
        }

        // System Stats
        async function refreshSystem(btn) {
            const doRefresh = async () => {
                try {
                    // Fetch with longer timeout for system stats
                    const [sessions, system] = await Promise.all([
                        fetchWithTimeout('/api/sessions', 10000),
                        fetchWithTimeout('/api/system', 10000)
                    ]);
                    
                    // Model
                    if (sessions?.sessions?.length) {
                        const main = sessions.sessions.find(s => s.kind === 'main') || sessions.sessions[0];
                        if (main?.model) {
                            const formatted = main.model.split('/').pop()
                                .replace('claude-', '')
                                .replace(/-/g, ' ')
                                .replace('4 5', '4.5')
                                .replace('4 6', '4.6');
                            const modelEl = document.getElementById('jane-model');
                            if (modelEl) modelEl.textContent = formatted;
                            const modelSlim = document.getElementById('jane-model-slim');
                            if (modelSlim) modelSlim.textContent = 'Model: ' + formatted;
                        }
                        // Uptime
                        if (main?.startedAt) {
                            const mins = Math.floor((Date.now() - new Date(main.startedAt).getTime()) / 60000);
                            const hrs = Math.floor(mins / 60);
                            const uptimeStr = hrs > 0 ? `${hrs}h ${mins % 60}m` : `${mins}m`;
                            const ageEl = document.getElementById('jane-age');
                            if (ageEl) ageEl.textContent = uptimeStr;
                            const ageSlim = document.getElementById('jane-age-slim');
                            if (ageSlim) ageSlim.textContent = 'Age: ' + uptimeStr;
                        }
                    }
                    
                    // System health
                    if (system) {
                        const cpuVal = (system.cpu || 0) + '%';
                        const ramVal = (system.memory || 0) + '%';
                        const cpuEl = document.getElementById('cpu-usage');
                        if (cpuEl) cpuEl.textContent = cpuVal;
                        const ramEl = document.getElementById('ram-usage');
                        if (ramEl) ramEl.textContent = ramVal;
                        const cpuSlim = document.getElementById('cpu-slim');
                        if (cpuSlim) cpuSlim.textContent = 'CPU: ' + cpuVal;
                        const ramSlim = document.getElementById('ram-slim');
                        if (ramSlim) ramSlim.textContent = 'RAM: ' + ramVal;
                        // Mini #2 status
                        const mini2Slim = document.getElementById('mini2-slim');
                        if (mini2Slim && system.mini2) {
                            if (system.mini2.online) {
                                mini2Slim.textContent = 'Mini2: âœ“';
                                mini2Slim.className = 'status-slim-pill green';
                                mini2Slim.title = `Mini #2: CPU ${system.mini2.cpu}% Â· RAM ${system.mini2.memory}% Â· Ollama: ${(system.mini2.ollamaModels||[]).join(', ')}`;
                            } else {
                                mini2Slim.textContent = 'Mini2: âœ—';
                                mini2Slim.className = 'status-slim-pill red';
                                mini2Slim.title = 'Mini #2: Offline';
                            }
                        }
                        // Uptime from system API
                        if (system.uptime) {
                            const ageEl = document.getElementById('jane-age');
                            if (ageEl) ageEl.textContent = system.uptime;
                            const ageSlim = document.getElementById('jane-age-slim');
                            if (ageSlim) ageSlim.textContent = 'Age: ' + system.uptime;
                        }
                    }
                    
                    addThought("System metrics updated.");
                    const el = document.getElementById('status-refresh');
                    if (el) el.textContent = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                } catch (err) {
                    console.error('System refresh error:', err);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // Sessions (Dashboard Ops)
        async function refreshAgents(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/sessions');
                    const container = document.getElementById('ops-sessions-list');
                    
                    if (!data?.sessions?.length) {
                        container.innerHTML = '<span style="opacity:0.5;font-size:0.65rem;">No active sessions</span>';
                        return;
                    }
                    
                    const sessionTags = data.sessions.map(s => {
                        const isActive = s.status === 'active';
                        // Generate friendly name from session key
                        let name = s.displayName;
                        if (!name) {
                            const parts = s.key.split(':');
                            // Handle different session types
                            if (parts.includes('cron')) name = 'Cron Job';
                            else if (parts.includes('dashboard')) name = 'Dashboard';
                            else if (parts.includes('test')) name = 'Test';
                            else if (parts.includes('spawn')) name = 'Sub-Agent';
                            else name = parts[parts.length - 1];
                            // Don't show UUIDs
                            if (name.match(/^[0-9a-f]{8}-/i)) name = 'Background';
                        }
                        const shortName = name.length > 15 ? name.substring(0, 15) + '...' : name;
                        return `<div class="ops-session-tag ${isActive ? 'active' : 'idle'}" title="${s.key} (${s.contextUsed || '--'})">
                            <span class="ops-session-dot"></span>
                            <span>${shortName}</span>
                        </div>`;
                    }).join('');
                    
                    container.innerHTML = sessionTags;
                } catch (err) {
                    console.error('Sessions refresh error:', err);
                    const container = document.getElementById('ops-sessions-list');
                    if (container) container.innerHTML = '<span style="opacity:0.5;font-size:0.65rem;">Error loading sessions</span>';
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // Categorize predictions (from mobile)
        function categorizePrediction(q) {
            const ql = q.toLowerCase();
            // Politics FIRST
            if (ql.includes('trump') || ql.includes('biden') || ql.includes('president') || 
                ql.includes('government') || ql.includes('congress') || ql.includes('iran') ||
                ql.includes('war') || ql.includes('russia') || ql.includes('china') ||
                ql.includes('election') || ql.includes('shutdown') || ql.includes('primary') ||
                ql.includes('governor') || ql.includes('senator') || ql.includes('attorney general') ||
                ql.includes('paxton') || ql.includes('democrat') || ql.includes('republican') ||
                ql.includes('vote') || ql.includes('ballot') || ql.includes('nominee')) {
                return 'politics';
            }
            // Sports
            if (ql.includes('super bowl') || ql.includes('nfl') || ql.includes('nba') || 
                ql.includes('vs') || ql.includes('ðŸˆ') || ql.includes('nhl') ||
                ql.includes('game') || ql.includes('championship') || ql.includes('playoffs')) {
                return 'sports';
            }
            // M&A
            if (ql.includes('acquire') || ql.includes('acquisition') || ql.includes('merger') ||
                ql.includes('buyout') || ql.includes('takeover')) {
                return 'manda';
            }
            // Finance/Crypto
            if (ql.includes('bitcoin') || ql.includes('crypto') || ql.includes('btc') || 
                ql.includes('eth') || ql.includes('solana') || ql.includes('price')) {
                return 'crypto';
            }
            if (ql.includes('ai') || ql.includes('openai') || ql.includes('google') || 
                ql.includes('apple') || ql.includes('ipo') || ql.includes('stock') ||
                ql.includes('fed') || ql.includes('rate') || ql.includes('recession') ||
                ql.includes('earnings') || ql.includes('ceo') || ql.includes('microsoft') ||
                ql.includes('nvidia') || ql.includes('tesla') || ql.includes('tariff')) {
                return 'finance';
            }
            return 'other';
        }
        
        function getPredictionTag(cat) {
            // SVG icons for each category (green, minimal)
            const icons = {
                politics: `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M12 2L2 7v2h20V7L12 2zm0 2.5L18 7H6l6-2.5zM4 10v10h2v-8h2v8h2v-8h2v8h2v-8h2v8h2V10H4zm-2 12h20v2H2v-2z"/></svg>`,
                sports: `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17.93c-3.94-.49-7-3.85-7-7.93s3.05-7.44 7-7.93v15.86zm2-15.86c3.94.49 7 3.85 7 7.93s-3.06 7.44-7 7.93V4.07z"/></svg>`,
                manda: `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>`,
                crypto: `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09v1.04h-1.18v-1.04c-1.83-.11-2.92-1.12-2.92-2.25h1.49c0 .5.42 1.14 1.8 1.14 1.12 0 1.8-.44 1.8-1.17 0-.74-.54-.9-1.89-1.24-1.92-.45-2.84-1.08-2.84-2.4 0-1.25 1.04-2.08 2.56-2.24V8.87h1.18v1.07c1.63.21 2.45 1.19 2.5 2.19h-1.49c-.05-.65-.54-1.04-1.36-1.04-1.06 0-1.56.49-1.56 1.06 0 .66.45.89 1.81 1.17 2.09.45 2.92 1.16 2.92 2.48 0 1.33-1.02 2.14-2.82 2.29z"/></svg>`,
                finance: `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M5 9.2h3V19H5V9.2zM10.6 5h2.8v14h-2.8V5zm5.6 8H19v6h-2.8v-6z"/></svg>`,
                other: `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>`
            };
            const labels = {
                politics: 'Politics',
                sports: 'Sports',
                manda: 'M&A',
                crypto: 'Crypto',
                finance: 'Finance',
                other: 'Other'
            };
            return { 
                label: `${icons[cat] || icons.other}${labels[cat] || 'Other'}`, 
                class: cat 
            };
        }
        
        // Filter out sports games (keep Super Bowl)
        function shouldShowPrediction(q) {
            const ql = q.toLowerCase();
            // Always show Super Bowl
            if (ql.includes('super bowl')) return true;
            
            // Basketball teams to filter
            const nbaTeams = ['cavaliers', 'clippers', 'grizzlies', 'kings', 'spurs', 'lakers', 
                'celtics', 'heat', 'warriors', 'nets', 'knicks', 'bulls', 'mavericks', 'nuggets',
                'rockets', 'thunder', 'suns', 'jazz', 'pelicans', 'hawks', 'hornets', 'pistons',
                'pacers', 'bucks', 'timberwolves', 'blazers', 'raptors', 'wizards', 'magic', '76ers'];
            
            // Soccer teams/leagues to filter
            const soccerTerms = ['premier league', 'la liga', 'bundesliga', 'serie a', 'ligue 1',
                'champions league', 'europa league', 'manchester', 'liverpool', 'chelsea', 'arsenal',
                'tottenham', 'barcelona', 'real madrid', 'bayern', 'juventus', 'psg', 'inter milan',
                'ac milan', 'man city', 'man united', 'mls', 'soccer', 'football club', 'fc '];
            
            // NHL teams
            const nhlTeams = ['wild', 'predators', 'bruins', 'rangers', 'penguins', 'capitals',
                'blackhawks', 'red wings', 'maple leafs', 'canadiens', 'oilers', 'flames', 'canucks'];
            
            // Filter out sports matches
            if (ql.includes('vs.') || ql.includes('vs ') || ql.includes('spread') || ql.includes('moneyline')) {
                return false;
            }
            
            // Filter by team names
            for (const team of [...nbaTeams, ...soccerTerms, ...nhlTeams]) {
                if (ql.includes(team)) return false;
            }
            
            return true;
        }
        
        // Predictions
        async function refreshPredictions(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/predictions', 12000);
                    const container = document.getElementById('predictions-list');
                    
                    if (!data?.markets?.length) {
                        container.innerHTML = '<div class="prediction-item"><span class="prediction-question">No markets available</span></div>';
                        return;
                    }
                    
                    // Filter and categorize
                    const filtered = data.markets.filter(m => shouldShowPrediction(m.question));
                    
                    // Find Super Bowl predictions first (pinned to top)
                    const superBowl = filtered.filter(m => m.question.toLowerCase().includes('super bowl'));
                    const nonSuperBowl = filtered.filter(m => !m.question.toLowerCase().includes('super bowl'));
                    
                    // Group non-Super Bowl by category
                    const groups = { politics: [], crypto: [], finance: [], manda: [], other: [] };
                    nonSuperBowl.forEach(m => {
                        const cat = categorizePrediction(m.question);
                        if (cat !== 'sports' && groups[cat]) {
                            groups[cat].push({ ...m, category: cat });
                        }
                    });
                    
                    // Source logos and URLs - all use favicon.ico with invert filter (same as header)
                    const sourceInfo = {
                        'Polymarket': { logo: 'https://polymarket.com/favicon.ico', url: slug => `https://polymarket.com/event/${slug}` },
                        'Manifold': { logo: 'https://manifold.markets/favicon.ico', url: slug => `https://manifold.markets/${slug}` },
                        'Kalshi': { logo: 'https://kalshi.com/favicon.ico', url: slug => `https://kalshi.com/markets/${slug}` },
                        'Metaculus': { logo: 'https://www.metaculus.com/favicon.ico', url: slug => `https://www.metaculus.com/questions/${slug?.replace('metaculus-','')}` }
                    };
                    
                    // Helper to format volume (e.g., 1500000 -> $1.5M)
                    const formatVolume = (vol) => {
                        if (!vol || vol < 1000) return vol ? `$${vol}` : '';
                        if (vol >= 1000000) return `$${(vol / 1000000).toFixed(1)}M`;
                        if (vol >= 1000) return `$${(vol / 1000).toFixed(0)}K`;
                        return `$${vol}`;
                    };
                    
                    // Helper to render a prediction item with source logo
                    const renderPrediction = (m) => {
                        const source = m.source || 'Polymarket';
                        const info = sourceInfo[source] || sourceInfo['Polymarket'];
                        const url = info.url(m.slug);
                        const volume = m.volume24h ? formatVolume(m.volume24h) : '';
                        const logoClass = 'prediction-source-logo logo-invert';
                        return `
                            <div class="prediction-item" onclick="window.open('${url}', '_blank')">
                                <div class="prediction-main">
                                    <span class="prediction-question">${m.question}</span>
                                    <div class="prediction-meta">
                                        ${volume ? `<span class="prediction-volume">${volume}</span>` : ''}
                                        <img src="${info.logo}" alt="${source}" class="${logoClass}" title="${source}">
                                    </div>
                                </div>
                                <div class="prediction-odds">
                                    <span class="odds-badge odds-yes">${m.yesOdds}%</span>
                                    <span class="odds-badge odds-no">${m.noOdds}%</span>
                                </div>
                            </div>
                        `;
                    };
                    
                    // Render - Super Bowl first
                    let html = '';
                    const footballIcon = `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M2.5 12c0-5.25 4.25-9.5 9.5-9.5s9.5 4.25 9.5 9.5-4.25 9.5-9.5 9.5-9.5-4.25-9.5-9.5zm4.3 4.5l2.35-2.35c-.3-.75-.5-1.55-.5-2.15 0-1.1.4-2 1.15-2.75L7.45 7C5.7 8.35 4.5 10.05 4.5 12c0 1.75.9 3.4 2.3 4.5zm10.4-9L14.85 9.85c.3.75.5 1.55.5 2.15 0 1.1-.4 2-1.15 2.75l2.35 2.35c1.75-1.35 2.95-3.05 2.95-5.1 0-1.75-.9-3.4-2.3-4.5zm-5.2.65c-.55 0-1 .45-1 1v.7l-.35.35-.35-.35v-.7c0-.55-.45-1-1-1s-1 .45-1 1v2.1l1.7 1.7v2.1c0 .55.45 1 1 1s1-.45 1-1v-2.1l1.7-1.7v-2.1c0-.55-.45-1-1-1z"/></svg>`;
                    if (superBowl.length) {
                        html += `<div class="prediction-category">${footballIcon}Super Bowl</div>`;
                        superBowl.slice(0, 3).forEach(m => { html += renderPrediction(m); });
                    }
                    
                    // Then other categories - M&A prioritized
                    const order = ['manda', 'politics', 'finance', 'crypto', 'other'];
                    order.forEach(cat => {
                        if (groups[cat]?.length) {
                            const tag = getPredictionTag(cat);
                            html += `<div class="prediction-category">${tag.label}</div>`;
                            // Show more items for M&A
                            const limit = cat === 'manda' ? 5 : 4;
                            groups[cat].slice(0, limit).forEach(m => { html += renderPrediction(m); });
                        }
                    });
                    
                    container.innerHTML = html || '<div class="prediction-item">No markets available</div>';
                    const el = document.getElementById('predictions-refresh');
                    const timeStr = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                    if (el) el.textContent = timeStr;
                    // Log to Dashboard Ops
                    addThought(`Predictions updated @ ${timeStr} (${filtered.length} markets)`);
                } catch (err) {
                    console.error('Predictions refresh error:', err);
                    addThought(`Predictions error: ${err.message}`);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // AI News
        let newsCache = { enterprise: [], retail: [] };
        
        async function refreshNews(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/ai-news', 10000);
                    
                    newsCache.enterprise = (data.agenticEnterprise || []).map(item => ({
                        title: item.title,
                        source: item.source,
                        date: item.date,
                        link: item.link
                    }));
                    
                    newsCache.retail = (data.agenticRetail || []).map(item => ({
                        title: item.title,
                        source: item.source,
                        date: item.date,
                        link: item.link
                    }));
                    
                    if (data.featured) {
                        newsCache.enterprise.unshift({
                            title: data.featured.title,
                            source: data.featured.source,
                            date: data.featured.date,
                            link: data.featured.link,
                            featured: true
                        });
                    }
                    
                    renderNews();
                    const el = document.getElementById('news-refresh');
                    const timeStr = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                    if (el) el.textContent = timeStr;
                    // Log to Dashboard Ops
                    const totalNews = (newsCache.enterprise?.length || 0) + (newsCache.retail?.length || 0);
                    addThought(`AI News updated @ ${timeStr} (${totalNews} articles)`);
                } catch (err) {
                    console.error('News refresh error:', err);
                    addThought(`AI News error: ${err.message}`);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        function renderNews() {
            // Render both columns
            ['enterprise', 'retail'].forEach(tab => {
                const items = newsCache[tab] || [];
                const container = document.getElementById(`news-${tab}`);
                if (!container) return;
                
                container.innerHTML = items.slice(0, 5).map(item => `
                    <div class="news-item" onclick="window.open('${item.link}', '_blank')">
                        <div class="news-headline">${item.title}</div>
                        <div class="news-meta">${item.source} â€¢ ${item.date}</div>
                    </div>
                `).join('') || '<div class="news-item">No news available</div>';
            });
        }
        
        // TikTok
        // Request a fresh TikTok scrape (triggers cron job within 5 min)
        async function requestTikTokUpdate(btn) {
            const pendingEl = document.getElementById('tiktok-pending');
            try {
                // Show pending state
                if (pendingEl) pendingEl.style.display = 'inline';
                
                // Request the update
                const response = await fetch('/api/tiktok-request-update');
                const data = await response.json();
                
                // Also refresh current data
                await refreshTikTok();
                
                // Keep pending visible for a bit, then start polling
                setTimeout(() => {
                    if (pendingEl) pendingEl.style.display = 'none';
                }, 5 * 60 * 1000); // Hide after 5 minutes
                
                // Poll for updates every 30 seconds for 5 minutes
                let pollCount = 0;
                const pollInterval = setInterval(async () => {
                    pollCount++;
                    await refreshTikTok();
                    if (pollCount >= 10) { // Stop after 10 polls (5 min)
                        clearInterval(pollInterval);
                        if (pendingEl) pendingEl.style.display = 'none';
                    }
                }, 30000);
                
            } catch (err) {
                console.error('TikTok update request error:', err);
                if (pendingEl) pendingEl.style.display = 'none';
            }
            if (btn) btn.classList.remove('spinning');
        }
        
        async function refreshTikTok(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/tiktok');
                    const profile = data.profile || data;
                    const changes = data.changes24h || {};
                    
                    const followersEl = document.getElementById('tiktok-followers');
                    const likesEl = document.getElementById('tiktok-likes');
                    const viewsEl = document.getElementById('tiktok-views');
                    const followersDeltaEl = document.getElementById('tiktok-followers-delta');
                    const likesDeltaEl = document.getElementById('tiktok-likes-delta');
                    const viewsDeltaEl = document.getElementById('tiktok-views-delta');
                    const videosEl = document.getElementById('tiktok-videos');
                    
                    // Format large numbers (e.g., 45900 -> 45.9K)
                    const formatNum = (n) => {
                        if (!n) return '0';
                        if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
                        if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
                        return n.toLocaleString();
                    };
                    
                    // Update main values
                    if (followersEl) followersEl.textContent = (profile.followers || 0).toLocaleString();
                    if (likesEl) likesEl.textContent = (profile.likes || profile.totalLikes || 0).toLocaleString();
                    if (viewsEl) viewsEl.textContent = formatNum(data.totalViews || 0);
                    
                    // Update delta values (changes since midnight)
                    const formatDelta = (val) => {
                        if (!val || val === 0) return { text: 'â€”', class: 'neutral' };
                        const sign = val > 0 ? '+' : '';
                        return { 
                            text: `${sign}${val.toLocaleString()} today`, 
                            class: val > 0 ? 'positive' : 'negative' 
                        };
                    };
                    
                    if (followersDeltaEl) {
                        const d = formatDelta(changes.followers);
                        followersDeltaEl.textContent = d.text;
                        followersDeltaEl.className = `tiktok-stat-delta ${d.class}`;
                    }
                    if (likesDeltaEl) {
                        const d = formatDelta(changes.likes);
                        likesDeltaEl.textContent = d.text;
                        likesDeltaEl.className = `tiktok-stat-delta ${d.class}`;
                    }
                    if (viewsDeltaEl) {
                        const d = formatDelta(changes.views);
                        viewsDeltaEl.textContent = d.text;
                        viewsDeltaEl.className = `tiktok-stat-delta ${d.class}`;
                    }
                    
                    const videos = data.recentVideos || [];
                    if (videosEl) {
                        videosEl.innerHTML = videos.slice(0, 6).map(v => `
                            <div class="tiktok-video">
                                <span>${v.title || 'Video'}</span>
                                <span class="tiktok-video-views">${typeof v.views === 'number' ? v.views.toLocaleString() : v.views}</span>
                            </div>
                        `).join('') || '<div class="tiktok-video">No videos yet</div>';
                    }
                    const el = document.getElementById('tiktok-refresh');
                    if (el) el.textContent = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                } catch (err) {
                    console.error('TikTok refresh error:', err);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // Sorare
        async function refreshSorare(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/sorare');
                    
                    // Limited cards count
                    document.getElementById('sorare-limited-count').textContent = data.limitedCards || 0;
                    
                    // Current fixture status
                    const current = data.currentFixture || {};
                    const leaderboard = current.leaderboard || {};
                    
                    document.getElementById('sorare-gw').textContent = current.gameWeek ? `GW${current.gameWeek}` : 'GW--';
                    document.getElementById('sorare-field-size').textContent = leaderboard.totalLineups?.toLocaleString() || '--';
                    
                    // Calculate countdown and status
                    const now = new Date();
                    const start = current.startDate ? new Date(current.startDate) : null;
                    const end = current.endDate ? new Date(current.endDate) : null;
                    
                    let status = 'scheduled';
                    let countdown = '';
                    
                    if (start && end) {
                        if (now < start) {
                            const diff = start - now;
                            const hours = Math.floor(diff / 3600000);
                            const mins = Math.floor((diff % 3600000) / 60000);
                            countdown = `Starts in ${hours}h ${mins}m`;
                            status = 'scheduled';
                        } else if (now >= start && now < end) {
                            const diff = end - now;
                            const hours = Math.floor(diff / 3600000);
                            const mins = Math.floor((diff % 3600000) / 60000);
                            countdown = `${hours}h ${mins}m left`;
                            status = hours < 6 ? 'ending' : 'live';
                        } else {
                            countdown = 'Completed';
                            status = 'final';
                        }
                    }
                    
                    document.getElementById('sorare-countdown').textContent = countdown;
                    document.getElementById('sorare-countdown').className = `sorare-countdown ${status}`;
                    
                    const statusEl = document.getElementById('sorare-status');
                    statusEl.textContent = status.toUpperCase();
                    statusEl.className = `sorare-status-badge ${status}`;
                    
                    // Render lineups
                    const lineupsEl = document.getElementById('sorare-lineups');
                    const lineups = leaderboard.myLineups || [];
                    
                    if (lineups.length > 0) {
                        lineupsEl.innerHTML = lineups.map(l => {
                            const players = l.players || [];
                            const isLive = players.some(p => p.status === 'playing');
                            const cardClass = isLive ? 'sorare-lineup-card live' : 'sorare-lineup-card';
                            
                            const rankDisplay = l.ranking ? `#${l.ranking}` : '--';
                            const scoreDisplay = l.score > 0 ? `${l.score.toFixed(1)} pts` : 'Scheduled';
                            
                            const playerTags = players.map(p => {
                                const lastName = p.name?.split(' ').pop() || '?';
                                const playerClass = p.status === 'playing' ? 'sorare-player playing' : 
                                                   p.status === 'final' ? 'sorare-player final' : 'sorare-player';
                                const scoreTag = p.score > 0 ? ` (${p.score.toFixed(0)})` : '';
                                return `<span class="${playerClass}">${lastName}${scoreTag}</span>`;
                            }).join('');
                            
                            return `
                                <div class="${cardClass}">
                                    <div class="sorare-lineup-header">
                                        <span class="sorare-lineup-num">Lineup ${l.number}</span>
                                        <span class="sorare-lineup-rank">${rankDisplay}</span>
                                        <span class="sorare-lineup-score">${scoreDisplay}</span>
                                    </div>
                                    <div class="sorare-lineup-players">${playerTags}</div>
                                </div>
                            `;
                        }).join('');
                    } else {
                        lineupsEl.innerHTML = '<div class="sorare-lineup-card"><div style="text-align:center; color:var(--text-dim); font-size:0.7rem; padding:0.5rem;">No lineups registered</div></div>';
                    }
                    
                    // Last completed best rank
                    const completed = data.completedFixture || {};
                    document.getElementById('sorare-last-best').textContent = completed.bestRank ? `#${completed.bestRank}` : '--';
                    
                    const el = document.getElementById('sorare-refresh');
                    if (el) el.textContent = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                } catch (err) {
                    console.error('Sorare refresh error:', err);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // Tasks
        async function refreshTasks(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/tasks');
                    
                    const inProgress = data.inProgress || [];
                    const completed = data.completed || [];
                    
                    const pinIcon = `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"/></svg>`;
                    const sparkIcon = `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M12 3L9 9H3l5 4-2 7 6-4 6 4-2-7 5-4h-6z"/></svg>`;
                    const checkIcon = `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>`;
                    const noteIcon = `<svg class="cat-icon" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>`;
                    
                    document.getElementById('tasks-inprogress').innerHTML = inProgress.map(t => `
                        <div class="task-item">
                            <span class="task-icon">${t.icon ? t.icon.replace(/[\u{1F300}-\u{1F9FF}]/gu, pinIcon) : pinIcon}</span>
                            <span class="task-name">${t.task}</span>
                        </div>
                    `).join('') || `<div class="task-item"><span class="task-icon">${sparkIcon}</span><span class="task-name">No tasks in progress</span></div>`;
                    
                    document.getElementById('tasks-completed').innerHTML = completed.slice(0, 5).map(t => `
                        <div class="task-item task-completed">
                            <span class="task-icon">${t.icon ? t.icon.replace(/[\u{1F300}-\u{1F9FF}]/gu, checkIcon) : checkIcon}</span>
                            <span class="task-name">${t.task}</span>
                        </div>
                    `).join('') || `<div class="task-item"><span class="task-icon">${noteIcon}</span><span class="task-name">No completed tasks</span></div>`;
                } catch (err) {
                    console.error('Tasks refresh error:', err);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // Cron Jobs
        async function refreshCron(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/cron');
                    const container = document.getElementById('cron-list');
                    
                    if (!data?.jobs?.length) {
                        container.innerHTML = '<div class="cron-item"><span class="cron-name">No scheduled jobs</span></div>';
                        return;
                    }
                    
                    container.innerHTML = data.jobs.slice(0, 6).map(job => `
                        <div class="cron-item">
                            <span class="cron-name">${job.name || job.id}</span>
                            <span class="cron-schedule">${job.schedule?.expr || job.schedule?.kind || '--'}</span>
                        </div>
                    `).join('');
                } catch (err) {
                    console.error('Cron refresh error:', err);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // ===== MEME COIN TRACKER =====
        async function refreshMemecoins(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/memecoins', 15000);
                    const container = document.getElementById('memecoins-list');
                    const refreshEl = document.getElementById('memecoins-refresh');
                    
                    if (!data?.memecoins?.length) {
                        container.innerHTML = '<div class="memecoin-item loading"><span>No memecoins found matching criteria</span></div>';
                        return;
                    }
                    
                    // Format helpers
                    const formatPrice = (p) => {
                        if (p < 0.0001) return '$' + p.toExponential(2);
                        if (p < 0.01) return '$' + p.toFixed(6);
                        if (p < 1) return '$' + p.toFixed(4);
                        return '$' + p.toFixed(2);
                    };
                    
                    const formatVolume = (v) => {
                        if (v >= 1000000) return '$' + (v/1000000).toFixed(1) + 'M';
                        if (v >= 1000) return '$' + (v/1000).toFixed(0) + 'K';
                        return '$' + v.toFixed(0);
                    };
                    
                    const formatMcap = (m) => {
                        if (m >= 1000000) return '$' + (m/1000000).toFixed(1) + 'M';
                        if (m >= 1000) return '$' + (m/1000).toFixed(0) + 'K';
                        return '$' + m.toFixed(0);
                    };
                    
                    container.innerHTML = data.memecoins.map((coin, i) => {
                        const changeClass = coin.priceChange24h >= 0 ? 'positive' : 'negative';
                        const changeSign = coin.priceChange24h >= 0 ? '+' : '';
                        const chainIcon = coin.chain === 'solana' ? 'â—Ž' : coin.chain === 'base' ? 'ðŸ”µ' : 'âŸ ';
                        const iconHtml = coin.imageUrl 
                            ? `<img src="${coin.imageUrl}" alt="${coin.symbol}" class="memecoin-icon" onerror="this.outerHTML='<span class=\\'memecoin-icon-placeholder\\'>${coin.symbol.charAt(0)}</span>'">`
                            : `<span class="memecoin-icon-placeholder">${coin.symbol.charAt(0)}</span>`;
                        
                        return `
                            <a href="${coin.dexUrl}" target="_blank" class="memecoin-item" title="View on DEX Screener">
                                <span class="memecoin-rank">#${i + 1}</span>
                                ${iconHtml}
                                <div class="memecoin-info">
                                    <span class="memecoin-name">${coin.symbol}</span>
                                    <span class="memecoin-symbol">${coin.name.substring(0, 18)}</span>
                                </div>
                                <div class="memecoin-age">
                                    <div class="memecoin-age-value">${coin.age || '?'}</div>
                                </div>
                                <div class="memecoin-volume">
                                    <div class="memecoin-volume-label">Vol</div>
                                    <div class="memecoin-volume-value">${formatVolume(coin.volume24h)}</div>
                                </div>
                                <div class="memecoin-mcap">
                                    <div class="memecoin-mcap-value">${formatMcap(coin.marketCap)}</div>
                                    <div class="memecoin-mcap-change ${changeClass}">${changeSign}${coin.priceChange24h.toFixed(1)}%</div>
                                </div>
                            </a>
                        `;
                    }).join('');
                    
                    if (refreshEl && data.lastUpdated) {
                        const time = new Date(data.lastUpdated).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                        refreshEl.textContent = time;
                    }
                } catch (err) {
                    console.error('Memecoins refresh error:', err);
                    const container = document.getElementById('memecoins-list');
                    container.innerHTML = '<div class="memecoin-item loading"><span>Failed to load memecoins</span></div>';
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }
        
        // ===== KALSHI POSITIONS =====
        function toggleSettledPopup(e) {
            e.stopPropagation();
            const popup = document.getElementById('kalshi-settled-popup');
            popup.classList.toggle('visible');
            // Close on outside click
            if (popup.classList.contains('visible')) {
                setTimeout(() => {
                    document.addEventListener('click', function closePopup() {
                        popup.classList.remove('visible');
                        document.removeEventListener('click', closePopup);
                    }, { once: true });
                }, 10);
            }
        }

        async function refreshKalshi(btn) {
            const doRefresh = async () => {
                try {
                    const data = await fetchWithTimeout('/api/kalshi/positions', 10000);
                    const listEl = document.getElementById('kalshi-bets-list');
                    const balanceEl = document.getElementById('kalshi-balance');
                    const popupEl = document.getElementById('kalshi-settled-popup');

                    // Balance
                    if (data.balance !== undefined) {
                        balanceEl.textContent = 'â€¢ $' + (data.balance / 100).toFixed(2);
                    }

                    // Active bets
                    const active = data.active || [];
                    if (active.length === 0) {
                        listEl.innerHTML = '<div class="kalshi-no-bets">No active bets</div>';
                    } else {
                        listEl.innerHTML = active.map(bet => {
                            const sideClass = bet.side === 'yes' ? 'kalshi-side-yes' : 'kalshi-side-no';
                            const pnlVal = bet.pnl || 0;
                            const pnlClass = pnlVal >= 0 ? 'positive' : 'negative';
                            const pnlSign = pnlVal >= 0 ? '+' : '';
                            return `<div class="kalshi-bet-item">
                                <span class="kalshi-bet-name">${bet.name}</span>
                                <div class="kalshi-bet-meta">
                                    <span class="kalshi-side-badge ${sideClass}">${bet.side.toUpperCase()}</span>
                                    <span class="kalshi-pnl ${pnlClass}">${pnlSign}$${(Math.abs(pnlVal) / 100).toFixed(2)}</span>
                                </div>
                            </div>`;
                        }).join('');
                    }

                    // Settled bets popup
                    const settled = data.settled || [];
                    let popupHtml = '<div class="kalshi-settled-title">Settled Bets</div>';
                    if (settled.length === 0) {
                        popupHtml += '<div class="kalshi-no-bets">No settled bets</div>';
                    } else {
                        popupHtml += settled.slice(0, 15).map(bet => {
                            const pnlVal = bet.pnl || 0;
                            const pnlClass = pnlVal >= 0 ? 'positive' : 'negative';
                            const pnlSign = pnlVal >= 0 ? '+' : '';
                            return `<div class="kalshi-bet-item">
                                <span class="kalshi-bet-name">${bet.name}</span>
                                <span class="kalshi-pnl ${pnlClass}">${pnlSign}$${(Math.abs(pnlVal) / 100).toFixed(2)}</span>
                            </div>`;
                        }).join('');
                    }
                    popupEl.innerHTML = popupHtml;
                } catch (err) {
                    console.error('Kalshi refresh error:', err);
                }
            };
            if (btn) spinButton(btn, doRefresh());
            else doRefresh();
        }

        // ===== JANE'S MIND (Real Reasoning) =====
        let mindState = {
            task: null,
            steps: [],
            thought: 'Ready for your next request.'
        };
        
        // Brain map configuration â€” diamond layout (tall vertical)
        // Positions defined as offsets from center (100, 190) in viewBox 200x380
        var brainRegions = [
            { name: 'Language',  dx: 0,   dy: -155 },  // top point
            { name: 'Reasoning', dx: 55,  dy: -110 },  // upper right
            { name: 'Research',  dx: 80,  dy: -40 },   // mid right upper
            { name: 'Vision',    dx: 55,  dy: 30 },    // mid right lower
            { name: 'Planning',  dx: 0,   dy: 155 },   // bottom point
            { name: 'Market',    dx: -55, dy: 30 },     // mid left lower
            { name: 'Execution', dx: -80, dy: -40 },    // mid left upper
            { name: 'Memory',    dx: -55, dy: -110 }    // upper left
        ];
        var brainToolColors = {
            'opus': '#4ade80', 'claude': '#4ade80',
            'sonnet': '#8b5cf6',
            'whisper': '#facc15',
            'ollama': '#f97316',
            'stable-diffusion': '#ec4899', 'sd': '#ec4899', 'image': '#ec4899',
            'default': 'rgba(74,222,128,0.3)'
        };
        var brainToolToRegion = {
            'opus': 'Reasoning', 'claude': 'Reasoning', 'sonnet': 'Reasoning',
            'whisper': 'Language', 'ollama': 'Reasoning',
            'stable-diffusion': 'Vision', 'sd': 'Vision', 'image': 'Vision',
            'web_search': 'Research', 'web_fetch': 'Research',
            'browser': 'Research', 'exec': 'Execution', 'read': 'Memory', 'write': 'Execution',
            'edit': 'Execution', 'tts': 'Language', 'message': 'Language',
            'trading': 'Market', 'kalshi': 'Market', 'sorare': 'Market',
            'cron': 'Planning', 'sessions_spawn': 'Planning'
        };
        var activeRegions = new Set();

        function initBrainMap() {
            const cx = 100, cy = 190;
            const linesG = document.getElementById('brain-lines');
            const nodesG = document.getElementById('brain-nodes');
            linesG.innerHTML = '';
            nodesG.innerHTML = '';

            brainRegions.forEach((region, i) => {
                const x = cx + region.dx;
                const y = cy + region.dy;
                region.x = x; region.y = y;

                // Line â€” thin, precise
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', cx); line.setAttribute('y1', cy);
                line.setAttribute('x2', x); line.setAttribute('y2', y);
                line.setAttribute('stroke', 'rgba(74,222,128,0.08)');
                line.setAttribute('stroke-width', '0.5');
                line.setAttribute('stroke-dasharray', '2 3');
                line.setAttribute('id', `brain-line-${i}`);
                line.classList.add('brain-line');
                linesG.appendChild(line);

                // Small endpoint tick mark at the node
                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                const angle = Math.atan2(region.dy, region.dx);
                const perpX = Math.cos(angle + Math.PI/2) * 4;
                const perpY = Math.sin(angle + Math.PI/2) * 4;
                tick.setAttribute('x1', x - perpX); tick.setAttribute('y1', y - perpY);
                tick.setAttribute('x2', x + perpX); tick.setAttribute('y2', y + perpY);
                tick.setAttribute('stroke', 'rgba(74,222,128,0.12)');
                tick.setAttribute('stroke-width', '0.5');
                linesG.appendChild(tick);

                // Node â€” small precise dot
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x); circle.setAttribute('cy', y);
                circle.setAttribute('r', '2.5');
                circle.setAttribute('fill', 'rgba(74,222,128,0.3)');
                circle.setAttribute('stroke', 'rgba(74,222,128,0.15)');
                circle.setAttribute('stroke-width', '0.5');
                circle.setAttribute('id', `brain-node-${i}`);
                circle.classList.add('brain-node-circle');
                nodesG.appendChild(circle);

                // Label â€” monospace, offset
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', y + (y < cy ? -10 : 14));
                label.textContent = region.name;
                label.classList.add('brain-node-label');
                label.setAttribute('id', `brain-label-${i}`);
                nodesG.appendChild(label);
            });
        }

        function activateBrainRegion(regionName, color) {
            const idx = brainRegions.findIndex(r => r.name === regionName);
            if (idx === -1) return;
            const node = document.getElementById(`brain-node-${idx}`);
            const line = document.getElementById(`brain-line-${idx}`);
            const label = document.getElementById(`brain-label-${idx}`);
            if (node) {
                node.setAttribute('fill', color.replace(')', ',0.3)').replace('rgb', 'rgba').replace('rgba(', 'rgba(').replace('#', ''));
                // Simpler: just set fill and stroke
                node.setAttribute('fill', color); node.setAttribute('fill-opacity', '0.8'); node.setAttribute('filter', 'drop-shadow(0 0 6px ' + color + ')');
                node.setAttribute('stroke', 'none');
                node.setAttribute('r', '5');
            }
            if (line) { line.setAttribute('stroke', color); line.setAttribute('stroke-opacity', '0.6'); line.setAttribute('stroke-width', '0.5'); }
            if (label) { label.setAttribute('fill', 'rgba(255,255,255,1)'); label.setAttribute('font-size', '6'); }
            activeRegions.add(regionName);
            // Spawn a pulse dot
            spawnPulseDot(idx, color);
        }

        function resetBrainRegions() {
            brainRegions.forEach((_, i) => {
                const node = document.getElementById(`brain-node-${i}`);
                const line = document.getElementById(`brain-line-${i}`);
                const label = document.getElementById(`brain-label-${i}`);
                if (node) { node.setAttribute('fill', 'rgba(74,222,128,0.3)'); node.setAttribute('fill-opacity', '1'); node.setAttribute('stroke', 'none'); node.setAttribute('r', '2.5'); node.setAttribute('filter', 'none'); }
                if (line) { line.setAttribute('stroke', 'rgba(74,222,128,0.08)'); line.setAttribute('stroke-opacity', '1'); line.setAttribute('stroke-width', '0.5'); }
                if (label) { label.setAttribute('fill', 'rgba(255,255,255,0.5)'); }
            });
            activeRegions.clear();
            document.getElementById('brain-pulses').innerHTML = '';
        }

        function spawnPulseDot(idx, color) {
            const pulsesG = document.getElementById('brain-pulses');
            const r = brainRegions[idx];
            const cx = 100, cy = 190;
            // Create animated circle along line
            const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            dot.setAttribute('r', '1.5');
            dot.setAttribute('fill', color);
            dot.setAttribute('opacity', '0.8');
            // Animate from center to node
            const animX = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animX.setAttribute('attributeName', 'cx');
            animX.setAttribute('from', cx); animX.setAttribute('to', r.x);
            animX.setAttribute('dur', '1.2s'); animX.setAttribute('repeatCount', 'indefinite');
            const animY = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animY.setAttribute('attributeName', 'cy');
            animY.setAttribute('from', cy); animY.setAttribute('to', r.y);
            animY.setAttribute('dur', '1.2s'); animY.setAttribute('repeatCount', 'indefinite');
            const animO = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animO.setAttribute('attributeName', 'opacity');
            animO.setAttribute('values', '0.9;0.9;0'); animO.setAttribute('keyTimes', '0;0.7;1');
            animO.setAttribute('dur', '1.2s'); animO.setAttribute('repeatCount', 'indefinite');
            dot.appendChild(animX); dot.appendChild(animY); dot.appendChild(animO);
            pulsesG.appendChild(dot);
        }

        function getToolColor(tool) {
            if (!tool) return brainToolColors['default'];
            const t = tool.toLowerCase();
            for (const [key, color] of Object.entries(brainToolColors)) {
                if (t.includes(key)) return color;
            }
            return brainToolColors['default'];
        }

        function getToolRegion(tool) {
            if (!tool) return null;
            const t = tool.toLowerCase();
            for (const [key, region] of Object.entries(brainToolToRegion)) {
                if (t.includes(key)) return region;
            }
            return 'Analysis'; // default
        }

        function updateMind(task, steps, thought) {
            if (task !== undefined) {
                if (task) mindState.task = task;
                const taskEl = document.getElementById('mind-current-task');
                if (mindState.task) {
                    taskEl.textContent = mindState.task;
                    taskEl.classList.remove('waiting-dots');
                } else {
                    taskEl.textContent = 'Awaiting instructions';
                    taskEl.classList.add('waiting-dots');
                }
            }
            
            if (steps !== undefined && steps.length > 0) {
                mindState.steps = steps;
            }

            // Reset brain, then activate based on steps
            resetBrainRegions();
            const hasActive = mindState.steps && mindState.steps.some(s => s.status === 'active');
            const hub = document.getElementById('brain-hub');
            const brainSvg = document.getElementById('brain-map');
            if (hasActive || mindState.task) {
                hub.setAttribute('fill', 'rgba(74,222,128,0.3)');
                hub.setAttribute('stroke', 'rgba(74,222,128,0.9)');
                hub.setAttribute('r', '16');
                brainSvg.classList.remove('brain-idle');
                brainSvg.classList.add('brain-active');
            } else {
                hub.setAttribute('fill', 'rgba(74,222,128,0.15)');
                hub.setAttribute('stroke', 'rgba(74,222,128,0.5)');
                hub.setAttribute('r', '15');
                brainSvg.classList.remove('brain-active');
                brainSvg.classList.add('brain-idle');
            }

            if (mindState.steps && mindState.steps.length > 0) {
                const container = document.getElementById('mind-steps');
                const indicators = { done: 'âœ“', active: 'â—', pending: 'â—‹' };
                
                // Activate brain regions only when actively working (not idle with done steps)
                if (hasActive || mindState.task) {
                    mindState.steps.forEach(step => {
                        if (step.status === 'active' || step.status === 'done') {
                            const tool = step.tool || '';
                            const region = getToolRegion(tool);
                            const color = getToolColor(tool);
                            if (region) activateBrainRegion(region, color);
                        }
                    });
                }

                // Only show pulse dots for active steps
                document.getElementById('brain-pulses').innerHTML = '';
                mindState.steps.forEach(step => {
                    if (step.status === 'active') {
                        const tool = step.tool || '';
                        const region = getToolRegion(tool);
                        const color = getToolColor(tool);
                        const idx = brainRegions.findIndex(r => r.name === region);
                        if (idx !== -1) spawnPulseDot(idx, color);
                    }
                });

                const stepsHtml = mindState.steps.map(step => {
                    const status = step.status || 'pending';
                    const ind = indicators[status] || 'â—‹';
                    const stepText = step.text || step.label || '';
                    const tool = step.tool || '';
                    const color = getToolColor(tool);
                    const toolBadge = tool ? `<span class="step-tool" style="background:${color}22;color:${color}">${tool}</span>` : '';
                    const dotsClass = (status === 'active' && stepText.toLowerCase().includes('waiting')) ? ' waiting-dots' : '';
                    return `<div class="mind-step ${status}"><span class="step-indicator">${ind}</span><span class="${dotsClass}">${stepText}</span>${toolBadge}</div>`;
                }).join('');
                
                const allDone = mindState.steps.every(s => s.status === 'done');
                const waitingLine = (allDone && !mindState.steps.some(s => s.status === 'active'))
                    ? `<div class="mind-step active" style="margin-top:4px;opacity:0.6"><span class="step-indicator">â—</span><span class="waiting-dots">Awaiting next instruction</span></div>` : '';
                container.innerHTML = stepsHtml + waitingLine;
            }
            
            if (thought !== undefined) {
                mindState.thought = thought;
                document.getElementById('mind-thought-text').textContent = thought;
            }
        }
        
        function setMindStep(index, status) {
            if (mindState.steps[index]) {
                mindState.steps[index].status = status;
                updateMind(undefined, mindState.steps, undefined);
            }
        }
        
        // Fetch mind state from API
        async function refreshMind() {
            try {
                const data = await fetchWithTimeout('/api/mind', 5000);
                if (data) {
                    // Check if mind state is stale (older than 30 minutes)
                    const lastUpdated = data.lastUpdated ? new Date(data.lastUpdated) : null;
                    const now = new Date();
                    const staleMs = 30 * 60 * 1000; // 30 minutes
                    
                    if (lastUpdated && (now - lastUpdated) > staleMs) {
                        // State is stale - keep last task/steps visible but mark as idle
                        updateMind(data.task, data.steps || [], data.thought || 'Monitoring... waiting for next task.');
                        document.getElementById('mind-status').textContent = 'â—‹ Idle';
                        document.getElementById('mind-status').style.color = 'var(--text-dim)';
                    } else {
                        // State is fresh - show it (preserve steps even if task is null)
                        updateMind(data.task, data.steps || [], data.thought || 'Ready for your next request.');
                        const hasActiveStep = (data.steps || []).some(s => s.status === 'active');
                        const isActive = data.task || hasActiveStep;
                        document.getElementById('mind-status').textContent = isActive ? 'â— Active' : 'â—‹ Idle';
                        document.getElementById('mind-status').style.color = isActive ? 'var(--accent)' : 'var(--text-dim)';
                    }
                }
            } catch (err) {
                // Silent fail - mind state is optional
            }
        }
        
        // Refresh All Widgets
        function refreshAll() {
            // Spin the main refresh all button
            const mainBtn = document.getElementById('refresh-all-btn');
            if (mainBtn) mainBtn.classList.add('spinning');
            
            // Spin all individual refresh buttons
            document.querySelectorAll('.refresh-btn').forEach(btn => btn.classList.add('spinning'));
            
            addThought('Refreshing all widgets...');
            refreshSystem();
            refreshAgents();
            refreshTicker();
            refreshKalshi();
            refreshPredictions();
            refreshNews();
            refreshConnections();
            refreshSorare();
            refreshXStats();
            refreshTasks();
            refreshCron();
            refreshMind();
            
            // Stop spinning after 1.5 seconds
            setTimeout(() => {
                if (mainBtn) mainBtn.classList.remove('spinning');
                document.querySelectorAll('.refresh-btn').forEach(btn => btn.classList.remove('spinning'));
                addThought('All widgets refreshed âœ“');
            }, 1500);
        }
        
        // ===== DASHBOARD OPERATIONS (Automated logs) =====
        const maxThinkingLines = 4;
        
        function addThought(text) {
            const container = document.getElementById('thinking-content');
            if (!container) return; // Dashboard Ops removed
            
            // Mark old lines
            container.querySelectorAll('.thinking-line').forEach(el => el.classList.add('old'));
            
            // Add new thought
            const line = document.createElement('div');
            line.className = 'thinking-line';
            line.innerHTML = text + '<span class="thinking-cursor"></span>';
            container.appendChild(line);
            
            // Remove cursor from previous lines
            setTimeout(() => {
                container.querySelectorAll('.thinking-line').forEach((el, i, arr) => {
                    if (i < arr.length - 1) {
                        const cursor = el.querySelector('.thinking-cursor');
                        if (cursor) cursor.remove();
                    }
                });
            }, 100);
            
            // Limit lines
            const lines = container.querySelectorAll('.thinking-line');
            if (lines.length > maxThinkingLines) {
                lines[0].remove();
            }
            
            // Auto-scroll
            container.scrollTop = container.scrollHeight;
        }
        
        // Dashboard operational logs
        function logOps() {
            const ops = [
                "Refreshing system metrics...",
                "Syncing prediction data...",
                "Updating TikTok stats...",
                "Checking scheduled jobs...",
                "Polling session status...",
                "Auto-refresh complete.",
                "Monitoring active...",
                "All systems nominal."
            ];
            addThought(ops[Math.floor(Math.random() * ops.length)]);
        }
        
        // Refresh mind state periodically
        setInterval(refreshMind, 5000);
        
        // Initial load â€” each wrapped to prevent cascade failure
        try { initBrainMap(); } catch(e) { console.warn('Brain init:', e.message); }
        try { refreshMind(); } catch(e) {}
        try { refreshSystem(); } catch(e) {}
        try { refreshTicker(); } catch(e) {}
        try { refreshXStats(); } catch(e) {}
        try { refreshKalshi(); } catch(e) {}
        try { refreshPredictions(); } catch(e) {}
        try { refreshNews(); } catch(e) {}
        try { refreshSorare(); } catch(e) {}
        try { refreshMemecoins(); } catch(e) {}
        try { refreshConnections(); } catch(e) {}
        try { refreshAgents(); } catch(e) {}
        try { refreshTasks(); } catch(e) {}
        try { refreshCron(); } catch(e) {}
        
        // Auto-refresh intervals
        setInterval(refreshSystem, 30000);
        setInterval(refreshAgents, 30000);
        
        // Adaptive ticker: 10s when market open, 60s when closed (crypto still updates)
        let tickerInterval = null;
        function setAdaptiveTicker() {
            if (tickerInterval) clearInterval(tickerInterval);
            const ms = isStockMarketOpen() ? 10000 : 60000;
            tickerInterval = setInterval(refreshTicker, ms);
        }
        setAdaptiveTicker();
        setInterval(setAdaptiveTicker, 60000);  // Re-check market status every minute
        
        setInterval(refreshKalshi, 60000);  // Kalshi every 60 seconds
        setInterval(refreshPredictions, 300000);  // Predictions every 5 minutes
        setInterval(refreshNews, 300000);
        setInterval(refreshTasks, 60000);
        setInterval(refreshCron, 60000);
        setInterval(refreshSorare, 300000);  // Refresh Sorare every 5 minutes
        setInterval(refreshConnections, 300000);  // Connections every 5 minutes
        setInterval(refreshMemecoins, 30000);  // Memecoins every 30s (DexScreener data)
        
        // Night Mode
        let bouncingAnimation = null;
        let bounceX = 50, bounceY = 50;
        let bounceVX = 1.5, bounceVY = 1;
        
        function toggleNightMode() {
            const overlay = document.getElementById('night-mode-overlay');
            overlay.classList.add('active');
            updateNightModeClock();
            startBouncingLogo();
        }
        
        function exitNightMode() {
            const overlay = document.getElementById('night-mode-overlay');
            overlay.classList.remove('active');
            if (bouncingAnimation) {
                cancelAnimationFrame(bouncingAnimation);
                bouncingAnimation = null;
            }
        }
        
        function startBouncingLogo() {
            const logo = document.getElementById('bouncing-logo');
            const overlay = document.getElementById('night-mode-overlay');
            
            function animate() {
                if (!overlay.classList.contains('active')) return;
                
                const maxX = window.innerWidth - 120;
                const maxY = window.innerHeight - 120;
                
                bounceX += bounceVX;
                bounceY += bounceVY;
                
                // Bounce off edges
                if (bounceX <= 0 || bounceX >= maxX) {
                    bounceVX = -bounceVX;
                    bounceX = Math.max(0, Math.min(bounceX, maxX));
                }
                if (bounceY <= 0 || bounceY >= maxY) {
                    bounceVY = -bounceVY;
                    bounceY = Math.max(0, Math.min(bounceY, maxY));
                }
                
                logo.style.left = bounceX + 'px';
                logo.style.top = bounceY + 'px';
                
                bouncingAnimation = requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        function updateNightModeClock() {
            const overlay = document.getElementById('night-mode-overlay');
            if (!overlay.classList.contains('active')) return;
            
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            
            document.getElementById('eink-time').textContent = `${displayHours}:${minutes}`;
            document.getElementById('eink-ampm').textContent = ampm;
            document.getElementById('eink-date').textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric' 
            });
            
            setTimeout(updateNightModeClock, 1000);
        }
        
        // Auto-hide cursor after 1 minute of inactivity
        let cursorTimeout;
        const CURSOR_HIDE_DELAY = 60000; // 1 minute
        
        function hideCursor() {
            document.body.style.cursor = 'none';
            document.querySelectorAll('*').forEach(el => el.style.cursor = 'none');
        }
        
        function showCursor() {
            document.body.style.cursor = '';
            document.querySelectorAll('*').forEach(el => el.style.cursor = '');
        }
        
        function resetCursorTimer() {
            showCursor();
            clearTimeout(cursorTimeout);
            cursorTimeout = setTimeout(hideCursor, CURSOR_HIDE_DELAY);
        }
        
        // Listen for mouse movement
        document.addEventListener('mousemove', resetCursorTimer);
        document.addEventListener('mousedown', resetCursorTimer);
        document.addEventListener('keydown', resetCursorTimer);
        
        // Start the timer
        resetCursorTimer();
    </script>
    
    <!-- Night Mode Overlay -->
    <div id="night-mode-overlay" class="night-mode-overlay" onclick="exitNightMode()">
        <div class="eink-time" id="eink-time">12:00</div>
        <div class="eink-ampm" id="eink-ampm">AM</div>
        <div class="eink-date" id="eink-date">Wednesday, February 5</div>
        <div class="eink-hint">tap anywhere to exit</div>
        <div class="bouncing-logo" id="bouncing-logo">
            <img src="icon-192.png" alt="Jane">
        </div>
    </div>
</body>
</html>
