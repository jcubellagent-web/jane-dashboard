<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jane · Mobile</title>
    <link rel="icon" href="icon-192.png">
    <style>
        :root {
            --bg: #0a0a0f;
            --card-bg: rgba(255,255,255,0.04);
            --card-border: rgba(255,255,255,0.08);
            --accent: #4ade80;
            --text: rgba(255,255,255,0.9);
            --text-dim: rgba(255,255,255,0.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro', system-ui, sans-serif;
            min-height: 100dvh;
            padding: 0.5rem;
            -webkit-font-smoothing: antialiased;
            overscroll-behavior-y: contain;
        }

        /* Pull to refresh — spinning Jane icon */
        .ptr-icon {
            position: fixed;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            pointer-events: none;
            transition: top 0.25s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ptr-icon .ptr-jane {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 0 12px rgba(74,222,128,0.3);
            transition: transform 0.1s linear;
        }
        .ptr-icon.loading .ptr-jane {
            animation: ptrSpin 0.8s linear infinite;
        }
        @keyframes ptrSpin {
            to { transform: rotate(360deg); }
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }
        .status-top {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
        .status-top img {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .status-subtitle {
            font-size: 0.55rem;
            color: var(--text-dim);
            font-weight: 400;
        }
        .status-pills {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: nowrap;
        }
        .status-label {
            font-weight: 700;
            font-size: 0.7rem;
            color: var(--accent);
        }
        .status-pill {
            font-size: 0.55rem;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
        }
        .status-pill.green {
            color: var(--accent);
            font-weight: 700;
        }
        .status-pill.red {
            color: #ef4444;
            font-weight: 700;
        }
        .status-pill.dim {
            color: var(--text-dim);
        }
        .status-divider {
            color: rgba(255,255,255,0.2);
            font-size: 0.45rem;
        }

        /* Mind Widget */
        .mind-card {
            position: relative;
            overflow: hidden;
            min-height: 140px;
        }
        .mind-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .mind-card.active::before {
            opacity: 1;
            animation: mindPulse 2s ease-in-out infinite;
        }
        @keyframes mindPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .mind-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.4rem;
        }
        .mind-title {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .mind-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-dim);
        }
        .mind-status-dot.active {
            background: var(--accent);
            box-shadow: 0 0 6px var(--accent);
            animation: dotPulse 1.5s ease-in-out infinite;
        }
        @keyframes dotPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .mind-section {
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .mind-section:last-child { border-bottom: none; }
        .mind-section-label {
            font-size: 0.55rem;
            font-weight: 700;
            color: var(--text-dim);
            letter-spacing: 0.05em;
            margin-bottom: 0.2rem;
        }
        .mind-task-text {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            line-height: 1.3;
        }
        .mind-thought-text {
            color: var(--accent);
            font-size: 0.7rem;
            font-style: italic;
            line-height: 1.3;
        }
        .mind-goal {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.35rem;
            line-height: 1.3;
        }
        .mind-thought {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.6);
            font-style: italic;
            margin-bottom: 0.4rem;
            line-height: 1.3;
        }
        .mind-steps {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .mind-step {
            display: flex;
            align-items: flex-start;
            gap: 0.35rem;
            font-size: 0.65rem;
            line-height: 1.3;
        }
        .mind-step-icon {
            flex-shrink: 0;
            margin-top: 1px;
        }
        .mind-step.done {
            color: rgba(255,255,255,0.35);
        }
        .mind-step.done .mind-step-icon {
            color: var(--accent);
        }
        .mind-step.active {
            color: var(--text);
            font-weight: 500;
        }
        .mind-step.active .mind-step-icon {
            color: #facc15;
        }
        .mind-step.pending {
            color: var(--text-dim);
        }
        .mind-idle {
            font-size: 0.7rem;
            color: var(--accent);
            text-align: left;
            padding: 0.5rem 0;
        }
        .mind-idle-dots::after {
            content: '';
            animation: idleDots 1.5s steps(4, end) infinite;
        }
        @keyframes idleDots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
        }
        /* Mind Map Widget */
        .mindmap-card {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem 0.5rem 0.5rem;
            min-height: 210px;
        }
        .mindmap-header {
            position: absolute;
            top: 0.4rem;
            left: 0.75rem;
            font-size: 0.6rem;
            font-weight: 700;
            color: var(--text-dim);
            letter-spacing: 0.05em;
        }
        /* Ticker strip */
        .tk {
            font-size: 0.55rem;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }
        .tk-p {
            color: rgba(255,255,255,0.85);
            font-variant-numeric: tabular-nums;
        }
        .tk-c {
            font-size: 0.5rem;
            font-variant-numeric: tabular-nums;
        }
        .tk-c.pos { color: #4ade80; }
        .tk-c.neg { color: #ef4444; }

        /* X/Twitter strip */
        .x-stat {
            font-size: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.15rem;
        }
        .x-val {
            color: rgba(255,255,255,0.85);
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }
        .x-lbl {
            color: rgba(255,255,255,0.35);
            font-weight: 500;
        }
        .x-delta {
            font-size: 0.4rem;
            font-weight: 600;
        }
        .x-delta.up { color: #4ade80; }
        .x-delta.down { color: #ef4444; }
        .x-delta.flat { color: rgba(255,255,255,0.2); }
        .x-plan-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            display: inline-block;
            vertical-align: middle;
        }
        .tk-logo {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            vertical-align: middle;
        }

        .mindmap-svg {
            width: 280px;
            height: 160px;
        }
        /* Neural sphere canvas */
        .neural-sphere-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .mindmap-svg { position: relative; z-index: 1; }

        .mindmap-node {
            fill: rgba(74,222,128,0.5);
            stroke: none;
            stroke-width: 0;
            transition: fill 0.5s, r 0.3s;
        }
        .mindmap-idle .mindmap-node {
            animation: mmNodeFloat 5s ease-in-out infinite;
        }
        @keyframes mmNodeFloat {
            0%, 100% { fill: rgba(74,222,128,0.3); transform: translateY(0); }
            50% { fill: rgba(74,222,128,0.6); transform: translateY(-1.5px); }
        }
        .mindmap-idle .mindmap-node:nth-child(2) { animation-delay: 0.5s; }
        .mindmap-idle .mindmap-node:nth-child(3) { animation-delay: 1s; }
        .mindmap-idle .mindmap-node:nth-child(4) { animation-delay: 1.5s; }
        .mindmap-idle .mindmap-node:nth-child(5) { animation-delay: 2s; }
        .mindmap-idle .mindmap-node:nth-child(6) { animation-delay: 2.5s; }
        .mindmap-idle .mindmap-node:nth-child(7) { animation-delay: 3s; }
        @keyframes mmNodeBreathe {
            0%, 100% { fill: rgba(74,222,128,0.08); stroke: rgba(74,222,128,0.2); }
            50% { fill: rgba(74,222,128,0.2); stroke: rgba(74,222,128,0.5); }
        }
        .mindmap-active .mindmap-node {
            fill: rgba(74,222,128,0.3);
        }
        .mindmap-active .mindmap-node.lit {
            fill: #4ade80;
            filter: drop-shadow(0 0 4px rgba(74,222,128,0.6));
        }
        .mindmap-active .mindmap-node.lit-sonnet {
            fill: #8b5cf6;
            filter: drop-shadow(0 0 4px rgba(139,92,246,0.6));
        }
        .mindmap-active .mindmap-node.lit-whisper {
            fill: #facc15;
            filter: drop-shadow(0 0 4px rgba(250,204,21,0.6));
        }
        .mindmap-active .mindmap-node.lit-ollama {
            fill: #f97316;
            filter: drop-shadow(0 0 4px rgba(249,115,22,0.6));
        }
        .mindmap-active .mindmap-node.lit-sd {
            fill: #ec4899;
            filter: drop-shadow(0 0 4px rgba(236,72,153,0.6));
        }
        .mindmap-line {
            stroke: transparent;
            stroke-width: 0.5;
            stroke-dasharray: 2 2;
            transition: stroke 0.3s;
        }
        .mindmap-idle .mindmap-line {
            stroke: transparent;
        }
        .mindmap-active .mindmap-line {
            stroke: transparent;
        }
        .mindmap-active .mindmap-line.lit {
            stroke: rgba(74,222,128,0.4);
            stroke-width: 0.7;
            stroke-dasharray: 2 2;
        }
        .mindmap-hub {
            fill: #0a0a0a;
            stroke: rgba(74,222,128,0.3);
            stroke-width: 1;
            transition: stroke 0.5s;
        }
        .mindmap-idle .mindmap-hub {
            animation: mmHubCoreBreathe 3.5s ease-in-out infinite;
        }
        .mindmap-active .mindmap-hub {
            stroke: rgba(74,222,128,0.8);
            filter: drop-shadow(0 0 10px rgba(74,222,128,0.5));
        }
        @keyframes mmHubCoreBreathe {
            0%, 100% { stroke: rgba(74,222,128,0.2); filter: drop-shadow(0 0 3px rgba(74,222,128,0.1)); }
            50% { stroke: rgba(74,222,128,0.5); filter: drop-shadow(0 0 10px rgba(74,222,128,0.35)); }
        }
        .mindmap-hub-ring {
            fill: none;
            stroke: rgba(74,222,128,0.15);
            stroke-width: 0.5;
            stroke-dasharray: 3 3;
            transition: stroke 0.5s;
        }
        .mindmap-orb {
            fill: none;
            stroke-width: 0;
        }
        .mindmap-orb-outer {
            fill: rgba(74,222,128,0.03);
            animation: mmOrbBreathe 3.5s ease-in-out infinite;
        }
        .mindmap-orb-mid {
            fill: rgba(74,222,128,0.05);
            animation: mmOrbBreathe 3.5s ease-in-out infinite 0.5s;
        }
        .mindmap-active .mindmap-orb-outer {
            fill: rgba(74,222,128,0.08);
            animation: mmOrbActive 1.8s ease-in-out infinite;
        }
        .mindmap-active .mindmap-orb-mid {
            fill: rgba(74,222,128,0.12);
            animation: mmOrbActive 1.8s ease-in-out infinite 0.3s;
        }
        @keyframes mmOrbBreathe {
            0%, 100% { fill: rgba(74,222,128,0.02); }
            50% { fill: rgba(74,222,128,0.15); }
        }
        @keyframes mmOrbActive {
            0%, 100% { fill: rgba(74,222,128,0.06); }
            50% { fill: rgba(74,222,128,0.2); }
        }
        .mindmap-idle .mindmap-hub-ring {
            animation: mmHubBreathe 4s ease-in-out infinite;
        }
        .mindmap-active .mindmap-hub-ring {
            stroke: rgba(74,222,128,0.4);
            animation: hubSpin 3s linear infinite;
        }
        @keyframes hubSpin { to { stroke-dashoffset: -24; } }
        @keyframes mmHubBreathe {
            0%, 100% { stroke: rgba(74,222,128,0.15); filter: drop-shadow(0 0 2px rgba(74,222,128,0.1)); }
            50% { stroke: rgba(74,222,128,0.5); filter: drop-shadow(0 0 8px rgba(74,222,128,0.3)); }
        }
        .mindmap-glow {
            transition: opacity 0.5s;
        }
        .mindmap-idle .mindmap-glow {
            opacity: 0.08;
            animation: mmGlowBreathe 4s ease-in-out infinite;
        }
        .mindmap-active .mindmap-glow {
            opacity: 0.3;
            animation: mmGlowActive 1.5s ease-in-out infinite;
        }
        @keyframes mmGlowBreathe {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.4; }
        }
        @keyframes mmGlowActive {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.4; }
        }

        .mindmap-pulse {
            fill: #4ade80;
            opacity: 0;
        }
        .mm-flow-dot {
            opacity: 0;
            pointer-events: none;
        }
        .mindmap-label {
            font-size: 3.5px;
            fill: rgba(255,255,255,0.9);
            font-weight: bold;
            text-anchor: middle;
            transition: fill 0.5s;
        }
        .mindmap-active .mindmap-label.lit {
            fill: #4ade80;
        }
    </style>
</head>
<body>
    <div class="ptr-icon" id="ptr"><div class="ptr-jane"><img src="icon-192.png" style="width:22px;height:22px;border-radius:50%;"></div></div>
    <!-- Page Header -->
    <div style="padding: 0.6rem 0.25rem 0.3rem; display:flex; align-items:center; justify-content:space-between;">
        <div style="display:flex; align-items:center; gap:0.4rem;">
            <img src="icon-192.png" alt="Jane" style="width:20px;height:20px;border-radius:5px;">
            <span style="font-size:0.85rem;font-weight:700;color:var(--accent);">Jane</span>
            <span style="font-size:0.6rem;color:var(--text-dim);font-weight:400;">Josh's Personal Assistant</span>
        </div>
        <span id="greeting" style="font-size:0.7rem;font-weight:600;color:var(--accent);"></span>
    </div>
    <script>
        function updateGreeting() {
            const h = new Date().getHours();
            let g;
            if (h < 12) g = 'Good morning, Josh';
            else if (h < 17) g = 'Good afternoon, Josh';
            else g = 'Good evening, Josh';
            document.getElementById('greeting').textContent = g;
        }
        updateGreeting();
        setInterval(updateGreeting, 60000);
    </script>
    <!-- Jane Status Bar -->
    <div class="card">
        <div class="status-bar">
            <div class="status-pills">
                <span class="status-pill" id="model-pill">Model: --</span>
                <span class="status-pill green" id="plan-pill">Max</span>
                <span class="status-pill dim" id="age-pill">Age: --</span>
                <span class="status-pill" id="cpu-pill">CPU: --%</span>
                <span class="status-pill" id="ram-pill">RAM: --%</span>
                <span class="status-pill" id="mini2-pill">Mini2: --</span>
            </div>
        </div>
    </div>

    <!-- Connected Accounts (collapsible) -->
    <div class="card" id="conn-card" style="padding:0.5rem 0.75rem;">
        <div id="conn-toggle" style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;-webkit-tap-highlight-color:transparent;">
            <span style="font-size:0.7rem;font-weight:700;color:var(--accent);display:flex;align-items:center;gap:0.3rem;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="var(--accent)"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                Connected Accounts
            </span>
            <span id="conn-arrow" style="font-size:0.6rem;color:var(--text-dim);transition:transform 0.3s;">▶</span>
        </div>
        <div id="conn-body" style="display:none;margin-top:0.5rem;">
            <div style="font-size:0.55rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-dim);font-weight:600;margin-bottom:0.2rem;">My Accounts</div>
            <div id="conn-accounts" style="display:grid;grid-template-columns:1fr 1fr;gap:0.15rem 0.5rem;"></div>
            <div style="border-top:1px solid rgba(255,255,255,0.05);margin:0.3rem 0;"></div>
            <div style="font-size:0.55rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-dim);font-weight:600;margin-bottom:0.2rem;">Data Connections</div>
            <div id="conn-datasources" style="display:grid;grid-template-columns:1fr 1fr;gap:0.15rem 0.5rem;"></div>
        </div>
    </div>

    <!-- Mind Map (floating, no card background) -->
    <div class="mindmap-card mindmap-idle" id="mindmap-card" style="background:transparent;border:none;">
        <span class="mindmap-header">MIND MAP</span>
        <div style="position:absolute;top:0.4rem;right:0.75rem;display:flex;gap:0.4rem;align-items:center;">
            <span class="mm-legend-dot" id="mm-dot-opus" style="color:#4ade80;font-size:0.5rem;opacity:0.35;">● <span style="font-size:0.45rem;color:white;">Opus</span></span>
            <span class="mm-legend-dot" id="mm-dot-sonnet" style="color:#8b5cf6;font-size:0.5rem;opacity:0.35;">● <span style="font-size:0.45rem;color:white;">Sonnet</span></span>
            <span class="mm-legend-dot" id="mm-dot-whisper" style="color:#facc15;font-size:0.5rem;opacity:0.35;">● <span style="font-size:0.45rem;color:white;">Whisper</span></span>
            <span class="mm-legend-dot" id="mm-dot-ollama" style="color:#f97316;font-size:0.5rem;opacity:0.35;">● <span style="font-size:0.45rem;color:white;">Ollama</span></span>
            <span class="mm-legend-dot" id="mm-dot-sd" style="color:#ec4899;font-size:0.5rem;opacity:0.35;">● <span style="font-size:0.45rem;color:white;">SD</span></span>
        </div>
        <canvas id="neural-sphere" class="neural-sphere-canvas" width="280" height="210"></canvas>
        <svg class="mindmap-svg" viewBox="0 -8 160 110" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <radialGradient id="mmGlow" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" stop-color="rgba(74,222,128,0.12)"/>
                    <stop offset="40%" stop-color="rgba(74,222,128,0.04)"/>
                    <stop offset="100%" stop-color="rgba(74,222,128,0)"/>
                </radialGradient>
            </defs>
            <g id="mm-lines">
                <line x1="80.0" y1="36.0" x2="80.0" y2="7.5" class="mindmap-line" data-node="0"/>
                <line x1="86.9" y1="39.3" x2="118.1" y2="13.6" class="mindmap-line" data-node="1"/>
                <line x1="88.8" y1="43.2" x2="142.5" y2="32.5" class="mindmap-line" data-node="2"/>
                <line x1="86.9" y1="50.7" x2="118.1" y2="76.4" class="mindmap-line" data-node="3"/>
                <line x1="80.0" y1="54.0" x2="80.0" y2="82.5" class="mindmap-line" data-node="4"/>
                <line x1="73.1" y1="50.7" x2="41.9" y2="76.4" class="mindmap-line" data-node="5"/>
                <line x1="71.2" y1="43.2" x2="17.5" y2="32.5" class="mindmap-line" data-node="6"/>
                <line x1="73.1" y1="39.3" x2="41.9" y2="13.6" class="mindmap-line" data-node="7"/>
            </g>
            <g id="mm-nodes">
                <circle cx="80" cy="5" r="2.5" class="mindmap-node" data-node="0"/>
                <circle cx="120" cy="12" r="2.5" class="mindmap-node" data-node="1"/>
                <circle cx="145" cy="32" r="2.5" class="mindmap-node" data-node="2"/>
                <circle cx="120" cy="78" r="2.5" class="mindmap-node" data-node="3"/>
                <circle cx="80" cy="85" r="2.5" class="mindmap-node" data-node="4"/>
                <circle cx="40" cy="78" r="2.5" class="mindmap-node" data-node="5"/>
                <circle cx="15" cy="32" r="2.5" class="mindmap-node" data-node="6"/>
                <circle cx="40" cy="12" r="2.5" class="mindmap-node" data-node="7"/>
            </g>
            <g id="mm-labels">
                <text x="80" y="-4" class="mindmap-label" data-node="0">REASONING</text>
                <text x="120" y="4" class="mindmap-label" data-node="1">CODE</text>
                <text x="145" y="24" class="mindmap-label" data-node="2">WEB</text>
                <text x="120" y="88" class="mindmap-label" data-node="3">SOCIAL</text>
                <text x="80" y="96" class="mindmap-label" data-node="4">DATA</text>
                <text x="40" y="88" class="mindmap-label" data-node="5">MARKET</text>
                <text x="15" y="24" class="mindmap-label" data-node="6">MEMORY</text>
                <text x="40" y="4" class="mindmap-label" data-node="7">LANGUAGE</text>
            </g>
            <g id="mm-pulses">
                <g id="mm-flow-container"></g>
            </g>
            <circle cx="80" cy="45" r="18" class="mindmap-orb mindmap-orb-outer"/>
            <circle cx="80" cy="45" r="14" class="mindmap-orb mindmap-orb-mid"/>
            <circle cx="80" cy="45" r="12" class="mindmap-hub-ring"/>
            <circle cx="80" cy="45" r="9" class="mindmap-hub"/>
            <image href="icon-192.png" x="73" y="38" width="14" height="14" opacity="0.7"/>
        </svg>
    </div>

    <!-- Jane's Mind -->
    <div class="card mind-card" id="mind-card">
        <div class="mind-header">
            <span class="mind-title"><img src="icon-192.png" style="width:16px;height:16px;border-radius:50%;vertical-align:middle;margin-right:4px;filter:drop-shadow(0 0 4px rgba(74,222,128,0.5));">Jane's Mind</span>
            <span class="mind-status-dot" id="mind-dot"></span>
        </div>
        <div id="mind-content">
            <div class="mind-idle">Idle — waiting for Josh<span class="mind-idle-dots"></span></div>
        </div>
        <div id="mind-sections" style="display:none;">
            <div class="mind-section">
                <div class="mind-section-label">GOAL / OBJECTIVE</div>
                <div class="mind-task-text" id="mind-task-text">Awaiting instructions...</div>
            </div>
            <div class="mind-section">
                <div class="mind-section-label">THINKING &amp; DECISIONS</div>
                <div class="mind-thought-text" id="mind-thought-text">Ready for your next request.</div>
            </div>
            <div class="mind-section" id="mind-actions-section" style="display:none;">
                <div class="mind-section-label">ACTIONS &amp; TOOLS</div>
                <div class="mind-steps" id="mind-steps"></div>
            </div>
        </div>
    </div>

    <!-- Crypto Markets -->
    <div class="card" id="crypto-strip" style="padding:0.4rem 0.6rem;overflow:hidden;">
        <div style="display:flex;align-items:center;gap:0.4rem;margin-bottom:0.25rem;">
            <span style="font-size:0.6rem;font-weight:600;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:0.5px;">Crypto</span>
            <span class="tk-dot" id="crypto-dot" style="display:inline-block;width:5px;height:5px;border-radius:50%;background:#4ade80;"></span>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-around;gap:0.3rem;" id="crypto-row">
            <span class="tk" id="tk-btc"><img src="https://assets.coingecko.com/coins/images/1/small/bitcoin.png" class="tk-logo"> <span class="tk-c">--%</span></span>
            <span class="tk" id="tk-eth"><img src="https://assets.coingecko.com/coins/images/279/small/ethereum.png" class="tk-logo"> <span class="tk-c">--%</span></span>
            <span class="tk" id="tk-sol"><img src="https://assets.coingecko.com/coins/images/4128/small/solana.png" class="tk-logo"> <span class="tk-c">--%</span></span>
        </div>
    </div>

    <!-- Traditional Markets — NASDAQ 100 Movers -->
    <div class="card" id="trad-markets" style="padding:0.5rem 0.6rem;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.4rem;">
            <div style="display:flex;align-items:center;gap:0.4rem;">
                <img src="https://www.nasdaq.com/sites/acquia.prod/files/2020/09/24/nasdaq.jpg" style="width:14px;height:14px;border-radius:3px;object-fit:cover;">
                <span style="font-size:0.6rem;font-weight:600;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:0.5px;">NASDAQ 100</span>
                <span class="tk-dot" id="stock-dot" style="display:inline-block;width:5px;height:5px;border-radius:50%;background:#ef4444;"></span>
            </div>
            <span id="ndaq-change" class="tk" style="font-size:0.65rem;"><span class="tk-c">--%</span></span>
        </div>
        <div style="display:flex;gap:0.5rem;">
            <!-- Gainers column -->
            <div style="flex:1;">
                <div style="font-size:0.55rem;font-weight:600;color:#4ade80;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:0.3rem;">▲ Top Gainers</div>
                <div id="gainers-list"></div>
            </div>
            <!-- Losers column -->
            <div style="flex:1;">
                <div style="font-size:0.55rem;font-weight:600;color:#ef4444;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:0.3rem;">▼ Top Losers</div>
                <div id="losers-list"></div>
            </div>
        </div>
    </div>

    <!-- X/Twitter Growth Strip -->
    <div class="card" id="x-strip" style="padding:0.4rem 0.6rem;overflow:hidden;">
        <div style="display:flex;align-items:center;justify-content:space-between;">
            <div style="display:flex;align-items:center;gap:0.35rem;">
                <img id="x-pfp" src="x-pfp.jpg" style="width:18px;height:18px;border-radius:50%;border:1px solid rgba(255,255,255,0.15);">
                <span class="x-stat" id="x-engagement"><span class="x-val" style="font-size:0.65rem;color:#4ade80;">--</span> <span class="x-lbl">eng</span></span>
            </div>
            <span class="x-stat" id="x-followers"><span class="x-val">--</span> <span class="x-lbl">flw</span> <span class="x-delta" id="x-d-followers"></span></span>
            <span class="x-stat" id="x-impressions"><span class="x-val">--</span> <span class="x-lbl">views</span> <span class="x-delta" id="x-d-impressions"></span></span>
            <span class="x-stat" id="x-likes"><span class="x-val">--</span> <span class="x-lbl">likes</span> <span class="x-delta" id="x-d-likes"></span></span>
            <span class="x-stat" id="x-planned-replies"><span class="x-plan-dot" style="background:#1d9bf0;"></span> <span class="x-val">--</span> <span class="x-lbl">replies</span></span>
            <span class="x-stat" id="x-planned-tweets"><span class="x-plan-dot" style="background:#4ade80;"></span> <span class="x-val">--</span> <span class="x-lbl">tweets</span></span>
        </div>
    </div>

    <script>
        async function fetchJSON(url, timeout = 8000) {
            const ctrl = new AbortController();
            const t = setTimeout(() => ctrl.abort(), timeout);
            try {
                const r = await fetch(url, { signal: ctrl.signal });
                clearTimeout(t);
                return await r.json();
            } catch(e) {
                clearTimeout(t);
                return null;
            }
        }

        async function refreshStatus() {
            const [sessions, system] = await Promise.all([
                fetchJSON('/api/sessions'),
                fetchJSON('/api/system')
            ]);

            if (sessions?.sessions?.length) {
                const main = sessions.sessions.find(s => s.kind === 'main') || sessions.sessions[0];
                if (main?.model) {
                    const name = main.model.split('/').pop()
                        .replace('claude-', '').replace(/-/g, ' ')
                        .replace('4 5', '4.5').replace('4 6', '4.6');
                    document.getElementById('model-pill').textContent = 'Model: ' + name;
                }
            }

            if (system) {
                document.getElementById('cpu-pill').textContent = 'CPU: ' + (system.cpu || 0) + '%';
                document.getElementById('ram-pill').textContent = 'RAM: ' + (system.memory || 0) + '%';

                if (system.uptime) {
                    document.getElementById('age-pill').textContent = 'Age: ' + system.uptime;
                }

                const m2 = document.getElementById('mini2-pill');
                if (system.mini2) {
                    if (system.mini2.online) {
                        m2.textContent = 'Mini2: ✓';
                        m2.className = 'status-pill green';
                    } else {
                        m2.textContent = 'Mini2: ✗';
                        m2.className = 'status-pill red';
                    }
                }
            }
        }

        async function refreshTicker() {
            const data = await fetchJSON('/api/ticker');
            if (!data) return;
            // Crypto tokens
            const cryptos = { btc: data.btc, eth: data.eth, sol: data.sol };
            for (const [key, val] of Object.entries(cryptos)) {
                const el = document.getElementById('tk-' + key);
                if (!el || !val) continue;
                const chEl = el.querySelector('.tk-c');
                const ch = val.change24h;
                chEl.textContent = ch != null ? (ch >= 0 ? '+' : '') + ch.toFixed(1) + '%' : '--%';
                chEl.className = 'tk-c ' + (ch > 0 ? 'pos' : ch < 0 ? 'neg' : '');
            }
            // NASDAQ composite change
            const ndaq = data.nasdaq || data.ndaq;
            if (ndaq) {
                const nEl = document.querySelector('#ndaq-change .tk-c');
                if (nEl) {
                    const ch = ndaq.change24h;
                    nEl.textContent = ch != null ? (ch >= 0 ? '+' : '') + ch.toFixed(2) + '%' : '--%';
                    nEl.className = 'tk-c ' + (ch > 0 ? 'pos' : ch < 0 ? 'neg' : '');
                }
            }
            // Market status dots
            const now = new Date();
            const et = new Date(now.toLocaleString('en-US', {timeZone:'America/New_York'}));
            const day = et.getDay(), h = et.getHours(), m = et.getMinutes();
            const stockOpen = day >= 1 && day <= 5 && (h > 9 || (h === 9 && m >= 30)) && h < 16;
            const sDot = document.getElementById('stock-dot');
            if (sDot) sDot.style.background = stockOpen ? '#4ade80' : '#ef4444';
        }

        async function refreshMarketMovers() {
            const data = await fetchJSON('/market-movers.json');
            if (!data) return;
            const renderList = (items, containerId, isGainer) => {
                const container = document.getElementById(containerId);
                if (!container) return;
                container.innerHTML = '';
                (items || []).forEach(item => {
                    const row = document.createElement('div');
                    row.style.cssText = 'margin-bottom:0.35rem;';
                    const color = isGainer ? '#4ade80' : '#ef4444';
                    row.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:baseline;">' +
                        '<span style="font-size:0.65rem;font-weight:600;color:rgba(255,255,255,0.85);">' + item.symbol + '</span>' +
                        '<span style="font-size:0.6rem;font-weight:600;color:' + color + ';">' + item.pctChange + '</span>' +
                        '</div>' +
                        '<div style="font-size:0.5rem;color:rgba(255,255,255,0.4);line-height:1.2;margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">' + (item.headline || item.company) + '</div>';
                    container.appendChild(row);
                });
            };
            renderList(data.gainers, 'gainers-list', true);
            renderList(data.losers, 'losers-list', false);
        }

        async function refreshXStats() {
            const data = await fetchJSON('/x-stats.json');
            if (!data) return;
            const fmt = v => v >= 1000 ? (v/1000).toFixed(1) + 'K' : String(v);
            const set = (id, val) => { const el = document.querySelector('#' + id + ' .x-val'); if (el) el.textContent = val; };
            set('x-engagement', data.engagementRate || '--');
            set('x-followers', fmt(data.followers || 0));
            set('x-impressions', fmt(data.impressions || 0));
            set('x-likes', fmt(data.likes || 0));
            // 24h growth deltas
            const prev = data.prev24h || {};
            const showDelta = (id, current, previous) => {
                const el = document.getElementById(id);
                if (!el || previous == null) { if (el) el.textContent = ''; return; }
                const diff = current - previous;
                if (diff > 0) { el.textContent = '+' + fmt(diff); el.className = 'x-delta up'; }
                else if (diff < 0) { el.textContent = fmt(diff); el.className = 'x-delta down'; }
                else { el.textContent = '—'; el.className = 'x-delta flat'; }
            };
            showDelta('x-d-followers', data.followers, prev.followers);
            showDelta('x-d-impressions', data.impressions, prev.impressions);
            showDelta('x-d-likes', data.likes, prev.likes);
            // Planned content — from rolling 24h content plan
            const plan = await fetchJSON('/x-content-plan.json');
            const setP = (id, val) => { const el = document.querySelector('#' + id + ' .x-val'); if (el) el.textContent = val != null ? String(val) : '--'; };
            if (plan && plan.rolling24h) {
                const r = plan.rolling24h.replies || {};
                const t = plan.rolling24h.originalTweets || {};
                setP('x-planned-replies', (r.planned || 0) - (r.completed || 0));
                setP('x-planned-tweets', (t.planned || 0) - (t.completed || 0));
            } else {
                setP('x-planned-replies', data.plannedReplies);
                setP('x-planned-tweets', data.plannedTweets);
            }
        }

        async function refreshMind() {
            const data = await fetchJSON('/mind-state.json');
            if (!data) return;

            const card = document.getElementById('mind-card');
            const dot = document.getElementById('mind-dot');
            const content = document.getElementById('mind-content');
            const sections = document.getElementById('mind-sections');
            const isActive = data.task != null;

            card.classList.toggle('active', isActive);
            dot.classList.toggle('active', isActive);
            window._mmModel = data.model || 'opus';
            refreshMindMap(isActive, data.steps);

            if (!isActive) {
                content.style.display = '';
                const lastGoal = data.lastTask && data.lastTask !== 'Working...' ? `<div style="color:rgba(255,255,255,0.35);font-size:0.65rem;margin-top:0.3rem;">Last: ${esc(data.lastTask)}</div>` : '';
                content.innerHTML = '<div class="mind-idle">Idle — waiting for Josh<span class="mind-idle-dots"></span></div>' + lastGoal;
                sections.style.display = 'none';
                return;
            }

            // Hide idle, show sections
            content.style.display = 'none';
            sections.style.display = '';

            // Model color map
            const modelColors = {opus:'#4ade80', claude:'#4ade80', sonnet:'#8b5cf6', whisper:'#facc15', ollama:'#f97316', sd:'#ec4899'};
            const activeColor = modelColors[(data.model||'').toLowerCase()] || 'var(--accent)';

            // Goal / Objective — colored by active model
            const goalEl = document.getElementById('mind-task-text');
            goalEl.textContent = data.task || 'Awaiting instructions...';
            goalEl.style.color = activeColor;

            // Thinking & Decisions
            const thoughtEl = document.getElementById('mind-thought-text');
            thoughtEl.textContent = data.thought || 'Ready for your next request.';
            thoughtEl.style.color = activeColor;

            // Actions & Tools (steps) — each step colored by its own tool/model
            const stepsEl = document.getElementById('mind-steps');
            if (data.steps && data.steps.length) {
                const indicators = { done: '✓', active: '●', pending: '○' };
                stepsEl.innerHTML = data.steps.map(step => {
                    const s = step.status || 'pending';
                    const stepColor = modelColors[(step.tool||'').toLowerCase()] || 'var(--accent)';
                    return `<div class="mind-step ${s}" style="color:${stepColor}"><span class="mind-step-icon">${indicators[s]}</span><span>${esc(step.label)}</span></div>`;
                }).join('');
            } else {
                stepsEl.innerHTML = '';
            }
        }

        function esc(str) {
            const d = document.createElement('div');
            d.textContent = str;
            return d.innerHTML;
        }

        // Tool/label → brain region mapping
        // Regions: 0=REASONING, 1=CODE, 2=WEB, 3=SOCIAL, 4=DATA, 5=MARKET, 6=MEMORY, 7=LANGUAGE
        // Keyword → brain region mapping
        // Regions: 0=REASONING, 1=CODE, 2=WEB, 3=SOCIAL, 4=DATA, 5=MARKET, 6=MEMORY, 7=LANGUAGE
        const keywordToRegions = {
            // Reasoning (0)
            reason: [0], analy: [0], think: [0], strateg: [0], plan: [0], evaluat: [0], decision: [0], assess: [0],
            // Code (1)
            code: [1], script: [1], compil: [1], build: [1], edit: [1], function: [1], debug: [1], implement: [1],
            shell: [1], command: [1], commit: [1], ' run': [1], css: [1], html: [1], svg: [1], widget: [1],
            // Web (2)
            'web search': [2], 'web fetch': [2], browser: [2], scrape: [2], crawl: [2], url: [2], website: [2],
            'searching': [2], 'fetching': [2],
            // Social (3)
            social: [3], tweet: [3], 'post': [3], reply: [3], discord: [3], whatsapp: [3], engag: [3],
            'x timeline': [3], '@': [3], thread: [3],
            // Data (4)
            'json': [4], 'file': [4], dashboard: [4], 'writing to': [4], 'reading': [4], dataset: [4], updat: [4],
            // Market (5)
            market: [5], trad: [5], swap: [5], jupiter: [5], solana: [5], sorare: [5], kalshi: [5], price: [5],
            defi: [5], token: [5], wallet: [5], portfolio: [5],
            // Memory (6)
            memory: [6], recall: [6], remember: [6], knowledge: [6], embed: [6],
            // Language (7)
            transcri: [7], voice: [7], audio: [7], speech: [7], tts: [7], whisper: [7],
            // Image
            image: [1,4], avatar: [1,4], render: [1,4], 'stable diffusion': [1,4],
        };

        // Model name normalization (tool field → canonical model)
        const modelNames = new Set(['opus','claude','sonnet','whisper','ollama','sd']);

        function getActiveRegions(steps) {
            const regions = new Map(); // regionIndex → model name
            if (!steps || !steps.length) return regions;
            const activeSteps = steps.filter(s => s.status === 'active' || s.status === 'done');
            for (const step of activeSteps) {
                const label = (step.label || '').toLowerCase();
                const tool = (step.tool || '').toLowerCase();
                // Determine model from tool field (should be model name like opus, sonnet, whisper, etc.)
                const model = modelNames.has(tool) ? tool : 'opus';
                let matched = false;
                // Match keywords from label
                for (const [keyword, indices] of Object.entries(keywordToRegions)) {
                    if (label.includes(keyword)) {
                        for (const idx of indices) {
                            if (!regions.has(idx)) regions.set(idx, model);
                        }
                        matched = true;
                    }
                }
                // Also check tool field as keyword (for backward compat)
                if (!matched) {
                    for (const [keyword, indices] of Object.entries(keywordToRegions)) {
                        if (tool.includes(keyword)) {
                            for (const idx of indices) {
                                if (!regions.has(idx)) regions.set(idx, model);
                            }
                            matched = true;
                        }
                    }
                }
                // Default: if tool is a known model, map to its natural region
                if (!matched) {
                    const modelRegion = {opus:0, claude:0, sonnet:0, whisper:7, ollama:7, sd:1}[model];
                    if (modelRegion !== undefined) regions.set(modelRegion, model);
                    else regions.set(0, model);
                }
            }
            if (regions.size === 0) regions.set(0, 'opus');
            return regions;
        }

        function refreshMindMap(isActive, steps) {
            const card = document.getElementById('mindmap-card');
            card.classList.toggle('mindmap-active', isActive);
            card.classList.toggle('mindmap-idle', !isActive);

            // Update model legend — highlight all active models
            const modelMap = {opus:'mm-dot-opus', sonnet:'mm-dot-sonnet', whisper:'mm-dot-whisper', ollama:'mm-dot-ollama', sd:'mm-dot-sd'};
            const colorMap = {opus:'#4ade80', claude:'#4ade80', sonnet:'#8b5cf6', whisper:'#facc15', ollama:'#f97316', sd:'#ec4899'};
            const classMap = {sonnet:'lit-sonnet', whisper:'lit-whisper', ollama:'lit-ollama', sd:'lit-sd'};
            document.querySelectorAll('.mm-legend-dot').forEach(d => d.style.opacity = '0.35');
            if (isActive && window._mmModel) {
                const el = document.getElementById(modelMap[window._mmModel]);
                if (el) el.style.opacity = '1';
            }

            if (isActive) {
                const regions = getActiveRegions(steps);
                const indices = [...regions.keys()];

                // Also highlight legend dots for any model in active regions
                for (const model of regions.values()) {
                    const el = document.getElementById(modelMap[model]);
                    if (el) el.style.opacity = '1';
                }

                const nodes = card.querySelectorAll('.mindmap-node');
                const lines = card.querySelectorAll('.mindmap-line');
                const labels = card.querySelectorAll('.mindmap-label');

                nodes.forEach((n, i) => {
                    n.classList.remove('lit','lit-sonnet','lit-whisper','lit-ollama','lit-sd');
                    if (regions.has(i)) {
                        const model = regions.get(i);
                        n.classList.add(classMap[model] || 'lit');
                    }
                });
                // Hide inactive lines, keep active ones persistent
                lines.forEach((l, i) => {
                    if (!indices.includes(i)) {
                        l.classList.remove('lit');
                        l.style.strokeDashoffset = '';
                        l.style.stroke = '';
                        l.removeAttribute('data-active');
                    }
                });
                labels.forEach((l, i) => l.classList.toggle('lit', indices.includes(i)));

                // Animate lines shooting out + burst flow dots
                const lineEls = card.querySelectorAll('.mindmap-line');
                const flowContainer = document.getElementById('mm-flow-container');
                indices.forEach(i => {
                    const model = regions.get(i);
                    const color = colorMap[model] || '#4ade80';
                    if (!lineEls[i]) return;
                    const line = lineEls[i];
                    const alreadyActive = line.hasAttribute('data-active');

                    const x1=+line.getAttribute('x1'), y1=+line.getAttribute('y1');
                    const x2=+line.getAttribute('x2'), y2=+line.getAttribute('y2');

                    if (!alreadyActive) {
                        // First activation — shoot out animation
                        const len = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
                        line.style.strokeDasharray = len + ' ' + len;
                        line.style.strokeDashoffset = len;
                        line.classList.add('lit');
                        line.style.stroke = color;
                        line.setAttribute('data-active', '1');
                        let shootStart = null;
                        const shootDuration = 400;
                        (function animShoot(ts) {
                            if (!shootStart) shootStart = ts;
                            const t = Math.min((ts - shootStart) / shootDuration, 1);
                            const eased = t < 0.5 ? 2*t*t : -1+(4-2*t)*t;
                            line.style.strokeDashoffset = len * (1 - eased);
                            if (t < 1) requestAnimationFrame(animShoot);
                            else line.style.strokeDashoffset = '0';
                        })(performance.now());
                    } else {
                        // Already active — just update color, keep line visible
                        line.style.stroke = color;
                    }
                    // Flow dots start after line finishes drawing (400ms delay)
                    const burstCount = 4 + Math.floor(Math.random()*4);
                    for (let b = 0; b < burstCount; b++) {
                        const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
                        const r = 0.8;
                        dot.setAttribute('r', r);
                        dot.setAttribute('cx', x1);
                        dot.setAttribute('cy', y1);
                        dot.style.fill = color;
                        dot.style.opacity = '0';
                        dot.style.filter = `drop-shadow(0 0 ${r}px ${color})`;
                        flowContainer.appendChild(dot);
                        const duration = 800 + Math.random()*1000;
                        const delay = 400 + b * (80 + Math.random()*120); // 400ms wait for line shoot + staggered burst
                        const wobbleX = (Math.random()-0.5)*6; // random lateral spread
                        const wobbleY = (Math.random()-0.5)*6;
                        let start = null;
                        (function animBurst(ts) {
                            if (!start) start = ts;
                            const elapsed = ts - start - delay;
                            if (elapsed < 0) { requestAnimationFrame(animBurst); return; }
                            const t = Math.min(elapsed / duration, 1);
                            const eased = t < 0.5 ? 2*t*t : -1+(4-2*t)*t;
                            const wx = wobbleX * Math.sin(t * Math.PI);
                            const wy = wobbleY * Math.sin(t * Math.PI);
                            dot.setAttribute('cx', x1 + (x2-x1)*eased + wx);
                            dot.setAttribute('cy', y1 + (y2-y1)*eased + wy);
                            dot.style.opacity = t < 0.1 ? t*10 : t > 0.75 ? (1-t)*4 : 0.85;
                            if (t < 1) requestAnimationFrame(animBurst);
                            else flowContainer.removeChild(dot);
                        })(performance.now());
                    }
                });
            }
        }

        // Connected Accounts - collapsible
        const connToggle = document.getElementById('conn-toggle');
        const connBody = document.getElementById('conn-body');
        const connArrow = document.getElementById('conn-arrow');
        let connOpen = false;
        connToggle.addEventListener('click', () => {
            connOpen = !connOpen;
            connBody.style.display = connOpen ? '' : 'none';
            connArrow.style.transform = connOpen ? 'rotate(90deg)' : '';
            if (connOpen && !connBody.dataset.loaded) refreshConnections();
        });

        async function refreshConnections() {
            try {
                const data = await fetchJSON('/api/connections');
                if (!data) return;
                const render = (items, id) => {
                    const el = document.getElementById(id);
                    el.innerHTML = items.map(i => `
                        <div style="display:flex;align-items:center;gap:0.25rem;padding:0.1rem 0;font-size:0.6rem;color:rgba(255,255,255,0.7);">
                            <img src="${i.icon}" alt="" style="width:12px;height:12px;border-radius:2px;${i.invert?'filter:invert(1);':''}" onerror="this.style.display='none'">
                            <span>${esc(i.name)}</span>
                            ${i.active ? '<span style="color:var(--accent);font-size:0.4rem;">●</span>' : ''}
                        </div>
                    `).join('');
                };
                render(data.accounts || [], 'conn-accounts');
                render(data.dataSources || [], 'conn-datasources');
                connBody.dataset.loaded = '1';
            } catch(e) { console.error('connections', e); }
        }

        refreshStatus();
        refreshMind();
        refreshTicker();
        refreshMarketMovers();
        refreshXStats();
        setInterval(refreshStatus, 30000);
        setInterval(refreshMind, 5000);
        setInterval(refreshTicker, 60000);
        setInterval(refreshMarketMovers, 300000);
        setInterval(refreshXStats, 120000);

        // Angular Neural Network
        (function initNeuralSphere() {
            const canvas = document.getElementById('neural-sphere');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const W = canvas.width, H = canvas.height;

            const G = [74,222,128]; // brand green

            // Data particles — floating upward like data streams
            const particles = [];
            for (let i = 0; i < 80; i++) {
                particles.push({
                    x: Math.random() * W,
                    y: Math.random() * H,
                    r: Math.random() * 0.8 + 0.2,
                    baseAlpha: Math.random() * 0.5 + 0.1,
                    speed: Math.random() * 0.15 + 0.05,
                    drift: (Math.random() - 0.5) * 0.1,
                    twinkleSpeed: Math.random() * 0.02 + 0.008,
                    twinkleOffset: Math.random() * Math.PI * 2,
                    bright: Math.random() > 0.85 // ~15% are brighter accent particles
                });
            }

            // Streaks — fast horizontal data lines
            const streaks = [];
            function spawnStreak() {
                const isActive = document.getElementById('mindmap-card')?.classList.contains('mindmap-active');
                if (Math.random() > (isActive ? 0.03 : 0.008)) return;
                streaks.push({
                    x: -20,
                    y: Math.random() * H,
                    speed: Math.random() * 3 + 1.5,
                    len: Math.random() * 40 + 20,
                    life: 1.0,
                    alpha: Math.random() * 0.3 + 0.15
                });
            }

            // Scan line
            let scanY = 0;

            let t = 0;

            function render() {
                const isActive = document.getElementById('mindmap-card')?.classList.contains('mindmap-active');
                t += 0.016;

                ctx.clearRect(0, 0, W, H);

                // Subtle radial vignette glow from center
                const vigAlpha = isActive ? 0.07 : 0.03;
                const vig = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, W * 0.6);
                vig.addColorStop(0, `rgba(${G[0]},${G[1]},${G[2]},${vigAlpha})`);
                vig.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = vig;
                ctx.fillRect(0, 0, W, H);

                // Faint grid lines
                const gridAlpha = isActive ? 0.04 : 0.018;
                ctx.strokeStyle = `rgba(${G[0]},${G[1]},${G[2]},${gridAlpha})`;
                ctx.lineWidth = 0.5;
                for (let x = 0; x < W; x += 28) {
                    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
                }
                for (let y = 0; y < H; y += 28) {
                    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
                }

                // Particles — floating data motes
                const pBrightness = isActive ? 1.6 : 1.0;
                particles.forEach(p => {
                    p.y -= p.speed * (isActive ? 2.5 : 1);
                    p.x += p.drift;
                    if (p.y < -5) { p.y = H + 5; p.x = Math.random() * W; }
                    if (p.x < 0) p.x = W; if (p.x > W) p.x = 0;

                    const twinkle = 0.3 + Math.sin(t * p.twinkleSpeed * 60 + p.twinkleOffset) * 0.7;
                    const alpha = Math.min(1, p.baseAlpha * twinkle * pBrightness);

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${G[0]},${G[1]},${G[2]},${alpha})`;
                    ctx.fill();

                    // Glow halo on bright particles
                    if (p.bright && alpha > 0.3) {
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.r * 3, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(${G[0]},${G[1]},${G[2]},${alpha * 0.12})`;
                        ctx.fill();
                    }
                });

                // Data streaks
                spawnStreak();
                for (let i = streaks.length - 1; i >= 0; i--) {
                    const s = streaks[i];
                    s.x += s.speed * (isActive ? 2 : 1);
                    s.life -= 0.008;
                    if (s.life <= 0 || s.x > W + 40) { streaks.splice(i, 1); continue; }
                    const grad = ctx.createLinearGradient(s.x, s.y, s.x - s.len, s.y);
                    grad.addColorStop(0, `rgba(${G[0]},${G[1]},${G[2]},${s.alpha * s.life})`);
                    grad.addColorStop(1, `rgba(${G[0]},${G[1]},${G[2]},0)`);
                    ctx.strokeStyle = grad;
                    ctx.lineWidth = 0.8;
                    ctx.beginPath();
                    ctx.moveTo(s.x, s.y);
                    ctx.lineTo(s.x - s.len, s.y);
                    ctx.stroke();
                }

                // Scan line — slow sweep
                scanY += isActive ? 0.4 : 0.15;
                if (scanY > H) scanY = 0;
                const scanAlpha = isActive ? 0.06 : 0.025;
                const scanGrad = ctx.createLinearGradient(0, scanY - 8, 0, scanY + 8);
                scanGrad.addColorStop(0, 'rgba(0,0,0,0)');
                scanGrad.addColorStop(0.5, `rgba(${G[0]},${G[1]},${G[2]},${scanAlpha})`);
                scanGrad.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = scanGrad;
                ctx.fillRect(0, scanY - 8, W, 16);

                requestAnimationFrame(render);
            }
            requestAnimationFrame(render);
        })();

        // Pull to refresh — spinning Jane icon
        let ptrStart = 0, ptrActive = false, ptrRefreshing = false;
        const ptrIcon = document.getElementById('ptr');
        const ptrJane = ptrIcon.querySelector('.ptr-jane');

        document.addEventListener('touchstart', e => {
            if (window.scrollY === 0 && !ptrRefreshing) {
                ptrStart = e.touches[0].clientY;
                ptrActive = true;
            }
        }, { passive: true });

        document.addEventListener('touchmove', e => {
            if (!ptrActive) return;
            const dy = e.touches[0].clientY - ptrStart;
            if (dy > 10 && dy < 150) {
                const progress = Math.min((dy - 10) / 70, 1);
                ptrIcon.style.top = (progress * 50 - 10) + 'px';
                ptrJane.style.transform = 'rotate(' + (progress * 360) + 'deg)';
            }
        }, { passive: true });

        document.addEventListener('touchend', () => {
            if (!ptrActive) return;
            ptrActive = false;
            const top = parseFloat(ptrIcon.style.top) || -50;
            if (top >= 30) {
                // Trigger refresh — start spinning
                ptrRefreshing = true;
                ptrIcon.style.top = '12px';
                ptrIcon.classList.add('loading');
                Promise.all([refreshStatus(), refreshMind(), refreshTicker(), refreshMarketMovers(), refreshXStats()]).then(() => {
                    ptrIcon.classList.remove('loading');
                    ptrIcon.style.transition = 'top 0.3s ease';
                    ptrIcon.style.top = '-50px';
                    setTimeout(() => {
                        ptrIcon.style.transition = '';
                        ptrJane.style.transform = '';
                        ptrRefreshing = false;
                    }, 350);
                });
            } else {
                // Cancel — snap back
                ptrIcon.style.transition = 'top 0.2s ease';
                ptrIcon.style.top = '-50px';
                setTimeout(() => { ptrIcon.style.transition = ''; ptrJane.style.transform = ''; }, 200);
            }
        });
    </script>

    <!-- WhatsApp FAB -->
    <a href="https://wa.me/17175759384" id="wa-fab" style="
        position: fixed;
        bottom: 1.2rem;
        right: 1.2rem;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: rgba(74,222,128,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 12px rgba(74,222,128,0.35);
        z-index: 1000;
        text-decoration: none;
        transition: transform 0.2s, box-shadow 0.2s;
    " ontouchstart="this.style.transform='scale(0.92)'" ontouchend="this.style.transform=''">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="white" stroke="none">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.2L4 17.2V4h16v12z"/>
            <circle cx="8" cy="10" r="1.2"/>
            <circle cx="12" cy="10" r="1.2"/>
            <circle cx="16" cy="10" r="1.2"/>
        </svg>
    </a>
</body>
</html>