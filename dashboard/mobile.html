<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jane ¬∑ Mobile</title>
    <link rel="icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,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">
    <link rel="apple-touch-icon-precomposed" sizes="180x180" href="data:image/png;base64,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">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <link rel="dns-prefetch" href="https://assets.coingecko.com">
    <style>
        :root {
            --bg: #0a0a0f;
            --card-bg: rgba(255,255,255,0.04);
            --card-border: rgba(255,255,255,0.08);
            --accent: #4ade80;
            --text: rgba(255,255,255,0.9);
            --text-dim: rgba(255,255,255,0.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        .card { contain: content; }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro', system-ui, sans-serif;
            min-height: 100dvh;
            padding: 0.5rem;
            -webkit-font-smoothing: antialiased;
            overscroll-behavior-y: contain;
        }

        /* Pull to refresh ‚Äî spinning Jane icon */
        .ptr-wrapper {
            position: relative;
            overflow: hidden;
        }
        .ptr-spacer {
            height: 0;
            transition: height 0.35s cubic-bezier(0.2, 0, 0, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .ptr-spacer.open {
            height: 60px;
        }
        .ptr-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .ptr-spacer.open .ptr-icon {
            opacity: 1;
            transform: scale(1);
        }
        .ptr-icon .ptr-jane {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 0 12px rgba(74,222,128,0.3);
        }
        .ptr-icon.loading .ptr-jane {
            animation: ptrSpin 0.8s linear infinite;
        }
        @keyframes ptrSpin {
            to { transform: rotate(360deg); }
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
            transition: border-color 0.4s ease, box-shadow 0.4s ease;
            will-change: auto;
        }
        .card.glow {
            border-color: rgba(74,222,128,0.2);
            box-shadow: 0 0 12px rgba(74,222,128,0.06), inset 0 0 12px rgba(74,222,128,0.03);
        }
        .card.glow-blue {
            border-color: rgba(29,155,240,0.2);
            box-shadow: 0 0 12px rgba(29,155,240,0.06), inset 0 0 12px rgba(29,155,240,0.03);
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }
        .status-top {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
        .status-top img {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .status-subtitle {
            font-size: 0.55rem;
            color: var(--text-dim);
            font-weight: 400;
        }
        .status-pills {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: nowrap;
        }
        .status-label {
            font-weight: 700;
            font-size: 0.7rem;
            color: var(--accent);
        }
        .status-pill {
            font-size: 0.55rem;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
        }
        .status-pill.green {
            color: var(--accent);
            font-weight: 700;
        }
        .status-pill.red {
            color: #ef4444;
            font-weight: 700;
        }
        .status-pill.dim {
            color: var(--text-dim);
        }
        .status-divider {
            color: rgba(255,255,255,0.2);
            font-size: 0.45rem;
        }

        /* Mind Widget */
        .mind-card {
            position: relative;
            overflow: hidden;
            min-height: 140px;
        }
        .mind-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .mind-card.active::before {
            opacity: 1;
            animation: mindPulse 2s ease-in-out infinite;
        }
        @keyframes mindPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .mind-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.4rem;
        }
        .mind-title {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .mind-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-dim);
        }
        .mind-status-dot.active {
            background: var(--accent);
            box-shadow: 0 0 6px var(--accent);
            animation: dotPulse 1.5s ease-in-out infinite;
        }
        @keyframes dotPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .mind-section {
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .mind-section:last-child { border-bottom: none; }
        .mind-section-label {
            font-size: 0.55rem;
            font-weight: 700;
            color: var(--text-dim);
            letter-spacing: 0.05em;
            margin-bottom: 0.2rem;
        }
        .mind-task-text {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            line-height: 1.3;
        }
        .mind-thought-text {
            color: var(--accent);
            font-size: 0.7rem;
            font-style: italic;
            line-height: 1.3;
        }
        .mind-goal {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.35rem;
            line-height: 1.3;
        }
        .mind-thought {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.6);
            font-style: italic;
            margin-bottom: 0.4rem;
            line-height: 1.3;
        }
        .mind-steps {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .mind-step {
            display: flex;
            align-items: flex-start;
            gap: 0.35rem;
            font-size: 0.65rem;
            line-height: 1.3;
        }
        .mind-step-icon {
            flex-shrink: 0;
            margin-top: 1px;
        }
        .mind-step.done {
            color: rgba(255,255,255,0.35);
        }
        .mind-step.done .mind-step-icon {
            color: var(--accent);
        }
        .mind-step.active {
            color: var(--text);
            font-weight: 500;
        }
        .mind-step.active .mind-step-icon {
            color: #facc15;
        }
        .mind-step.pending {
            color: var(--text-dim);
        }
        .mind-idle {
            font-size: 0.7rem;
            color: var(--accent);
            text-align: left;
            padding: 0.5rem 0;
        }
        .mind-idle-dots::after {
            content: '';
            animation: idleDots 1.5s steps(4, end) infinite;
        }
        @keyframes idleDots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
        }
        /* Mind Map Widget */
        .mindmap-card {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem 0.5rem 0.5rem;
            min-height: 210px;
        }
        .mindmap-header {
            position: absolute;
            top: 0.4rem;
            left: 0.75rem;
            font-size: 0.6rem;
            font-weight: 700;
            color: var(--text-dim);
            letter-spacing: 0.05em;
        }
        /* Ticker strip */
        .tk {
            font-size: 0.55rem;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }
        .tk-p {
            color: rgba(255,255,255,0.85);
            font-variant-numeric: tabular-nums;
        }
        .tk-c {
            font-size: 0.5rem;
            font-variant-numeric: tabular-nums;
        }
        .tk-c.pos { color: #4ade80; }
        .tk-c.neg { color: #ef4444; }

        /* X/Twitter strip */
        .x-stat {
            font-size: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.15rem;
        }
        .x-val {
            color: rgba(255,255,255,0.85);
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }
        .x-lbl {
            color: rgba(255,255,255,0.35);
            font-weight: 500;
        }
        .x-delta {
            font-size: 0.4rem;
            font-weight: 600;
        }
        .x-delta.up { color: #4ade80; }
        .x-delta.down { color: #ef4444; }
        .x-delta.flat { color: rgba(255,255,255,0.2); }
        .x-plan-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            display: inline-block;
            vertical-align: middle;
        }
        .tk-logo {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            vertical-align: middle;
        }

        .mindmap-svg {
            width: 280px;
            height: 160px;
            /* no transform ‚Äî diamond layout via node positions */
        }
        /* Neural sphere canvas */
        .neural-sphere-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .mindmap-svg { position: relative; z-index: 1; }

        .mindmap-card { contain: layout style; }
        .neural-sphere-canvas { will-change: transform; }
        /* Sub-agent activity glow on neural sphere */
        .mindmap-card.subagents-active .neural-sphere-canvas {
            filter: drop-shadow(0 0 8px rgba(139,92,246,0.15));
            transition: filter 1.5s ease;
        }
        .mindmap-card:not(.subagents-active) .neural-sphere-canvas {
            transition: filter 2s ease;
        }
        .mindmap-card.subagents-active .mindmap-hub {
            stroke: rgba(139,92,246,0.6) !important;
            filter: drop-shadow(0 0 8px rgba(139,92,246,0.4)) !important;
            transition: stroke 1.5s ease, filter 1.5s ease;
        }
        .mindmap-card.subagents-active .mindmap-orb-outer {
            fill: rgba(139,92,246,0.06);
            animation: mmOrbSubagent 2s ease-in-out infinite;
        }
        .mindmap-card.subagents-active .mindmap-orb-mid {
            fill: rgba(139,92,246,0.1);
            animation: mmOrbSubagent 2s ease-in-out infinite 0.4s;
        }
        @keyframes mmOrbSubagent {
            0%, 100% { fill: rgba(139,92,246,0.04); }
            50% { fill: rgba(139,92,246,0.15); }
        }
        .mindmap-node {
            fill: rgba(74,222,128,0.5);
            stroke: none;
            stroke-width: 0;
            transition: fill 0.5s, r 0.3s;
        }
        .mindmap-idle .mindmap-node {
            animation: mmNodeFloat 5s ease-in-out infinite;
        }
        @keyframes mmNodeFloat {
            0%, 100% { fill: rgba(74,222,128,0.3); transform: translateY(0); }
            50% { fill: rgba(74,222,128,0.6); transform: translateY(-1.5px); }
        }
        .mindmap-idle .mindmap-node:nth-child(2) { animation-delay: 0.6s; }
        .mindmap-idle .mindmap-node:nth-child(3) { animation-delay: 1.2s; }
        .mindmap-idle .mindmap-node:nth-child(4) { animation-delay: 1.8s; }
        .mindmap-idle .mindmap-node:nth-child(5) { animation-delay: 2.4s; }
        .mindmap-idle .mindmap-node:nth-child(6) { animation-delay: 3s; }
        .mindmap-idle .mindmap-node:nth-child(7) { animation-delay: 3.6s; }
        .mindmap-idle .mindmap-node:nth-child(8) { animation-delay: 4.2s; }
        @keyframes mmNodeBreathe {
            0%, 100% { fill: rgba(74,222,128,0.08); stroke: rgba(74,222,128,0.2); }
            50% { fill: rgba(74,222,128,0.2); stroke: rgba(74,222,128,0.5); }
        }
        .mindmap-active .mindmap-node {
            fill: rgba(74,222,128,0.3);
        }
        .mindmap-active .mindmap-node.lit {
            fill: #4ade80;
            filter: drop-shadow(0 0 4px rgba(74,222,128,0.6));
        }
        .mindmap-active .mindmap-node.lit-sonnet {
            fill: #8b5cf6;
            filter: drop-shadow(0 0 4px rgba(139,92,246,0.6));
        }
        .mindmap-active .mindmap-node.lit-whisper {
            fill: #facc15;
            filter: drop-shadow(0 0 4px rgba(250,204,21,0.6));
        }
        .mindmap-active .mindmap-node.lit-ollama {
            fill: #f97316;
            filter: drop-shadow(0 0 4px rgba(249,115,22,0.6));
        }
        .mindmap-active .mindmap-node.lit-sd {
            fill: #ec4899;
            filter: drop-shadow(0 0 4px rgba(236,72,153,0.6));
        }
        .mindmap-active .mindmap-node.lit-browser {
            fill: #3b82f6;
            filter: drop-shadow(0 0 4px rgba(59,130,246,0.6));
        }
        .mindmap-active .mindmap-node.lit-x {
            fill: #1d9bf0;
            filter: drop-shadow(0 0 4px rgba(29,155,240,0.6));
        }
        .mindmap-active .mindmap-node.lit-sorare {
            fill: #ffd700;
            filter: drop-shadow(0 0 4px rgba(255,215,0,0.6));
        }
        .mindmap-active .mindmap-node.lit-dex {
            fill: #a855f7;
            filter: drop-shadow(0 0 4px rgba(168,85,247,0.6));
        }
        .mindmap-active .mindmap-node.lit-gmail {
            fill: #ef4444;
            filter: drop-shadow(0 0 4px rgba(239,68,68,0.6));
        }
        .mindmap-active .mindmap-node.lit-whatsapp {
            fill: #25d366;
            filter: drop-shadow(0 0 4px rgba(37,211,102,0.6));
        }
        .mindmap-active .mindmap-node.lit-finnhub {
            fill: #06b6d4;
            filter: drop-shadow(0 0 4px rgba(6,182,212,0.6));
        }
        .mindmap-line {
            stroke: transparent;
            stroke-width: 0.5;
            transition: stroke 0.3s;
        }
        .mindmap-idle .mindmap-line {
            stroke: transparent;
        }
        .mindmap-active .mindmap-line {
            stroke: transparent;
        }
        .mindmap-active .mindmap-line.lit {
            stroke: rgba(74,222,128,0.4);
            stroke-width: 0.7;
            stroke-dasharray: none;
            animation: mmLineDartOut 0.5s ease-out forwards;
        }
        @keyframes mmLineDartOut {
            0% { stroke-dasharray: 200; stroke-dashoffset: 200; }
            100% { stroke-dasharray: 200; stroke-dashoffset: 0; }
        }
        .mindmap-hub {
            fill: #0a0a0a;
            stroke: rgba(74,222,128,0.3);
            stroke-width: 1;
            transition: stroke 0.5s;
        }
        .mindmap-idle .mindmap-hub {
            animation: mmHubCoreBreathe 3.5s ease-in-out infinite;
        }
        .mindmap-active .mindmap-hub {
            stroke: rgba(74,222,128,0.8);
            filter: drop-shadow(0 0 10px rgba(74,222,128,0.5));
        }
        @keyframes mmHubCoreBreathe {
            0%, 100% { stroke: rgba(74,222,128,0.2); filter: drop-shadow(0 0 3px rgba(74,222,128,0.1)); }
            50% { stroke: rgba(74,222,128,0.5); filter: drop-shadow(0 0 10px rgba(74,222,128,0.35)); }
        }
        .mindmap-hub-ring {
            fill: none;
            stroke: rgba(74,222,128,0.15);
            stroke-width: 0.5;
            stroke-dasharray: 3 3;
            transition: stroke 0.5s;
        }
        .mindmap-orb {
            fill: none;
            stroke-width: 0;
        }
        .mindmap-orb-outer {
            fill: rgba(74,222,128,0.03);
            animation: mmOrbBreathe 3.5s ease-in-out infinite;
        }
        .mindmap-orb-mid {
            fill: rgba(74,222,128,0.05);
            animation: mmOrbBreathe 3.5s ease-in-out infinite 0.5s;
        }
        .mindmap-active .mindmap-orb-outer {
            fill: rgba(74,222,128,0.08);
            animation: mmOrbActive 1.8s ease-in-out infinite;
        }
        .mindmap-active .mindmap-orb-mid {
            fill: rgba(74,222,128,0.12);
            animation: mmOrbActive 1.8s ease-in-out infinite 0.3s;
        }
        @keyframes mmOrbBreathe {
            0%, 100% { fill: rgba(74,222,128,0.02); }
            50% { fill: rgba(74,222,128,0.15); }
        }
        @keyframes mmOrbActive {
            0%, 100% { fill: rgba(74,222,128,0.06); }
            50% { fill: rgba(74,222,128,0.2); }
        }
        .mindmap-idle .mindmap-hub-ring {
            animation: mmHubBreathe 4s ease-in-out infinite;
        }
        .mindmap-active .mindmap-hub-ring {
            stroke: rgba(74,222,128,0.4);
            animation: hubSpin 3s linear infinite;
        }
        @keyframes hubSpin { to { stroke-dashoffset: -24; } }
        @keyframes mmHubBreathe {
            0%, 100% { stroke: rgba(74,222,128,0.15); filter: drop-shadow(0 0 2px rgba(74,222,128,0.1)); }
            50% { stroke: rgba(74,222,128,0.5); filter: drop-shadow(0 0 8px rgba(74,222,128,0.3)); }
        }
        .mindmap-glow {
            transition: opacity 0.5s;
        }
        .mindmap-idle .mindmap-glow {
            opacity: 0.08;
            animation: mmGlowBreathe 4s ease-in-out infinite;
        }
        .mindmap-active .mindmap-glow {
            opacity: 0.3;
            animation: mmGlowActive 1.5s ease-in-out infinite;
        }
        @keyframes mmGlowBreathe {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.4; }
        }
        @keyframes mmGlowActive {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.4; }
        }

        .mindmap-pulse {
            fill: #4ade80;
            opacity: 0;
        }
        .mm-flow-dot {
            opacity: 0;
            pointer-events: none;
        }
        .mindmap-label {
            font-size: 3.5px;
            fill: rgba(255,255,255,0.9);
            font-weight: bold;
            transition: fill 0.5s;
        }
        /* Sub-agent satellite */
        @keyframes mmOrbit {
            from { transform: rotate(0deg) translateX(28px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(28px) rotate(-360deg); }
        }
        @keyframes mmSubPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        @keyframes mmSubFadeIn {
            0% { opacity: 0; transform: scale(0); }
            60% { opacity: 1; transform: scale(1.15); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes mmSubFadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        @keyframes mmLabelFadeIn {
            0% { opacity: 0; transform: translateY(5px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes mmLabelFadeOut {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-5px); }
        }
        .sa-lobster { position:absolute; width:18px; height:18px; pointer-events:auto; cursor:pointer; transition: opacity 1s ease-out; }
        .sa-lobster.fade-out { opacity:0; }
        .sa-lobster svg { width:100%; height:100%; }
        .sa-lobster-label { position:absolute; top:100%; left:50%; transform:translateX(-50%); font-size:7px; font-weight:600; text-align:center; max-width:60px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-top:1px; pointer-events:none; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
        @keyframes saFloat { 0%,100% { transform:translateY(0); } 50% { transform:translateY(-3px); } }
        .mm-subagent-label-wrap {
            position: absolute;
            right: 0.3rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            max-width: 7rem;
        }
        .mm-subagent-label {
            font-size: 0.45rem;
            color: #8b5cf6;
            background: rgba(139,92,246,0.1);
            border: 1px solid rgba(139,92,246,0.2);
            border-radius: 8px;
            padding: 0.15rem 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.2rem;
            animation: mmLabelFadeIn 0.6s ease-out;
            line-height: 1.3;
            white-space: normal;
            word-wrap: break-word;
            max-width: 6.5rem;
        }
        .mm-subagent-label.done {
            animation: mmLabelFadeOut 1.5s ease-out forwards;
            color: #4ade80;
            border-color: rgba(74,222,128,0.2);
            background: rgba(74,222,128,0.08);
        }
        .mm-subagent-label .dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: #8b5cf6;
            flex-shrink: 0;
            animation: mmSubPulse 1.5s ease-in-out infinite;
        }
        .mm-subagent-label.done .dot {
            background: #4ade80;
            animation: none;
        }
        .mindmap-active .mindmap-label.lit {
            fill: #4ade80;
        }
        /* Sorare Widget */
        .sorare-lineup {
            background: rgba(255,255,255,0.04);
            border-radius: 8px;
            padding: 0.4rem 0.5rem;
            margin-bottom: 0.4rem;
        }
        .sorare-lineup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.3rem;
        }
        .sorare-lineup-name {
            font-size: 0.6rem;
            font-weight: 600;
            color: rgba(255,255,255,0.7);
        }
        .sorare-rank {
            font-size: 0.55rem;
            color: rgba(255,255,255,0.5);
        }
        .sorare-score {
            font-size: 0.85rem;
            font-weight: 700;
            color: #4ade80;
        }
        .sorare-player-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.15rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .sorare-player-row:last-child { border-bottom: none; }
        .sorare-player-name {
            font-size: 0.55rem;
            color: rgba(255,255,255,0.75);
            flex: 1;
        }
        .sorare-player-team {
            font-size: 0.45rem;
            color: rgba(255,255,255,0.35);
            margin-left: 0.3rem;
        }
        .sorare-player-score {
            font-size: 0.55rem;
            font-weight: 600;
            color: #4ade80;
            min-width: 2.5rem;
            text-align: right;
        }
        .sorare-player-score.zero {
            color: rgba(255,255,255,0.25);
        }
        .sorare-task {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .sorare-task:last-child { border-bottom: none; }
        .sorare-task-check {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 1.5px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.5rem;
        }
        .sorare-task-check.done {
            border-color: #4ade80;
            background: rgba(74,222,128,0.15);
            color: #4ade80;
        }
        .sorare-task-name {
            font-size: 0.55rem;
            color: rgba(255,255,255,0.7);
            flex: 1;
        }
        .sorare-task-name.done {
            text-decoration: line-through;
            color: rgba(255,255,255,0.35);
        }
        .sorare-task-time {
            font-size: 0.45rem;
            color: rgba(74,222,128,0.6);
        }
        .sorare-section-label {
            font-size: 0.5rem;
            font-weight: 700;
            color: rgba(255,255,255,0.4);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.3rem;
        }
    </style>
</head>
<body>
    <div class="ptr-spacer" id="ptr-spacer">
        <div class="ptr-icon" id="ptr"><div class="ptr-jane"><img src="icon-192.png" style="width:22px;height:22px;border-radius:50%;"></div></div>
    </div>
    <!-- Page Header (sticky) -->
    <div style="padding: 0.6rem 0.25rem 0.3rem; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:101; background:#0a0a0f; margin: -0.5rem -0.5rem 0; padding-left:0.75rem; padding-right:0.75rem; padding-bottom:0.4rem;">
        <div style="display:flex; align-items:center; gap:0.4rem;">
            <img src="openclaw-logo.png" alt="OpenClaw" style="width:20px;height:20px;border-radius:5px;opacity:0.8;">
            <img src="icon-192.png" alt="Jane" style="width:20px;height:20px;border-radius:5px;">
            <span style="font-size:0.85rem;font-weight:700;color:var(--accent);">Jane</span>
            <span style="font-size:0.6rem;color:var(--text-dim);font-weight:400;">Josh's Personal Assistant</span>
        </div>
        <div style="display:flex;align-items:center;gap:0.4rem;">
            <button id="push-btn" style="display:inline-flex;font-size:0.65rem;background:none;border:none;color:rgba(255,255,255,0.3);padding:0.2rem;cursor:pointer;-webkit-tap-highlight-color:transparent;">üîî</button>
            <span id="greeting" style="font-size:0.7rem;font-weight:600;color:var(--accent);"></span>
        </div>
    </div>
    <script src="dashboard-common.js"></script>
    <script>
        // Toggle desktop night mode remotely
        let desktopNightMode = false;
        async function toggleDesktopNightMode() {
            const pill = document.getElementById('night-mode-pill');
            desktopNightMode = !desktopNightMode;
            pill.textContent = '‚è≥ Toggling...';
            try {
                const r = await fetch('/api/desktop-night-mode', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({enabled: desktopNightMode})
                });
                const d = await r.json();
                pill.innerHTML = desktopNightMode ? '<svg style="display:inline-block;vertical-align:middle;width:12px;height:12px;margin-right:3px;" viewBox="0 0 24 24" fill="none" stroke="#facc15" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>Day' : '<svg style="display:inline-block;vertical-align:middle;width:12px;height:12px;margin-right:3px;" viewBox="0 0 24 24" fill="none" stroke="#a78bfa" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>Night';
                pill.className = 'status-pill' + (desktopNightMode ? ' dim' : '');
            } catch(e) {
                pill.textContent = '‚ùå Error';
                desktopNightMode = !desktopNightMode;
                setTimeout(() => { pill.innerHTML = desktopNightMode ? '<svg style="display:inline-block;vertical-align:middle;width:12px;height:12px;margin-right:3px;" viewBox="0 0 24 24" fill="none" stroke="#facc15" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>Day' : '<svg style="display:inline-block;vertical-align:middle;width:12px;height:12px;margin-right:3px;" viewBox="0 0 24 24" fill="none" stroke="#a78bfa" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>Night'; }, 2000);
            }
        }

        // Refresh desktop browser remotely
        async function refreshDesktop() {
            const pill = document.getElementById('refresh-desktop-pill');
            pill.textContent = '‚è≥ Refreshing...';
            try {
                const r = await fetch('/api/refresh-desktop', { method: 'POST' });
                const d = await r.json();
                pill.textContent = d.ok ? '‚úÖ Refreshed!' : '‚ùå Failed';
            } catch(e) { pill.textContent = '‚ùå Error'; }
            setTimeout(() => { pill.innerHTML = '<svg style="display:inline-block;vertical-align:middle;width:12px;height:12px;margin-right:3px;" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>Desktop'; }, 2000);
        }

        // Pause CSS animations when tab is hidden (audit item #12)
        initAnimationPauseOnHidden();
        
        function updateGreeting() {
            const h = new Date().getHours();
            let g;
            if (h < 12) g = 'Good morning, Josh';
            else if (h < 17) g = 'Good afternoon, Josh';
            else g = 'Good evening, Josh';
            document.getElementById('greeting').textContent = g;
        }
        updateGreeting();
        setInterval(updateGreeting, 60000);
    </script>
    <!-- Jane Status Bar (sticky, below header) -->
    <div class="card" id="status-card" style="cursor:pointer;position:sticky;top:36px;z-index:100;background:#0a0a0f;border-color:rgba(74,222,128,0.15);border-top:none;border-radius:0 0 12px 12px;margin-top:0;" onclick="toggleStatusExpand()">
        <div class="status-bar">
            <div class="status-pills">
                <span class="status-pill dim" id="age-pill">Day --</span>
                <span class="status-pill" id="cpu-pill">CPU: --%</span>
                <span class="status-pill" id="ram-pill">RAM: --%</span>
                <span class="status-pill" id="mini2-pill">Mini2: --</span>
                <span class="status-pill" id="mini1-pill">Mini1: --</span>
                <span class="status-pill green" id="refresh-desktop-pill" style="cursor:pointer;" onclick="event.stopPropagation();refreshDesktop()"><svg style="display:inline-block;vertical-align:middle;width:12px;height:12px;margin-right:3px;" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>Desktop</span>
                <span class="status-pill" id="night-mode-pill" style="cursor:pointer;" onclick="event.stopPropagation();toggleDesktopNightMode()"><svg style="display:inline-block;vertical-align:middle;width:12px;height:12px;margin-right:3px;" viewBox="0 0 24 24" fill="none" stroke="#a78bfa" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>Night</span>
            </div>
        </div>
        <div id="status-expanded" style="display:none;margin-top:0.3rem;padding-top:0.3rem;border-top:1px solid rgba(255,255,255,0.06);">
            <div class="status-pills">
                <span class="status-pill" id="ram-detail-pill">M1: --% ¬∑ M2: --%</span>
            </div>
        </div>
    </div>

    <!-- Connected Accounts (collapsible) -->
    <div class="card" id="conn-card" style="padding:0.5rem 0.75rem;">
        <div id="conn-toggle" style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;-webkit-tap-highlight-color:transparent;">
            <span style="font-size:0.7rem;font-weight:700;color:var(--accent);display:flex;align-items:center;gap:0.3rem;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="var(--accent)"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                Connected Accounts
            </span>
            <span id="conn-arrow" style="font-size:0.6rem;color:var(--text-dim);transition:transform 0.3s;">‚ñ∂</span>
        </div>
        <div id="conn-body" style="display:none;margin-top:0.5rem;">
            <div style="font-size:0.55rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-dim);font-weight:600;margin-bottom:0.2rem;">My Accounts</div>
            <div id="conn-accounts" style="display:grid;grid-template-columns:1fr 1fr;gap:0.15rem 0.5rem;"></div>
            <div style="border-top:1px solid rgba(255,255,255,0.05);margin:0.3rem 0;"></div>
            <div style="font-size:0.55rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-dim);font-weight:600;margin-bottom:0.2rem;">Data Connections</div>
            <div id="conn-datasources" style="display:grid;grid-template-columns:1fr 1fr;gap:0.15rem 0.5rem;"></div>
            <div id="conn-newsletters-section" style="display:none;">
                <div style="border-top:1px solid rgba(255,255,255,0.05);margin:0.3rem 0;"></div>
                <div style="font-size:0.55rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-dim);font-weight:600;margin-bottom:0.2rem;">üìß Newsletters</div>
                <div id="conn-newsletters" style="display:grid;grid-template-columns:1fr 1fr;gap:0.15rem 0.5rem;"></div>
            </div>
            <div id="conn-podcasts-section" style="display:none;">
                <div style="border-top:1px solid rgba(255,255,255,0.05);margin:0.3rem 0;"></div>
                <div style="font-size:0.55rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-dim);font-weight:600;margin-bottom:0.2rem;">üéôÔ∏è Podcasts (14)</div>
                <div id="conn-podcasts" style="display:grid;grid-template-columns:1fr 1fr;gap:0.15rem 0.5rem;"></div>
            </div>
        </div>
    </div>

    <!-- Mind Map (floating, no card background) -->
    <div class="mindmap-card mindmap-idle" id="mindmap-card" style="background:transparent;border:none;">
        <span class="mindmap-header">MIND MAP</span>
        <div style="position:absolute;top:0.4rem;right:0.75rem;display:flex;gap:0.4rem;align-items:center;">
            <span class="mm-legend-dot" id="mm-dot-opus" style="color:#4ade80;font-size:0.5rem;opacity:0.35;">‚óè <span style="font-size:0.45rem;color:white;">Opus</span></span>
            <span class="mm-legend-dot" id="mm-dot-sonnet" style="color:#a78bfa;font-size:0.5rem;opacity:0.35;">‚óè <span style="font-size:0.45rem;color:white;">Sonnet</span></span>
            <span class="mm-legend-dot" id="mm-dot-whisper" style="color:#facc15;font-size:0.5rem;opacity:0.35;">‚óè <span style="font-size:0.45rem;color:white;">Whisper</span></span>
            <span class="mm-legend-dot" id="mm-dot-ollama" style="color:#f97316;font-size:0.5rem;opacity:0.35;">‚óè <span style="font-size:0.45rem;color:white;">Ollama</span></span>
            <span class="mm-legend-dot" id="mm-dot-qwen" style="color:#ec4899;font-size:0.5rem;opacity:0.35;">‚óè <span style="font-size:0.45rem;color:white;">Qwen</span></span>
        </div>
        <canvas id="neural-sphere" class="neural-sphere-canvas" width="280" height="210"></canvas>
        <svg class="mindmap-svg" viewBox="-10 -12 180 115" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <radialGradient id="mmGlow" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" stop-color="rgba(74,222,128,0.12)"/>
                    <stop offset="40%" stop-color="rgba(74,222,128,0.04)"/>
                    <stop offset="100%" stop-color="rgba(74,222,128,0)"/>
                </radialGradient>
            </defs>
            <g id="mm-lines">
                <line x1="80.0" y1="36.0" x2="80.0" y2="0.5" class="mindmap-line" data-node="0"/>
                <line x1="87.7" y1="40.4" x2="122.9" y2="19.3" class="mindmap-line" data-node="1"/>
                <line x1="89.0" y1="45.0" x2="147.5" y2="45.0" class="mindmap-line" data-node="2"/>
                <line x1="87.7" y1="49.6" x2="122.9" y2="70.7" class="mindmap-line" data-node="3"/>
                <line x1="80.0" y1="54.0" x2="80.0" y2="89.5" class="mindmap-line" data-node="4"/>
                <line x1="72.3" y1="49.6" x2="37.1" y2="70.7" class="mindmap-line" data-node="5"/>
                <line x1="71.0" y1="45.0" x2="12.5" y2="45.0" class="mindmap-line" data-node="6"/>
                <line x1="72.3" y1="40.4" x2="37.1" y2="19.3" class="mindmap-line" data-node="7"/>
            </g>
            <g id="mm-nodes">
                <circle cx="80" cy="-2" r="2.5" class="mindmap-node" data-node="0"/>
                <circle cx="125" cy="18" r="2.5" class="mindmap-node" data-node="1"/>
                <circle cx="150" cy="45" r="2.5" class="mindmap-node" data-node="2"/>
                <circle cx="125" cy="72" r="2.5" class="mindmap-node" data-node="3"/>
                <circle cx="80" cy="92" r="2.5" class="mindmap-node" data-node="4"/>
                <circle cx="35" cy="72" r="2.5" class="mindmap-node" data-node="5"/>
                <circle cx="10" cy="45" r="2.5" class="mindmap-node" data-node="6"/>
                <circle cx="35" cy="18" r="2.5" class="mindmap-node" data-node="7"/>
            </g>
            <g id="mm-labels">
                <text x="80" y="-8" class="mindmap-label" data-node="0" text-anchor="middle">REASONING</text>
                <text x="130" y="19" class="mindmap-label" data-node="1" text-anchor="start">CODING</text>
                <text x="155" y="46" class="mindmap-label" data-node="2" text-anchor="start">RESEARCH</text>
                <text x="130" y="77" class="mindmap-label" data-node="3" text-anchor="start">COMMS</text>
                <text x="80" y="100" class="mindmap-label" data-node="4" text-anchor="middle">CONTENT</text>
                <text x="30" y="77" class="mindmap-label" data-node="5" text-anchor="end">MARKETS</text>
                <text x="5" y="46" class="mindmap-label" data-node="6" text-anchor="end">BROWSING</text>
                <text x="30" y="19" class="mindmap-label" data-node="7" text-anchor="end">MEMORY</text>
            </g>
            <g id="mm-pulses">
                <g id="mm-flow-container"></g>
            </g>
            <circle cx="80" cy="45" r="18" class="mindmap-orb mindmap-orb-outer"/>
            <circle cx="80" cy="45" r="14" class="mindmap-orb mindmap-orb-mid"/>
            <circle cx="80" cy="45" r="12" class="mindmap-hub-ring"/>
            <circle cx="80" cy="45" r="9" class="mindmap-hub"/>
            <image href="icon-192.png" x="73" y="38" width="14" height="14" opacity="0.7"/>
            <!-- Sub-agent satellites (legacy, unused) -->
            <g id="mm-subagents"></g>
        </svg>
        <div id="sa-orbit-mobile" style="position:absolute;inset:0;pointer-events:none;"></div>
        <div id="mm-subagent-labels" class="mm-subagent-label-wrap"></div>
    </div>

    <!-- Jane's Mind -->
    <div class="card mind-card" id="mind-card">
        <div class="mind-header">
            <span class="mind-title"><img src="icon-192.png" style="width:16px;height:16px;border-radius:50%;vertical-align:middle;margin-right:4px;filter:drop-shadow(0 0 4px rgba(74,222,128,0.5));">Jane's Mind</span>
            <span class="mind-status-dot" id="mind-dot"></span>
        </div>
        <div id="mind-content">
            <div class="mind-idle">Idle ‚Äî waiting for Josh<span class="mind-idle-dots"></span></div>
        </div>
        <div id="mind-sections" style="display:none;">
            <div class="mind-section">
                <div class="mind-section-label">GOAL / OBJECTIVE</div>
                <div class="mind-task-text" id="mind-task-text">Awaiting instructions...</div>
            </div>
            <div class="mind-section">
                <div class="mind-section-label">THINKING &amp; DECISIONS</div>
                <div class="mind-thought-text" id="mind-thought-text">Ready for your next request.</div>
            </div>
            <div class="mind-section" id="mind-actions-section" style="display:none;">
                <div class="mind-section-label">ACTIONS &amp; TOOLS</div>
                <div class="mind-steps" id="mind-steps"></div>
            </div>
        </div>
    </div>

    <!-- Today's Jobs Widget -->
    <div class="card" id="cron-widget" style="padding:0;font-size:11px;cursor:pointer;transition:all 0.25s ease;border:1px solid rgba(74,222,128,0.15);overflow:hidden;" onclick="toggleCronWidget(event)">
        <div id="cron-bar" style="display:flex;align-items:center;gap:0.5rem;padding:0.35rem 0.6rem;">
            <svg width="16" height="16" viewBox="0 0 24 24" style="filter:drop-shadow(0 0 4px var(--accent));animation:cronSpin 8s linear infinite;"><rect x="4" y="8" width="16" height="12" rx="3" fill="none" stroke="var(--accent)" stroke-width="1.5"/><circle cx="9" cy="14" r="1.5" fill="var(--accent)"/><circle cx="15" cy="14" r="1.5" fill="var(--accent)"/><line x1="12" y1="5" x2="12" y2="8" stroke="var(--accent)" stroke-width="1.5"/><circle cx="12" cy="4" r="1.5" fill="var(--accent)"/><line x1="2" y1="13" x2="4" y2="13" stroke="var(--accent)" stroke-width="1.5"/><line x1="20" y1="13" x2="22" y2="13" stroke="var(--accent)" stroke-width="1.5"/></svg>
            <style>@keyframes cronSpin{0%,100%{filter:drop-shadow(0 0 4px #4ade80)}50%{filter:drop-shadow(0 0 8px #4ade80) brightness(1.2)}}</style>
            <span style="color:var(--accent);font-weight:600;font-size:11px;letter-spacing:0.3px;opacity:0.85;">Today's Jobs:</span>
            <span id="cron-count" style="color:var(--accent);font-weight:900;font-size:13px;margin-left:auto;">--</span>
            <span id="cron-hint" style="color:rgba(255,255,255,0.2);font-size:8px;font-style:italic;">tap to expand</span>
            <span id="cron-chevron" style="color:rgba(74,222,128,0.4);font-size:9px;transition:transform 0.25s ease;">‚ñæ</span>
        </div>
        <div id="cron-expanded" style="max-height:0;overflow:hidden;transition:max-height 0.4s ease;">
            <div id="cron-pages" style="width:100%;">
                <div id="cron-list" style="width:100%;padding:0 0.6rem;box-sizing:border-box;"></div>
            </div>
        </div>
    </div>

    <!-- Ticker Strip -->
    <div class="card" id="ticker-strip" style="padding:0.4rem 0.6rem;overflow:hidden;">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:0.3rem;" id="ticker-row">
            <span class="tk" id="tk-btc"><img src="https://assets.coingecko.com/coins/images/1/small/bitcoin.png" class="tk-logo" loading="lazy"> <span class="tk-c">--%</span></span>
            <span class="tk" id="tk-eth"><img src="https://assets.coingecko.com/coins/images/279/small/ethereum.png" class="tk-logo" loading="lazy"> <span class="tk-c">--%</span></span>
            <span class="tk" id="tk-sol"><img src="https://assets.coingecko.com/coins/images/4128/small/solana.png" class="tk-logo" loading="lazy"> <span class="tk-c">--%</span></span>
            <span class="tk" id="tk-ndaq"><img src="https://www.nasdaq.com/sites/acquia.prod/files/2020/09/24/nasdaq.jpg" class="tk-logo" loading="lazy" style="border-radius:3px;object-fit:cover;"> <span class="tk-c">--%</span></span>
            <span class="tk tk-placeholder" id="tk-slot5"><span style="width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,0.08);display:inline-block;vertical-align:middle;"></span> <span class="tk-c" style="color:rgba(255,255,255,0.15);">--%</span></span>
            <span class="tk tk-placeholder" id="tk-slot6"><span style="width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,0.08);display:inline-block;vertical-align:middle;"></span> <span class="tk-c" style="color:rgba(255,255,255,0.15);">--%</span></span>
        </div>
        <div id="ticker-expanded" style="display:none;margin-top:0.4rem;border-top:1px solid rgba(255,255,255,0.06);padding-top:0.4rem;">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.3rem 0.8rem;" id="ticker-prices"></div>
        </div>
    </div>

    <!-- Coinbase Wallet + Trades -->
    <div class="card" id="wallet-card" style="padding:0.5rem 0.75rem;">
        <div id="wallet-header" style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onclick="toggleWalletCard()">
            <div style="display:flex;align-items:center;gap:0.4rem;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0a0a0a" stroke-width="2" style="flex-shrink:0;background:#4ade80;border-radius:50%;padding:2px;"><rect x="2" y="6" width="20" height="14" rx="3"/><path d="M16 12h2v4h-2z" fill="#0a0a0a"/><path d="M6 6V4a2 2 0 012-2h8a2 2 0 012 2v2"/></svg>
                <div style="display:flex;align-items:center;gap:0.4rem;">
                    <span style="font-size:0.75rem;font-weight:700;color:#4ade80;">MyWallet</span>
                    <span id="wallet-total" style="font-size:0.8rem;font-weight:700;color:#fff;">$--</span>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:0.4rem;">
                <button id="wallet-refresh-btn" onclick="event.stopPropagation();refreshWallet(this)" style="background:none;border:none;color:var(--accent);font-size:0.8rem;cursor:pointer;padding:0.2rem;">‚Üª</button>
                <span id="wallet-chevron" style="font-size:0.6rem;color:rgba(255,255,255,0.4);transition:transform 0.2s;transform:rotate(180deg);">‚ñº</span>
            </div>
        </div>
        <!-- Chain balances (always visible) -->
        <div id="wallet-chains" style="display:flex;gap:0.5rem;margin-top:0.4rem;"></div>
        <!-- Active trades (always visible) -->
        <div id="wallet-trades" style="margin-top:0.4rem;"></div>
        <!-- Expanded details -->
        <div id="wallet-expanded" style="display:block;margin-top:0.4rem;border-top:1px solid rgba(255,255,255,0.06);padding-top:0.4rem;">
            <div id="wallet-budget" style="display:flex;gap:0.4rem;flex-wrap:wrap;margin-bottom:0.3rem;"></div>
            <div id="wallet-closed" style="font-size:0.55rem;color:var(--text-dim);"></div>
        </div>
    </div>

    <!-- X/Twitter ‚Äî Unified Widget -->
    <div class="card" id="tweet-feed" style="padding:0.5rem 0.6rem;overflow:hidden;">
        <!-- Stats bar (always visible) -->
        <div id="x-strip" style="display:flex;align-items:center;justify-content:space-between;padding-bottom:0.4rem;border-bottom:1px solid rgba(255,255,255,0.06);margin-bottom:0.4rem;">
            <div style="display:flex;align-items:center;gap:0.35rem;">
                <img id="x-pfp" src="x-pfp.jpg" style="width:18px;height:18px;border-radius:50%;border:1px solid rgba(255,255,255,0.15);">
                <span class="x-stat" id="x-engagement"><span class="x-val" style="font-size:0.65rem;color:#4ade80;">--</span> <span class="x-lbl">eng</span></span>
            </div>
            <span class="x-stat" id="x-followers"><span class="x-val">--</span> <span class="x-lbl">flw</span> <span class="x-delta" id="x-d-followers"></span></span>
            <span class="x-stat" id="x-impressions"><span class="x-val">--</span> <span class="x-lbl">views</span> <span class="x-delta" id="x-d-impressions"></span></span>
            <span class="x-stat" id="x-likes"><span class="x-val">--</span> <span class="x-lbl">likes</span> <span class="x-delta" id="x-d-likes"></span></span>
            <span class="x-stat" id="x-planned-replies"><span class="x-plan-dot" style="background:#1d9bf0;"></span> <span class="x-val">--</span> <span class="x-lbl">replies</span></span>
            <span class="x-stat" id="x-planned-tweets"><span class="x-plan-dot" style="background:#4ade80;"></span> <span class="x-val">--</span> <span class="x-lbl">tweets</span></span>
        </div>
        <!-- Thread navigation -->
        <div id="tweet-thread-label" style="display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.4rem;">
            <span id="tweet-nav-left" onclick="swipeThread(1)" style="font-size:0.7rem;color:rgba(255,255,255,0.25);cursor:pointer;padding:0 0.3rem;display:none;">‚óÄ</span>
            <span id="tweet-thread-date" style="font-size:0.55rem;font-weight:600;color:#4ade80;"></span>
            <span id="tweet-nav-dots" style="font-size:0.4rem;color:rgba(255,255,255,0.3);letter-spacing:3px;"></span>
            <span id="tweet-nav-right" onclick="swipeThread(-1)" style="font-size:0.7rem;color:rgba(255,255,255,0.25);cursor:pointer;padding:0 0.3rem;display:none;">‚ñ∂</span>
            <span style="display:none;" id="tweet-feed-time"></span>
        </div>
        <!-- Thread content (swipeable) -->
        <div id="tweet-swipe-container" style="position:relative;touch-action:pan-y;">
            <div id="tweet-feed-list" style="display:flex;flex-direction:column;gap:0.5rem;transition:opacity 0.25s ease;"></div>
        </div>
    </div>

    <!-- Sorare Widget -->
    <div class="card" id="sorare-widget" style="padding:0.5rem 0.75rem;">
        <div id="sorare-header" style="display:flex;align-items:center;gap:0.4rem;cursor:pointer;" onclick="toggleSorare()">
            <svg width="18" height="18" viewBox="0 0 24 24" style="flex-shrink:0;"><circle cx="12" cy="12" r="10" fill="none" stroke="#4ade80" stroke-width="2"/><path d="M12 2C12 2 9 8 9 12s3 10 3 10M12 2c0 0 3 6 3 10s-3 10-3 10M2 12h20" fill="none" stroke="#4ade80" stroke-width="1.2"/></svg>
            <span style="font-size:0.7rem;font-weight:700;color:rgba(255,255,255,0.85);">SORARE NBA</span>
            <span id="sorare-gw-badge" style="font-size:0.5rem;background:rgba(74,222,128,0.15);color:#4ade80;padding:0.1rem 0.35rem;border-radius:6px;font-weight:600;">GW--</span>
            <span id="sorare-status-badge" style="font-size:0.5rem;padding:0.1rem 0.35rem;border-radius:6px;font-weight:600;margin-left:auto;">--</span>
            <span id="sorare-chevron" style="font-size:0.6rem;color:rgba(255,255,255,0.4);transition:transform 0.2s;">‚ñº</span>
        </div>
        <div id="sorare-body" style="display:none;margin-top:0.5rem;">
            <div id="sorare-daily-tasks" style="margin-bottom:0.6rem;"></div>
            <div id="sorare-crafting" style="margin-bottom:0.6rem;"></div>
            <div id="sorare-active" style="margin-bottom:0.6rem;"></div>
            <div id="sorare-upcoming"></div>
        </div>
    </div>

    <script>
        // fetchJSON ‚Üí now in dashboard-common.js

        async function refreshStatus() {
            const [sessions, system] = await Promise.all([
                fetchJSON('/api/sessions').then(r => r, () => fetchJSON('/sessions.json')).catch(() => null),
                fetchJSON('/api/system').then(r => r, () => fetchJSON('/system-status.json')).catch(() => null)
            ]);

            // Age pill: show day number since Jan 31, 2026
            const birthDate = new Date('2026-01-31T00:00:00-05:00');
            const dayNum = Math.floor((Date.now() - birthDate.getTime()) / 86400000);
            document.getElementById('age-pill').textContent = 'Day ' + dayNum;

            if (system) {
                document.getElementById('cpu-pill').textContent = 'CPU: ' + (system.cpu || 0) + '%';
                // Blended RAM: average of Mini #1 + Mini #2 (both 16GB)
                const m1Ram = system.memory || 0;
                const m2Ram = system.mini2 ? (system.mini2.memory || 0) : m1Ram;
                const blendedRam = Math.round((m1Ram + m2Ram) / 2);
                document.getElementById('ram-pill').textContent = 'RAM: ' + blendedRam + '%';

                // Age pill handled above (day count)

                // Expanded row ‚Äî combined RAM detail
                // Main row Mini1 pill
                const m1Online = system.cpu !== undefined;
                document.getElementById('mini1-pill').textContent = 'Mini1: ' + (m1Online ? '‚úì' : '‚úó');
                document.getElementById('mini1-pill').className = 'status-pill ' + (m1Online ? 'green' : 'red');

                const m2 = document.getElementById('mini2-pill');
                if (system.mini2) {
                    if (system.mini2.online) {
                        m2.textContent = 'Mini2: ‚úì';
                        m2.className = 'status-pill green';
                    } else {
                        m2.textContent = 'Mini2: ‚úó';
                        m2.className = 'status-pill red';
                    }
                    document.getElementById('ram-detail-pill').textContent = 'M1: ' + (system.memory || 0) + '% ¬∑ M2: ' + (system.mini2.memory || 0) + '%';
                }
            }
        }

        // Ticker tap to expand/collapse
        let tickerExpanded = false;
        let tickerData = null;
        document.getElementById('ticker-strip').addEventListener('click', (e) => {
            tickerExpanded = !tickerExpanded;
            document.getElementById('ticker-expanded').style.display = tickerExpanded ? '' : 'none';
            if (tickerExpanded && tickerData) renderTickerPrices(tickerData);
        });

        function renderTickerPrices(data) {
            const el = document.getElementById('ticker-prices');
            if (!el) return;
            const labels = {btc:'Bitcoin', eth:'Ethereum', sol:'Solana', nasdaq:'NASDAQ'};
            const logos = {
                btc:'https://assets.coingecko.com/coins/images/1/small/bitcoin.png',
                eth:'https://assets.coingecko.com/coins/images/279/small/ethereum.png',
                sol:'https://assets.coingecko.com/coins/images/4128/small/solana.png',
                nasdaq:'https://www.nasdaq.com/sites/acquia.prod/files/2020/09/24/nasdaq.jpg'
            };
            el.innerHTML = Object.entries(data).filter(([key]) => key !== 'ibit').map(([key, val]) => {
                if (!val || !val.price) return '';
                const price = val.price >= 1000 ? '$' + val.price.toLocaleString('en',{maximumFractionDigits:0}) : '$' + val.price.toFixed(2);
                const ch = val.change24h;
                const chStr = ch != null ? (ch >= 0 ? '+' : '') + ch.toFixed(2) + '%' : '';
                const chColor = ch > 0 ? '#4ade80' : ch < 0 ? '#ef4444' : 'rgba(255,255,255,0.5)';
                const logo = logos[key] || '';
                const name = labels[key] || key.toUpperCase();
                return `<div style="display:flex;align-items:center;gap:0.3rem;padding:0.15rem 0;">
                    ${logo ? `<img src="${logo}" style="width:16px;height:16px;border-radius:50%;">` : ''}
                    <span style="font-size:0.6rem;color:rgba(255,255,255,0.7);min-width:50px;">${name}</span>
                    <span style="font-size:0.65rem;font-weight:600;color:white;">${price}</span>
                    <span style="font-size:0.55rem;color:${chColor};margin-left:auto;">${chStr}</span>
                </div>`;
            }).join('');
        }

        async function refreshTicker() {
            const data = await fetchJSON('/api/ticker').then(r => r, () => fetchJSON('/ticker.json')).catch(() => null);
            if (!data) return;
            tickerData = data;
            if (tickerExpanded) renderTickerPrices(data);
            const fmt = (v, isDollar) => {
                if (v == null) return '--';
                if (isDollar) return v >= 1000 ? '$' + v.toLocaleString('en',{maximumFractionDigits:0}) : '$' + v.toFixed(2);
                return v.toFixed(2) + '%';
            };
            const items = {
                btc: data.btc, eth: data.eth, sol: data.sol,
                ndaq: data.nasdaq || data.ndaq
            };
            // Market status dots ‚Äî crypto 24/7, stocks M-F 9:30-4 ET
            const now = new Date();
            const et = new Date(now.toLocaleString('en-US', {timeZone:'America/New_York'}));
            const day = et.getDay(), h = et.getHours(), m = et.getMinutes();
            const stockOpen = day >= 1 && day <= 5 && (h > 9 || (h === 9 && m >= 30)) && h < 16;
            const marketOpen = { btc: true, eth: true, sol: true, ndaq: stockOpen };
            for (const [key, val] of Object.entries(items)) {
                const el = document.getElementById('tk-' + key);
                if (!el || !val) continue;
                const chEl = el.querySelector('.tk-c');
                const ch = val.change24h;
                chEl.textContent = ch != null ? (ch >= 0 ? '+' : '') + ch.toFixed(1) + '%' : '--%';
                chEl.className = 'tk-c ' + (ch > 0 ? 'pos' : ch < 0 ? 'neg' : '');
                // Market status dot
                let dot = el.querySelector('.tk-dot');
                if (!dot) { dot = document.createElement('span'); dot.className = 'tk-dot'; el.prepend(dot); }
                const open = marketOpen[key];
                dot.style.cssText = 'display:inline-block;width:4px;height:4px;border-radius:50%;margin-right:1px;background:' + (open ? '#4ade80' : '#ef4444');
            }
        }

        async function refreshXStats() {
            const data = await fetchJSON('/x-stats.json');
            if (!data) return;
            const fmt = v => v >= 1000 ? (v/1000).toFixed(1) + 'K' : String(v);
            const set = (id, val) => { const el = document.querySelector('#' + id + ' .x-val'); if (el) el.textContent = val; };
            set('x-engagement', data.engagementRate || '--');
            set('x-followers', fmt(data.followers || 0));
            set('x-impressions', fmt(data.impressions || 0));
            set('x-likes', fmt(data.likes || 0));
            // 24h growth deltas
            const prev = data.prev24h || {};
            const showDelta = (id, current, previous) => {
                const el = document.getElementById(id);
                if (!el || previous == null) { if (el) el.textContent = ''; return; }
                const diff = current - previous;
                if (diff > 0) { el.textContent = '+' + fmt(diff); el.className = 'x-delta up'; }
                else if (diff < 0) { el.textContent = fmt(diff); el.className = 'x-delta down'; }
                else { el.textContent = '‚Äî'; el.className = 'x-delta flat'; }
            };
            showDelta('x-d-followers', data.followers, prev.followers);
            showDelta('x-d-impressions', data.impressions, prev.impressions);
            showDelta('x-d-likes', data.likes, prev.likes);
            // Planned content ‚Äî from rolling 24h content plan
            const plan = await fetchJSON('/x-content-plan.json');
            const setP = (id, val) => { const el = document.querySelector('#' + id + ' .x-val'); if (el) el.textContent = val != null ? String(val) : '--'; };
            if (plan && plan.plan) {
                const r = plan.plan.replies || {};
                const t = plan.plan.threads || {};
                setP('x-planned-replies', (r.planned || 0) - (r.completed || 0));
                setP('x-planned-tweets', (t.planned || 0) - (t.completed || 0));
            } else if (plan && plan.rolling24h) {
                const r = plan.rolling24h.replies || {};
                const t = plan.rolling24h.originalTweets || {};
                setP('x-planned-replies', (r.planned || 0) - (r.completed || 0));
                setP('x-planned-tweets', (t.planned || 0) - (t.completed || 0));
            } else {
                setP('x-planned-replies', data.plannedReplies);
                setP('x-planned-tweets', data.plannedTweets);
            }
        }

        // Thread swipe state
        window._threadData = [];
        window._threadIdx = 0;
        window._swipeStartX = 0;

        async function refreshTweetFeed() {
            // Try history file first, fall back to latest
            let histData = await fetchJSON('/x-thread-history.json');
            if (histData && histData.threads && histData.threads.length > 0) {
                window._threadData = histData.threads;
            } else {
                const data = await fetchJSON('/x-latest-tweets.json');
                if (data && data.tweets) {
                    window._threadData = [{ date: 'Latest', label: 'Latest', tweets: data.tweets, lastUpdated: data.lastUpdated }];
                } else return;
            }
            // Always show first (latest) thread on refresh unless user swiped
            renderThread(window._threadIdx);
            setupSwipeGesture();
        }

        function renderThread(idx) {
            const threads = window._threadData;
            if (!threads || !threads.length) return;
            idx = Math.max(0, Math.min(idx, threads.length - 1));
            window._threadIdx = idx;
            const thread = threads[idx];
            // Glow effect on fresh data
            const feedCard = document.getElementById('tweet-feed');
            if (feedCard && thread.lastUpdated && (Date.now() - thread.lastUpdated) < 600000) {
                feedCard.classList.add('glow-blue');
            } else if (feedCard) {
                feedCard.classList.remove('glow-blue');
            }
            const container = document.getElementById('tweet-feed-list');
            const timeEl = document.getElementById('tweet-feed-time');
            const dateEl = document.getElementById('tweet-thread-date');
            const dotsEl = document.getElementById('tweet-nav-dots');
            const leftBtn = document.getElementById('tweet-nav-left');
            const rightBtn = document.getElementById('tweet-nav-right');

            // Update nav
            if (dateEl) dateEl.textContent = thread.label || thread.date || '';
            if (dotsEl) dotsEl.innerHTML = threads.map((_, i) => '<span style="color:' + (i === idx ? '#4ade80' : 'rgba(255,255,255,0.2)') + ';">‚óè</span>').join('');
            if (leftBtn) leftBtn.style.display = idx < threads.length - 1 ? 'inline' : 'none';
            if (rightBtn) rightBtn.style.display = idx > 0 ? 'inline' : 'none';

            const lu = thread.lastUpdated || (window._threadData === threads ? threads[0].lastUpdated : null);
            if (timeEl && lu) {
                const ago = Math.round((Date.now() - lu) / 60000);
                timeEl.textContent = ago < 1 ? 'just now' : ago < 60 ? ago + 'm ago' : Math.round(ago/60) + 'h ago';
            }

            // Animate
            container.style.opacity = '0';
            setTimeout(() => {
                container.innerHTML = '';
                (thread.tweets || []).forEach((rawTweet, i) => {
                    const tweet = typeof rawTweet === 'string' ? { text: rawTweet } : rawTweet;
                    const div = document.createElement('div');
                    div.style.cssText = 'padding:0.4rem 0.5rem;background:rgba(255,255,255,0.03);border-radius:8px;border-left:2px solid ' + (i === 0 ? '#4ade80' : 'rgba(255,255,255,0.08)') + ';';
                    let timeDisplay = '';
                    if (tweet.time) {
                        const t = new Date(tweet.time);
                        const mins = Math.round((Date.now() - t.getTime()) / 60000);
                        if (mins < 1) timeDisplay = 'just now';
                        else if (mins < 60) timeDisplay = mins + 'm ago';
                        else if (mins < 1440) timeDisplay = Math.round(mins/60) + 'h ago';
                        else timeDisplay = t.toLocaleDateString([], {month:'short', day:'numeric'}) + ' ' + t.toLocaleTimeString([], {hour:'numeric', minute:'2-digit'});
                    }
                    const threadNum = tweet.threadNum ? '<span style="color:#4ade80;font-weight:600;font-size:0.55rem;margin-right:4px;">' + tweet.threadNum + '</span>' : '';
                    div.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:3px;">' +
                        '<div>' + threadNum + '<span style="font-size:0.5rem;color:rgba(255,255,255,0.35);">' + timeDisplay + '</span></div>' +
                        '<div style="display:flex;gap:0.4rem;font-size:0.5rem;color:rgba(255,255,255,0.3);">' +
                        (tweet.views ? '<span>üëÅ ' + tweet.views + '</span>' : '') +
                        (tweet.likes ? '<span>‚ù§Ô∏è ' + tweet.likes + '</span>' : '') +
                        (tweet.reposts ? '<span>üîÅ ' + tweet.reposts + '</span>' : '') +
                        '</div></div>' +
                        '<div style="font-size:0.6rem;color:rgba(255,255,255,0.8);line-height:1.4;white-space:pre-wrap;">' + (tweet.text || '') + '</div>';
                    container.appendChild(div);
                });
                container.style.opacity = '1';
            }, 150);
        }

        function swipeThread(dir) {
            // dir: -1 = newer (right arrow), +1 = older (left arrow)
            const newIdx = window._threadIdx + dir;
            if (newIdx >= 0 && newIdx < window._threadData.length) {
                renderThread(newIdx);
            }
        }

        function setupSwipeGesture() {
            const el = document.getElementById('tweet-swipe-container');
            if (!el || el._swipeSetup) return;
            el._swipeSetup = true;
            let startX = 0, startY = 0, tracking = false;
            el.addEventListener('touchstart', e => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                tracking = true;
            }, {passive: true});
            el.addEventListener('touchend', e => {
                if (!tracking) return;
                tracking = false;
                const dx = e.changedTouches[0].clientX - startX;
                const dy = e.changedTouches[0].clientY - startY;
                if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(dy) * 1.5) {
                    if (dx < 0) swipeThread(1);  // swipe left = older
                    else swipeThread(-1);          // swipe right = newer
                }
            }, {passive: true});
        }

        async function refreshMind() {
            const data = await fetchJSON('/mind-state.json');
            if (!data) return;

            const card = document.getElementById('mind-card');
            const dot = document.getElementById('mind-dot');
            const content = document.getElementById('mind-content');
            const sections = document.getElementById('mind-sections');
            const hasActiveSubs = (data.subAgents || []).some(s => s.status === 'active');
            const isActive = data.task != null || hasActiveSubs;

            card.classList.toggle('active', isActive);
            card.classList.toggle('glow', isActive);
            dot.classList.toggle('active', isActive);
            window._mmModel = data.model || 'opus';
            refreshMindMap(isActive, data.steps);

            // Sub-agent lobster satellites
            const subs = data.subAgents || [];
            const saLabels = document.getElementById('mm-subagent-labels');
            const saKey = JSON.stringify(subs);
            if (saKey !== window._lastSubAgentKey) {
                window._lastSubAgentKey = saKey;
                updateSubagentLobsters(subs);
                saLabels.innerHTML = ''; // lobsters have their own labels
            }

            if (!isActive) {
                content.style.display = '';
                const lastGoal = data.lastTask && data.lastTask !== 'Working...' ? `<div style="color:rgba(255,255,255,0.35);font-size:0.65rem;margin-top:0.3rem;">Last: ${esc(data.lastTask)}</div>` : '';
                content.innerHTML = '<div class="mind-idle">Idle ‚Äî waiting for Josh<span class="mind-idle-dots"></span></div>' + lastGoal;
                sections.style.display = 'none';
                return;
            }

            // Hide idle, show sections
            content.style.display = 'none';
            sections.style.display = '';

            // Model/tool color map
            const modelColors = {opus:'#4ade80', claude:'#4ade80', sonnet:'#8b5cf6', whisper:'#facc15', ollama:'#f97316', browser:'#3b82f6', x:'#1d9bf0', twitter:'#1d9bf0', sorare:'#ffd700', dexscreener:'#a855f7', gmail:'#ef4444', whatsapp:'#25d366', finnhub:'#06b6d4', coingecko:'#06b6d4', sd:'#ec4899'};
            const activeColor = modelColors[(data.model||'').toLowerCase()] || 'var(--accent)';

            // Goal / Objective ‚Äî colored by active model
            const goalEl = document.getElementById('mind-task-text');
            goalEl.textContent = data.task || 'Awaiting instructions...';
            goalEl.style.color = activeColor;

            // Thinking & Decisions
            const thoughtEl = document.getElementById('mind-thought-text');
            thoughtEl.textContent = data.thought || 'Ready for your next request.';
            thoughtEl.style.color = activeColor;

            // Actions & Tools (steps) ‚Äî each step colored by its own tool/model
            const stepsEl = document.getElementById('mind-steps');
            if (data.steps && data.steps.length) {
                const indicators = { done: '‚úì', active: '‚óè', pending: '‚óã' };
                stepsEl.innerHTML = data.steps.map(step => {
                    const s = step.status || 'pending';
                    const stepColor = modelColors[(step.tool||'').toLowerCase()] || 'var(--accent)';
                    return `<div class="mind-step ${s}" style="color:${stepColor}"><span class="mind-step-icon">${indicators[s]}</span><span>${esc(step.label)}</span></div>`;
                }).join('');
            } else {
                stepsEl.innerHTML = '';
            }
        }

        // esc() ‚Üí now in dashboard-common.js

        // Tool/label ‚Üí brain region mapping
        // Regions: 0=REASONING, 1=CODE, 2=WEB, 3=SOCIAL, 4=DATA, 5=MARKET, 6=MEMORY, 7=LANGUAGE
        // Keyword ‚Üí brain region mapping
        // Regions: 0=REASONING, 1=CODE, 2=WEB, 3=SOCIAL, 4=DATA, 5=MARKET, 6=MEMORY, 7=LANGUAGE
        // Regions: 0=OPUS, 1=WHISPER, 2=BROWSER, 3=OLLAMA, 4=X/TWITTER, 5=SORARE, 6=DEXSCREENER, 7=GMAIL, 8=WHATSAPP, 9=FINNHUB
        const keywordToRegions = {
            // Reasoning (0)
            reason: [0], analy: [0], think: [0], strateg: [0], plan: [0], evaluat: [0], decision: [0],
            opus: [0], claude: [0], sonnet: [0],
            // Coding (1)
            code: [1], script: [1], build: [1], function: [1], debug: [1], implement: [1],
            shell: [1], command: [1], commit: [1], css: [1], html: [1], svg: [1],
            exec: [1], ollama: [1], qwen: [1], 'local llm': [1],
            // Research (2)
            'web search': [2], 'web fetch': [2], scrape: [2], crawl: [2], url: [2], website: [2],
            'searching': [2], 'fetching': [2], research: [2],
            // Communication (3) ‚Äî includes voice/whisper
            whatsapp: [3], message: [3], gmail: [3], email: [3], inbox: [3], newsletter: [3],
            notification: [3], alert: [3],
            transcri: [3], voice: [3], audio: [3], speech: [3], tts: [3], whisper: [3],
            // Content (4)
            tweet: [4], 'post': [4], reply: [4], 'x timeline': [4], '@': [4], thread: [4], engag: [4], twitter: [4],
            image: [4], 'stable-diffusion': [4], creative: [4],
            // Markets (5) ‚Äî includes sorare/gaming
            finnhub: [5], coingecko: [5], market: [5], price: [5], ticker: [5], solana: [5], bitcoin: [5],
            dexscreener: [5], trad: [5], swap: [5], jupiter: [5], memecoin: [5], kalshi: [5], defi: [5], token: [5],
            sorare: [5], lineup: [5], 'game week': [5], crafting: [5], fantasy: [5],
            // Browsing (6)
            browser: [6], automat: [6], navigate: [6],
            // Memory (7)
            read: [7], write: [7], edit: [7], memory: [7], file: [7], dashboard: [7], context: [7],
        };

        // Model/tool name normalization (tool field ‚Üí canonical tool)
        const modelNames = new Set(['opus','claude','sonnet','whisper','ollama','qwen','sd','browser','web_search','web_fetch','x','twitter','sorare','dexscreener','gmail','email','whatsapp','message','finnhub','coingecko','ticker']);

        function getActiveRegions(steps) {
            const regions = new Map(); // regionIndex ‚Üí model name
            if (!steps || !steps.length) return regions;
            const activeSteps = steps.filter(s => s.status === 'active' || s.status === 'done');
            for (const step of activeSteps) {
                const label = (step.label || '').toLowerCase();
                const tool = (step.tool || '').toLowerCase();
                // Determine model from tool field (should be model name like opus, sonnet, whisper, etc.)
                const model = modelNames.has(tool) ? tool : 'opus';
                let matched = false;
                // Match keywords from label
                for (const [keyword, indices] of Object.entries(keywordToRegions)) {
                    if (label.includes(keyword)) {
                        for (const idx of indices) {
                            if (!regions.has(idx)) regions.set(idx, model);
                        }
                        matched = true;
                    }
                }
                // Also check tool field as keyword (for backward compat)
                if (!matched) {
                    for (const [keyword, indices] of Object.entries(keywordToRegions)) {
                        if (tool.includes(keyword)) {
                            for (const idx of indices) {
                                if (!regions.has(idx)) regions.set(idx, model);
                            }
                            matched = true;
                        }
                    }
                }
                // Default: if tool is a known model/tool, map to its natural region
                if (!matched) {
                    const modelRegion = {opus:0, claude:0, sonnet:0, whisper:3, ollama:1, qwen:1, browser:6, web_search:2, web_fetch:2, x:4, twitter:4, sorare:5, dexscreener:5, gmail:3, email:3, whatsapp:3, message:3, finnhub:5, coingecko:5, ticker:5, sd:4}[model];
                    if (modelRegion !== undefined) regions.set(modelRegion, model);
                    else regions.set(0, model);
                }
            }
            if (regions.size === 0) regions.set(0, 'opus');
            return regions;
        }

        const SA_COLORS = ['#06b6d4','#f97316','#a855f7','#ec4899','#84cc16','#eab308','#ef4444','#14b8a6'];
        const SA_LOBSTER_PATH = 'M60 10C30 10 15 35 15 55C15 75 30 95 45 100L45 110 55 110 55 100C55 100 60 102 65 100L65 110 75 110 75 100C90 95 105 75 105 55C105 35 90 10 60 10Z M20 45C5 40 0 50 5 60C10 70 20 65 25 55C28 48 25 45 20 45Z M100 45C115 40 120 50 115 60C110 70 100 65 95 55C92 48 95 45 100 45Z';
        const SA_ANTENNA = '<path d="M45 15Q35 5 30 8" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><path d="M75 15Q85 5 90 8" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>';
        const SA_EYES = '<circle cx="45" cy="35" r="6" fill="#050810"/><circle cx="75" cy="35" r="6" fill="#050810"/><circle cx="46" cy="34" r="2.5" fill="#00e5cc"/><circle cx="76" cy="34" r="2.5" fill="#00e5cc"/>';

        function updateSubagentLobsters(subAgents) {
            const orbit = document.getElementById('sa-orbit-mobile');
            if (!orbit) return;
            const active = (subAgents||[]).filter(s => s.status === 'active' || s.status === 'running');
            const activeIds = new Set(active.map(s => s.id || s.label));
            // fade out removed
            orbit.querySelectorAll('.sa-lobster').forEach(el => {
                if (!activeIds.has(el.dataset.saId)) { el.classList.add('fade-out'); setTimeout(() => el.remove(), 1000); }
            });
            if (!active.length) return;
            const rect = orbit.getBoundingClientRect();
            const cx = rect.width / 2, cy = rect.height / 2;
            const radius = Math.min(cx, cy) * 0.55;
            active.forEach((s, i) => {
                const id = s.id || s.label || 'sa-'+i;
                const color = SA_COLORS[i % SA_COLORS.length];
                const angle = (2 * Math.PI * i / active.length) - Math.PI/2;
                const x = cx + radius * Math.cos(angle) - 9;
                const y = cy + radius * Math.sin(angle) - 9;
                let el = orbit.querySelector(`[data-sa-id="${id}"]`);
                if (!el) {
                    el = document.createElement('div');
                    el.className = 'sa-lobster';
                    el.dataset.saId = id;
                    const lbl = s.label || s.id || 'sub-agent';
                    el.innerHTML = `<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><path d="${SA_LOBSTER_PATH}" fill="${color}"/>${SA_ANTENNA.replace(/currentColor/g, color)}${SA_EYES}</svg><div class="sa-lobster-label" style="color:${color}">${lbl}</div>`;
                    orbit.appendChild(el);
                }
                const delay = (i * 0.5) % 3;
                el.style.cssText = `left:${x}px;top:${y}px;animation:saFloat 3s ${delay}s ease-in-out infinite;filter:drop-shadow(0 0 5px ${color});`;
                el.classList.remove('fade-out');
            });
        }

        function refreshMindMap(isActive, steps) {
            const card = document.getElementById('mindmap-card');
            card.classList.toggle('mindmap-active', isActive);
            card.classList.toggle('mindmap-idle', !isActive);

            // Update model legend ‚Äî highlight all active models
            const modelMap = {opus:'mm-dot-opus', whisper:'mm-dot-whisper', browser:'mm-dot-browser', ollama:'mm-dot-ollama', qwen:'mm-dot-qwen'};
            const colorMap = {opus:'#4ade80', claude:'#4ade80', sonnet:'#8b5cf6', whisper:'#facc15', browser:'#3b82f6', ollama:'#f97316', qwen:'#ec4899', x:'#4ade80', twitter:'#4ade80', sorare:'#4ade80', dexscreener:'#4ade80', gmail:'#4ade80', whatsapp:'#4ade80', finnhub:'#4ade80', coingecko:'#4ade80', sd:'#ec4899'};
            const classMap = {sonnet:'lit-sonnet', whisper:'lit-whisper', browser:'lit-browser', ollama:'lit-ollama', qwen:'lit-sd', x:'lit', twitter:'lit', sorare:'lit', dexscreener:'lit', gmail:'lit', whatsapp:'lit', finnhub:'lit', coingecko:'lit', sd:'lit-sd'};
            document.querySelectorAll('.mm-legend-dot').forEach(d => d.style.opacity = '0.35');
            if (isActive && window._mmModel) {
                const el = document.getElementById(modelMap[window._mmModel]);
                if (el) el.style.opacity = '1';
            }

            if (isActive) {
                const regions = getActiveRegions(steps);
                const indices = [...regions.keys()];

                // Also highlight legend dots for any model in active regions
                for (const model of regions.values()) {
                    const el = document.getElementById(modelMap[model]);
                    if (el) el.style.opacity = '1';
                }

                const nodes = card.querySelectorAll('.mindmap-node');
                const lines = card.querySelectorAll('.mindmap-line');
                const labels = card.querySelectorAll('.mindmap-label');

                nodes.forEach((n, i) => {
                    n.classList.remove('lit','lit-sonnet','lit-whisper','lit-ollama','lit-sd');
                    if (regions.has(i)) {
                        const model = regions.get(i);
                        n.classList.add(classMap[model] || 'lit');
                    }
                });
                // Hide inactive lines, keep active ones persistent
                lines.forEach((l, i) => {
                    if (!indices.includes(i)) {
                        l.classList.remove('lit');
                        l.style.strokeDashoffset = '';
                        l.style.stroke = '';
                        l.removeAttribute('data-active');
                    }
                });
                labels.forEach((l, i) => l.classList.toggle('lit', indices.includes(i)));

                // Animate lines shooting out + burst flow dots
                const lineEls = card.querySelectorAll('.mindmap-line');
                const flowContainer = document.getElementById('mm-flow-container');
                indices.forEach(i => {
                    const model = regions.get(i);
                    const color = colorMap[model] || '#4ade80';
                    if (!lineEls[i]) return;
                    const line = lineEls[i];
                    const alreadyActive = line.hasAttribute('data-active');

                    const x1=+line.getAttribute('x1'), y1=+line.getAttribute('y1');
                    const x2=+line.getAttribute('x2'), y2=+line.getAttribute('y2');

                    if (!alreadyActive) {
                        // First activation ‚Äî shoot out animation
                        const len = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
                        line.style.strokeDasharray = len + ' ' + len;
                        line.style.strokeDashoffset = len;
                        line.classList.add('lit');
                        line.style.stroke = color;
                        line.setAttribute('data-active', '1');
                        let shootStart = null;
                        const shootDuration = 400;
                        (function animShoot(ts) {
                            if (!shootStart) shootStart = ts;
                            const t = Math.min((ts - shootStart) / shootDuration, 1);
                            const eased = t < 0.5 ? 2*t*t : -1+(4-2*t)*t;
                            line.style.strokeDashoffset = len * (1 - eased);
                            if (t < 1) requestAnimationFrame(animShoot);
                            else line.style.strokeDashoffset = '0';
                        })(performance.now());
                    } else {
                        // Already active ‚Äî just update color, keep line visible
                        line.style.stroke = color;
                    }
                    // Flow dots start after line finishes drawing (400ms delay)
                    const burstCount = 2 + Math.floor(Math.random()*3);
                    for (let b = 0; b < burstCount; b++) {
                        const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
                        const r = 0.8;
                        dot.setAttribute('r', r);
                        dot.setAttribute('cx', x1);
                        dot.setAttribute('cy', y1);
                        dot.style.fill = color;
                        dot.style.opacity = '0';
                        dot.style.filter = `drop-shadow(0 0 ${r}px ${color})`;
                        flowContainer.appendChild(dot);
                        const duration = 800 + Math.random()*1000;
                        const delay = 400 + b * (80 + Math.random()*120); // 400ms wait for line shoot + staggered burst
                        const wobbleX = (Math.random()-0.5)*6; // random lateral spread
                        const wobbleY = (Math.random()-0.5)*6;
                        let start = null;
                        (function animBurst(ts) {
                            if (!start) start = ts;
                            const elapsed = ts - start - delay;
                            if (elapsed < 0) { requestAnimationFrame(animBurst); return; }
                            const t = Math.min(elapsed / duration, 1);
                            const eased = t < 0.5 ? 2*t*t : -1+(4-2*t)*t;
                            const wx = wobbleX * Math.sin(t * Math.PI);
                            const wy = wobbleY * Math.sin(t * Math.PI);
                            dot.setAttribute('cx', x1 + (x2-x1)*eased + wx);
                            dot.setAttribute('cy', y1 + (y2-y1)*eased + wy);
                            dot.style.opacity = t < 0.1 ? t*10 : t > 0.75 ? (1-t)*4 : 0.85;
                            if (t < 1) requestAnimationFrame(animBurst);
                            else flowContainer.removeChild(dot);
                        })(performance.now());
                    }
                });
            }
        }

        // Connected Accounts - collapsible (persisted)
        const connToggle = document.getElementById('conn-toggle');
        const connBody = document.getElementById('conn-body');
        const connArrow = document.getElementById('conn-arrow');
        let connOpen = localStorage.getItem('mobile-conn-open') === 'true';
        if (connOpen) { connBody.style.display = ''; connArrow.style.transform = 'rotate(90deg)'; }
        connToggle.addEventListener('click', () => {
            connOpen = !connOpen;
            localStorage.setItem('mobile-conn-open', connOpen);
            connBody.style.display = connOpen ? '' : 'none';
            connArrow.style.transform = connOpen ? 'rotate(90deg)' : '';
            if (connOpen && !connBody.dataset.loaded) refreshConnections();
        });
        if (connOpen) refreshConnections();

        async function refreshConnections() {
            try {
                const data = await fetchJSON('/api/connections');
                if (!data) return;
                const render = (items, id) => {
                    const el = document.getElementById(id);
                    el.innerHTML = items.map(i => `
                        <div style="display:flex;align-items:center;gap:0.25rem;padding:0.1rem 0;font-size:0.6rem;color:rgba(255,255,255,0.7);">
                            <img src="${i.icon}" alt="" style="width:12px;height:12px;border-radius:2px;${i.invert?'filter:invert(1);':''}" onerror="this.style.display='none'">
                            <span>${esc(i.name)}</span>
                            ${i.active ? '<span style="color:var(--accent);font-size:0.4rem;">‚óè</span>' : ''}
                        </div>
                    `).join('');
                };
                const sortA = arr => [...arr].sort((a,b) => a.name.localeCompare(b.name));
                render(sortA(data.accounts || []), 'conn-accounts');
                render(sortA(data.dataSources || []), 'conn-datasources');
                if (data.newsletters && data.newsletters.length) {
                    document.getElementById('conn-newsletters-section').style.display = '';
                    const nlEl = document.getElementById('conn-newsletters');
                    nlEl.innerHTML = sortA(data.newsletters).map(i => `
                        <div style="display:flex;align-items:center;gap:0.25rem;padding:0.1rem 0;font-size:0.6rem;color:rgba(255,255,255,0.7);">
                            <span style="font-size:0.5rem;">üìß</span>
                            <span>${esc(i.name)}</span>
                            ${i.active ? '<span style="color:var(--accent);font-size:0.4rem;">‚óè</span>' : ''}
                        </div>
                    `).join('');
                }
                if (data.podcasts && data.podcasts.length) {
                    document.getElementById('conn-podcasts-section').style.display = '';
                    document.getElementById('conn-podcasts').innerHTML = sortA(data.podcasts).map(i => `
                        <div style="display:flex;align-items:center;gap:0.25rem;padding:0.1rem 0;font-size:0.6rem;color:rgba(255,255,255,0.7);">
                            <span style="font-size:0.5rem;">üéôÔ∏è</span>
                            <span>${esc(i.name)}</span>
                            ${i.active ? '<span style="color:var(--accent);font-size:0.4rem;">‚óè</span>' : ''}
                        </div>
                    `).join('');
                }
                connBody.dataset.loaded = '1';
            } catch(e) { console.error('connections', e); }
        }

        let statusExpanded = false;
        function toggleStatusExpand() {
            statusExpanded = !statusExpanded;
            document.getElementById('status-expanded').style.display = statusExpanded ? '' : 'none';
        }

        let sorareOpen = localStorage.getItem('mobile-sorare-open') === 'true';
        if (sorareOpen) { document.getElementById('sorare-body').style.display = ''; document.getElementById('sorare-chevron').style.transform = 'rotate(180deg)'; }
        function toggleSorare() {
            sorareOpen = !sorareOpen;
            localStorage.setItem('mobile-sorare-open', sorareOpen);
            document.getElementById('sorare-body').style.display = sorareOpen ? '' : 'none';
            document.getElementById('sorare-chevron').style.transform = sorareOpen ? 'rotate(180deg)' : '';
        }

        async function refreshSorare() {
            const [data, tasksData, craftData] = await Promise.all([
                fetchJSON('/sorare-mobile.json'),
                fetchJSON('/sorare-daily-tasks.json'),
                fetchJSON('/sorare-crafting-status.json')
            ]);

            // Daily tasks
            const tasksEl = document.getElementById('sorare-daily-tasks');
            if (tasksData && tasksData.tasks && tasksData.tasks.length > 0) {
                let tHtml = '<div class="sorare-section-label">üìã Daily Tasks</div>';
                tHtml += '<div class="sorare-lineup" style="padding:0.3rem 0.5rem;">';
                tasksData.tasks.forEach(t => {
                    const doneClass = t.done ? ' done' : '';
                    const checkIcon = t.done ? '‚úì' : '';
                    const timeStr = t.doneAt ? new Date(t.doneAt).toLocaleTimeString([], {hour:'numeric',minute:'2-digit'}) : '';
                    tHtml += '<div class="sorare-task">';
                    tHtml += '<div class="sorare-task-check' + doneClass + '">' + checkIcon + '</div>';
                    tHtml += '<span class="sorare-task-name' + doneClass + '">' + t.name + '</span>';
                    if (timeStr) tHtml += '<span class="sorare-task-time">' + timeStr + '</span>';
                    tHtml += '</div>';
                });
                tHtml += '</div>';
                tasksEl.innerHTML = tHtml;
            } else {
                tasksEl.innerHTML = '';
            }

            // Crafting progress bar
            const craftEl = document.getElementById('sorare-crafting');
            if (craftData && craftData.essenceBalance != null) {
                const bal = craftData.essenceBalance;
                const cost = craftData.craftingCost || 1000;
                const essPct = Math.min(100, Math.round((bal / cost) * 100));
                const essNeeded = Math.max(0, cost - bal);
                const essColor = essPct >= 100 ? '#4ade80' : '#a78bfa';
                // Requirements readiness ‚Äî crafting only needs Essence (no collection req)
                const reqs = craftData.requirements || {};
                const essReqMet = reqs.essence ? reqs.essence.met : essPct >= 100;
                const noCollectionReq = !reqs.collectionCompletion || !reqs.collectionCompletion.required;
                const noLevelReq = !reqs.levelRequirement || !reqs.levelRequirement.required;
                const readyPct = (essReqMet ? 50 : 0) + (noCollectionReq ? 25 : 0) + (noLevelReq ? 25 : 0);
                const readyColor = readyPct >= 100 ? '#4ade80' : '#a78bfa';
                let cHtml = '<div class="sorare-section-label">üîÆ Crafting Progress</div>';
                cHtml += '<div class="sorare-lineup" style="padding:0.4rem 0.5rem;">';
                // Bar 1: Essence
                cHtml += '<div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:0.2rem;">';
                cHtml += '<span style="font-size:0.55rem;color:rgba(255,255,255,0.7);">Essence</span>';
                cHtml += '<span style="font-size:0.55rem;font-weight:600;color:' + essColor + ';">' + bal.toLocaleString() + ' / ' + cost.toLocaleString() + '</span>';
                cHtml += '</div>';
                cHtml += '<div style="width:100%;height:6px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;margin-bottom:0.15rem;">';
                cHtml += '<div style="width:' + essPct + '%;height:100%;background:' + essColor + ';border-radius:3px;transition:width 0.5s;"></div>';
                cHtml += '</div>';
                cHtml += '<div style="display:flex;justify-content:space-between;margin-bottom:0.35rem;">';
                cHtml += '<span style="font-size:0.45rem;color:rgba(255,255,255,0.4);">' + essPct + '%</span>';
                if (essNeeded > 0) {
                    cHtml += '<span style="font-size:0.45rem;color:rgba(255,255,255,0.4);">' + essNeeded + ' more needed</span>';
                } else {
                    cHtml += '<span style="font-size:0.45rem;color:#4ade80;font-weight:600;">‚úì Enough</span>';
                }
                cHtml += '</div>';
                // Bar 2: Requirements readiness
                cHtml += '<div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:0.2rem;">';
                cHtml += '<span style="font-size:0.55rem;color:rgba(255,255,255,0.7);">Requirements</span>';
                cHtml += '<span style="font-size:0.55rem;font-weight:600;color:' + readyColor + ';">' + readyPct + '%</span>';
                cHtml += '</div>';
                cHtml += '<div style="width:100%;height:6px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;margin-bottom:0.15rem;">';
                cHtml += '<div style="width:' + readyPct + '%;height:100%;background:' + readyColor + ';border-radius:3px;transition:width 0.5s;"></div>';
                cHtml += '</div>';
                cHtml += '<div style="font-size:0.45rem;color:rgba(255,255,255,0.4);display:flex;flex-wrap:wrap;gap:0.2rem 0.5rem;">';
                cHtml += '<span>' + (essReqMet ? '‚úÖ' : '‚¨ú') + ' Essence</span>';
                cHtml += '<span>‚úÖ No collection req</span>';
                cHtml += '<span>‚úÖ No level req</span>';
                cHtml += '</div>';
                // Overall status
                if (essPct >= 100) {
                    cHtml += '<div style="margin-top:0.3rem;text-align:center;font-size:0.55rem;color:#4ade80;font-weight:600;">‚ú® Ready to craft a Limited card!</div>';
                }
                cHtml += '</div>';
                craftEl.innerHTML = cHtml;
            } else {
                craftEl.innerHTML = '';
            }

            if (!data || !data.activeFixture) return;
            const fix = data.activeFixture;
            const now = Date.now();
            const start = new Date(fix.startDate).getTime();
            const end = new Date(fix.endDate).getTime();
            const isLive = now >= start && now <= end;
            const isPast = now > end;

            const upGW = data.upcomingFixture ? data.upcomingFixture.gameWeek : null;
            document.getElementById('sorare-gw-badge').textContent = 'GW' + fix.gameWeek + (upGW ? ' / GW' + upGW : '');
            const statusBadge = document.getElementById('sorare-status-badge');
            if (isLive) {
                statusBadge.textContent = '‚óè LIVE';
                statusBadge.style.background = 'rgba(74,222,128,0.15)';
                statusBadge.style.color = '#4ade80';
            } else if (isPast) {
                statusBadge.textContent = 'FINAL';
                statusBadge.style.background = 'rgba(255,255,255,0.08)';
                statusBadge.style.color = 'rgba(255,255,255,0.5)';
            } else {
                const d = new Date(fix.startDate);
                statusBadge.textContent = 'Starts ' + (d.getMonth()+1) + '/' + d.getDate();
                statusBadge.style.background = 'rgba(250,204,21,0.15)';
                statusBadge.style.color = '#facc15';
            }

            const activeEl = document.getElementById('sorare-active');
            let html = '';
            if (fix.lineups.length === 0) {
                html = '<div style="font-size:0.55rem;color:rgba(255,255,255,0.4);text-align:center;padding:0.5rem;">No lineups set for this matchup</div>';
            } else {
                html += '<div class="sorare-section-label">' + (isLive ? 'üü¢ GW' + fix.gameWeek + ' Active' : isPast ? '‚úÖ GW' + fix.gameWeek + ' Completed' : 'üìã GW' + fix.gameWeek + ' Set') + ' ‚Äî ' + fix.lineups[0].leaderboard + '</div>';
                let teamCounter = 0;
                fix.lineups.forEach((lb, lbIdx) => {
                    lb.entries.forEach((entry, idx) => {
                        teamCounter++;
                        html += '<div class="sorare-lineup">';
                        html += '<div class="sorare-lineup-header">';
                        html += '<div><span class="sorare-lineup-name">' + (lb.leaderboard.replace('Limited ', '').replace('Champion', 'Champ')) + ' Team ' + teamCounter + '</span></div>';
                        html += '<div style="display:flex;align-items:baseline;gap:0.4rem;">';
                        html += '<span class="sorare-score">' + (entry.score || 0).toFixed(1) + ' pts</span>';
                        html += '<span class="sorare-rank">#' + (entry.ranking || '--') + '</span>';
                        html += '</div></div>';
                        entry.players.forEach(p => {
                            const shortTeam = p.team ? p.team.split(' ').pop() : '';
                            const scoreClass = (p.score === 0 || p.score === null) ? 'sorare-player-score zero' : 'sorare-player-score';
                            const scoreText = p.score != null ? p.score.toFixed(1) : '--';
                            html += '<div class="sorare-player-row">';
                            html += '<span class="sorare-player-name">' + p.name + '</span>';
                            html += '<span class="sorare-player-team">' + shortTeam + '</span>';
                            html += '<span class="' + scoreClass + '">' + scoreText + '</span>';
                            html += '</div>';
                        });
                        html += '</div>';
                    });
                });
            }
            activeEl.innerHTML = html;

            // Upcoming fixture section ‚Äî show API lineups or planned lineups from tasks JSON
            const upEl = document.getElementById('sorare-upcoming');
            if (data.upcomingFixture && data.upcomingFixture.lineups && data.upcomingFixture.lineups.length > 0) {
                const upStart = new Date(data.upcomingFixture.startDate);
                const upDateStr = (upStart.getMonth()+1) + '/' + upStart.getDate();
                let upHtml = '<div class="sorare-section-label" style="margin-top:0.3rem;">üìÖ GW' + data.upcomingFixture.gameWeek + ' Upcoming (Feb ' + upStart.getDate() + '-' + new Date(data.upcomingFixture.endDate).getDate() + ')</div>';
                data.upcomingFixture.lineups.forEach(lb => {
                    lb.entries.forEach((entry, idx) => {
                        upHtml += '<div class="sorare-lineup" style="opacity:0.7;">';
                        upHtml += '<div class="sorare-lineup-header">';
                        upHtml += '<span class="sorare-lineup-name">' + lb.leaderboard + ' Team ' + (idx+1) + '</span>';
                        upHtml += '</div>';
                        entry.players.forEach(p => {
                            upHtml += '<div class="sorare-player-row">';
                            upHtml += '<span class="sorare-player-name">' + p.name + '</span>';
                            upHtml += '<span class="sorare-player-team">' + (p.team ? p.team.split(' ').pop() : '') + '</span>';
                            upHtml += '<span class="sorare-player-score zero">--</span>';
                            upHtml += '</div>';
                        });
                        upHtml += '</div>';
                    });
                });
                upEl.innerHTML = upHtml;
            } else if (tasksData && tasksData.upcomingLineups && tasksData.upcomingLineups.teams && tasksData.upcomingLineups.teams.length > 0) {
                // Show planned lineups from tasks data
                const ul = tasksData.upcomingLineups;
                const upStart = new Date(ul.startDate);
                const upEnd = new Date(ul.endDate);
                let upHtml = '<div class="sorare-section-label" style="margin-top:0.3rem;">üìÖ GW' + (data.upcomingFixture ? data.upcomingFixture.gameWeek : ul.gameWeek) + ' Planned (Feb ' + upStart.getDate() + '-' + upEnd.getDate() + ')</div>';
                ul.teams.forEach((team, idx) => {
                    upHtml += '<div class="sorare-lineup" style="opacity:0.7;">';
                    upHtml += '<div class="sorare-lineup-header">';
                    upHtml += '<span class="sorare-lineup-name">' + team.name + '</span>';
                    upHtml += '</div>';
                    team.players.forEach(p => {
                        upHtml += '<div class="sorare-player-row">';
                        upHtml += '<span class="sorare-player-name">' + p.name + '</span>';
                        upHtml += '<span class="sorare-player-team" style="font-size:0.45rem;">' + (p.position || '') + '</span>';
                        upHtml += '<span class="sorare-player-score zero">' + (p.avgScore ? '~' + p.avgScore : '--') + '</span>';
                        upHtml += '</div>';
                    });
                    if (team.strategy) upHtml += '<div style="font-size:0.4rem;color:rgba(255,255,255,0.3);margin-top:0.2rem;font-style:italic;">' + team.strategy + '</div>';
                    upHtml += '</div>';
                });
                upEl.innerHTML = upHtml;
            } else {
                upEl.innerHTML = '';
            }
        }

        // Wallet card toggle
        let walletExpanded = true;
        function toggleWalletCard() {
            walletExpanded = !walletExpanded;
            document.getElementById('wallet-expanded').style.display = walletExpanded ? '' : 'none';
            document.getElementById('wallet-chevron').style.transform = walletExpanded ? 'rotate(180deg)' : '';
        }

        async function refreshWallet(btn) {
            const doRefresh = async () => {
                try {
                    const [data, tradesData] = await Promise.all([
                        fetchJSON('/coinbase-wallet.json'),
                        fetchJSON('/trades.json').catch(() => null)
                    ]);
                    if (!data) return;
                    let totalUsd = (data.evm?.totalUsd || 0) + (data.solana?.totalUsd || 0);
                    if (tradesData?.openPositions) {
                        tradesData.openPositions.forEach(p => {
                            const val = (p.currentPrice || p.entryPrice || 0) * (p.amount || 0);
                            if (val > 0) totalUsd += val;
                        });
                    }
                    if (tradesData?.budget?.realizedPnl) totalUsd += tradesData.budget.realizedPnl;
                    document.getElementById('wallet-total').textContent = '$' + totalUsd.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                    const chainsEl = document.getElementById('wallet-chains');
                    const truncA = a => a ? a.slice(0, 6) + '‚Ä¶' + a.slice(-4) : '';
                    function chainHtml(chain, label, symbol) {
                        if (!chain) return '';
                        const usd = '$' + Number(chain.totalUsd || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        const mainBal = (chain.balances || []).find(b => (b.symbol || '').toLowerCase() === symbol.toLowerCase());
                        const amt = mainBal ? Number(mainBal.amount || 0).toLocaleString(undefined, { maximumFractionDigits: 4 }) + ' ' + symbol.toUpperCase() : '';
                        return '<div style="flex:1;background:rgba(255,255,255,0.04);border-radius:8px;padding:0.35rem 0.5rem;">' +
                            '<div style="display:flex;justify-content:space-between;align-items:center;">' +
                            '<span style="font-size:0.6rem;font-weight:600;color:rgba(255,255,255,0.7);">' + esc(label) + '</span>' +
                            '<span style="font-size:0.65rem;font-weight:700;color:var(--accent);">' + usd + '</span></div>' +
                            '<div style="font-size:0.5rem;color:var(--text-dim);margin-top:0.15rem;">' + esc(amt) + '</div>' +
                            '<div style="display:flex;align-items:center;gap:0.2rem;margin-top:0.15rem;">' +
                            '<span style="font-size:0.45rem;color:rgba(255,255,255,0.3);">' + truncA(chain.address) + '</span>' +
                            '<button onclick="event.stopPropagation();navigator.clipboard.writeText(\'' + (chain.address || '') + '\');this.textContent=\'‚úì\';setTimeout(()=>this.textContent=\'üìã\',1000)" style="background:none;border:none;font-size:0.5rem;cursor:pointer;padding:0;">üìã</button>' +
                            '</div></div>';
                    }
                    chainsEl.innerHTML = chainHtml(data.solana, 'Solana', 'SOL') + chainHtml(data.evm, 'Base', 'ETH');

                    const tradesEl = document.getElementById('wallet-trades');
                    const positions = tradesData?.openPositions || [];
                    const fmtMcap = v => v >= 1e6 ? '$' + (v / 1e6).toFixed(1) + 'M' : v >= 1e3 ? '$' + (v / 1e3).toFixed(0) + 'K' : '$' + v;
                    if (positions.length) {
                        tradesEl.innerHTML = '<div style="font-size:0.5rem;font-weight:700;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.2rem;">Active Trades</div>' +
                            positions.map(p => {
                                const pnl = p.currentPrice && p.entryPrice ? ((p.currentPrice - p.entryPrice) / p.entryPrice * 100) : (p.pnlPct || 0);
                                const pnlColor = pnl >= 0 ? '#4ade80' : '#ef4444';
                                const entryMcap = p.mcapAtEntry || 0;
                                const curMcap = p.currentMcap || entryMcap;
                                const entrySol = p.solSpent ? p.solSpent.toFixed(2) : '0';
                                const currentSol = p.solSpent ? (p.solSpent * (1 + pnl / 100)).toFixed(2) : '0';
                                return '<div style="display:flex;align-items:center;justify-content:space-between;padding:0.2rem 0;border-bottom:1px solid rgba(255,255,255,0.04);">' +
                                    '<span style="font-size:0.6rem;font-weight:700;color:var(--text);min-width:50px;">' + esc(p.token || p.symbol) + '</span>' +
                                    '<span style="font-size:0.5rem;color:var(--text-dim);">' + fmtMcap(entryMcap) + ' ‚Üí ' + fmtMcap(curMcap) + '</span>' +
                                    '<span style="font-size:0.5rem;color:var(--text-dim);">' + entrySol + ' ‚Üí <span style="color:' + pnlColor + ';font-weight:600;">' + currentSol + '</span> SOL</span>' +
                                    '<span style="font-size:0.6rem;font-weight:700;color:' + pnlColor + ';min-width:40px;text-align:right;">' + (pnl >= 0 ? '+' : '') + pnl.toFixed(1) + '%</span></div>';
                            }).join('');
                    } else {
                        tradesEl.innerHTML = '<div style="font-size:0.55rem;color:var(--text-dim);margin-top:0.2rem;">No open positions</div>';
                    }

                    if (tradesData?.budget) {
                        const b = tradesData.budget;
                        const pc = (b.realizedPnl || 0) >= 0 ? '#4ade80' : '#ef4444';
                        document.getElementById('wallet-budget').innerHTML =
                            '<span style="font-size:0.5rem;padding:0.1rem 0.3rem;border-radius:4px;background:rgba(74,222,128,0.15);color:#4ade80;font-weight:600;">Avail: ' + (b.availableSol || b.available || 0).toFixed(2) + ' SOL</span>' +
                            '<span style="font-size:0.5rem;padding:0.1rem 0.3rem;border-radius:4px;background:rgba(255,255,255,0.06);color:var(--text);">Deployed: ' + (b.deployedSol || b.deployed || 0).toFixed(2) + ' SOL</span>' +
                            '<span style="font-size:0.5rem;padding:0.1rem 0.3rem;border-radius:4px;background:rgba(255,255,255,0.06);color:' + pc + ';">P&L: ' + ((b.realizedPnl || 0) >= 0 ? '+' : '') + (b.realizedPnl || 0).toFixed(3) + ' SOL</span>';
                    }
                    const closed = tradesData?.closedPositions || tradesData?.closedTrades || [];
                    if (closed.length) {
                        document.getElementById('wallet-closed').innerHTML = '<div style="font-size:0.5rem;font-weight:700;color:var(--text-dim);text-transform:uppercase;margin-bottom:0.2rem;">Closed</div>' +
                            closed.slice(-3).reverse().map(t => {
                                const pnl = t.pnlPct || 0;
                                const c = pnl >= 0 ? '#4ade80' : '#ef4444';
                                return '<div style="display:flex;justify-content:space-between;padding:0.1rem 0;"><span style="font-size:0.55rem;">' + esc(t.token || t.symbol) + '</span><span style="font-size:0.55rem;color:' + c + ';font-weight:700;">' + (pnl >= 0 ? '+' : '') + pnl.toFixed(1) + '%</span></div>';
                            }).join('');
                    }
                } catch (e) { console.error('Wallet:', e); }
            };
            if (btn) return spinButton(btn, doRefresh());
            return doRefresh();
        }

        refreshStatus();
        refreshMind();
        refreshTicker();
        refreshXStats();
        refreshTweetFeed();
        refreshWallet();
        refreshSorare();
        // Smart intervals ‚Äî pause when tab hidden
        const _intervals = [];
        // smartInterval ‚Üí now in dashboard-common.js
        smartInterval(refreshStatus, 30000);
        smartInterval(refreshMind, 5000);
        smartInterval(refreshTicker, 60000);
        smartInterval(refreshXStats, 60000);
        smartInterval(refreshTweetFeed, 120000);
        smartInterval(refreshWallet, 60000);
        smartInterval(refreshSorare, 300000);
        // Refresh stale data when tab becomes visible again
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) { refreshStatus(); refreshMind(); }
        });

        // WebSocket for real-time push updates
        (function initWebSocket() {
            const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
            let ws, retryDelay = 1000;
            // Debounce WS-triggered refreshes
            const wsPending = {};
            function wsRefresh(key, fn) {
                if (wsPending[key]) return;
                wsPending[key] = true;
                requestAnimationFrame(() => { wsPending[key] = false; fn(); });
            }
            function connect() {
                ws = new WebSocket(proto + '//' + location.host);
                ws.onopen = () => { retryDelay = 1000; };
                ws.onmessage = (e) => {
                    try {
                        const msg = JSON.parse(e.data);
                        function handleWidgetUpdate(k) {
                            if (k === 'coinbase-wallet' || k === 'trades') wsRefresh('wallet', refreshWallet);
                            else if (k === 'x-stats') wsRefresh(k, refreshXStats);
                            else if (k === 'x-tweets' || k === 'x-thread-history') wsRefresh('tweets', refreshTweetFeed);
                            else if (k === 'mind') wsRefresh(k, refreshMind);
                            else if (k === 'sessions') wsRefresh(k, refreshStatus);
                            else if (k === 'sorare-mobile' || k === 'sorare') wsRefresh('sorare', refreshSorare);
                            else if (k === 'cron-schedule') fetchCronSchedule();
                        }
                        if (msg.type === 'update' || msg.type === 'fileChange') {
                            handleWidgetUpdate(msg.widget || msg.key);
                        } else if (msg.type === 'batch' && msg.updates) {
                            msg.updates.forEach(u => handleWidgetUpdate(u.widget));
                        }
                    } catch(err) {}
                };
                ws.onclose = () => { setTimeout(connect, retryDelay); retryDelay = Math.min(retryDelay * 1.5, 30000); };
                ws.onerror = () => ws.close();
            }
            connect();
        })();

        // Push Notifications
        (async function initPushNotifications() {
            const btn = document.getElementById('push-btn');
            if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
                // Fallback: try HTTPS port for full push support
                if (location.protocol === 'http:' && location.port === '3000') {
                    if (btn) { 
                        btn.textContent = 'üîî'; 
                        btn.style.color = 'rgba(255,255,255,0.6)';
                        btn.onclick = () => {
                            // Redirect to HTTPS version for push support
                            window.location.href = location.href.replace(':3000', ':3443').replace('http:', 'https:');
                        };
                    }
                    return;
                }
                const standalone = window.matchMedia('(display-mode: standalone)').matches || navigator.standalone;
                const info = `SW: ${'serviceWorker' in navigator}\nPush: ${'PushManager' in window}\nNotification: ${'Notification' in window}\nStandalone: ${standalone}\nUA: ${navigator.userAgent}`;
                if (btn) { btn.textContent = 'üîï'; btn.style.color = 'rgba(255,255,255,0.3)'; btn.onclick = () => alert(info); }
                return;
            }
            try {
                const reg = await navigator.serviceWorker.register('/sw.js');
                console.log('SW registered');
                
                // Check if already subscribed
                const existing = await reg.pushManager.getSubscription();
                const btn = document.getElementById('push-btn');
                if (existing) {
                    if (btn) { btn.textContent = 'üîî'; btn.style.color = 'rgba(74,222,128,0.5)'; btn.onclick = null; }
                    return;
                }
                
                // Show enable button AND auto-prompt on first PWA launch
                async function subscribePush() {
                    try {
                        const resp = await fetch('/api/push/vapid-key');
                        const { publicKey } = await resp.json();
                        const sub = await reg.pushManager.subscribe({
                            userVisibleOnly: true,
                            applicationServerKey: urlBase64ToUint8Array(publicKey)
                        });
                        await fetch('/api/push/subscribe', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(sub.toJSON())
                        });
                        if (btn) { btn.textContent = 'üîî'; btn.style.color = 'rgba(74,222,128,0.5)'; btn.onclick = null; btn.style.display = 'inline-flex'; }
                    } catch (e) {
                        console.error('Push subscription failed:', e);
                        if (btn) { btn.textContent = 'üîî'; btn.style.display = 'inline-flex'; btn.onclick = subscribePush; }
                    }
                }
                // Auto-prompt if in standalone PWA mode
                if (window.matchMedia('(display-mode: standalone)').matches || navigator.standalone) {
                    subscribePush();
                } else if (btn) {
                    btn.style.display = 'inline-flex';
                    btn.onclick = subscribePush;
                }
            } catch (e) { console.error('SW registration failed:', e); }
        })();

        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            for (let i = 0; i < rawData.length; ++i) outputArray[i] = rawData.charCodeAt(i);
            return outputArray;
        }

        // Sub-agent activity detection for neural sphere effect
        window._subagentsActive = false;
        async function refreshSubagentState() {
            try {
                const data = await fetchJSON('/api/sessions').then(r => r, () => fetchJSON('/sessions.json')).catch(() => null);
                if (!data || !data.sessions) { window._subagentsActive = false; return; }
                const now = Date.now();
                const activeSubs = data.sessions.filter(s =>
                    s.kind === 'subagent' &&
                    s.updatedAt && (now - s.updatedAt) < 120000 // active within 2min
                );
                const wasActive = window._subagentsActive;
                window._subagentsActive = activeSubs.length > 0;
                const card = document.getElementById('mindmap-card');
                if (card) card.classList.toggle('subagents-active', window._subagentsActive);
            } catch(e) { /* silent */ }
        }
        refreshSubagentState();
        smartInterval(refreshSubagentState, 8000);

        // Angular Neural Network
        (function initNeuralSphere() {
            const canvas = document.getElementById('neural-sphere');
            if (!canvas) return;
            const ctx = canvas.getContext('2d', { alpha: true });
            const W = canvas.width, H = canvas.height;
            const mmCard = document.getElementById('mindmap-card');

            const G = [74,222,128]; // brand green
            const P = [139,92,246]; // sub-agent purple
            // Pre-compute color strings
            const gStr = `${G[0]},${G[1]},${G[2]}`;
            const pStr = `${P[0]},${P[1]},${P[2]}`;

            // Pause when tab hidden
            let animRunning = true;
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) { animRunning = false; }
                else { animRunning = true; requestAnimationFrame(render); }
            });

            // Data particles ‚Äî floating upward like data streams
            const particles = [];
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * W,
                    y: Math.random() * H,
                    r: Math.random() * 0.8 + 0.2,
                    baseAlpha: Math.random() * 0.5 + 0.1,
                    speed: Math.random() * 0.15 + 0.05,
                    drift: (Math.random() - 0.5) * 0.1,
                    twinkleSpeed: Math.random() * 0.02 + 0.008,
                    twinkleOffset: Math.random() * Math.PI * 2,
                    bright: Math.random() > 0.85 // ~15% are brighter accent particles
                });
            }

            // Streaks ‚Äî fast horizontal data lines
            const streaks = [];
            function spawnStreak(isActive) {
                if (Math.random() > (isActive ? 0.03 : 0.008)) return;
                streaks.push({
                    x: -20,
                    y: Math.random() * H,
                    speed: Math.random() * 3 + 1.5,
                    len: Math.random() * 40 + 20,
                    life: 1.0,
                    alpha: Math.random() * 0.3 + 0.15
                });
            }

            // Scan line
            let scanY = 0;

            let t = 0;

            function render() {
                if (!animRunning) return;
                const isActive = mmCard.classList.contains('mindmap-active');
                const hasSubs = window._subagentsActive;
                // Blend color toward purple when sub-agents active
                const cStr = hasSubs ? pStr : gStr;
                t += 0.016;

                ctx.clearRect(0, 0, W, H);

                // Subtle radial vignette glow from center
                const vigAlpha = hasSubs ? 0.09 : isActive ? 0.07 : 0.03;
                const vig = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, W * 0.6);
                vig.addColorStop(0, `rgba(${cStr},${vigAlpha})`);
                vig.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = vig;
                ctx.fillRect(0, 0, W, H);

                // Faint grid lines
                const gridAlpha = hasSubs ? 0.05 : isActive ? 0.04 : 0.018;
                ctx.strokeStyle = `rgba(${cStr},${gridAlpha})`;
                ctx.lineWidth = 0.5;
                for (let x = 0; x < W; x += 28) {
                    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
                }
                for (let y = 0; y < H; y += 28) {
                    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
                }

                // Particles ‚Äî floating data motes
                const pBrightness = hasSubs ? 1.8 : isActive ? 1.6 : 1.0;
                const speedMult = hasSubs ? 3.0 : isActive ? 2.5 : 1;
                particles.forEach(p => {
                    p.y -= p.speed * speedMult;
                    p.x += p.drift;
                    if (p.y < -5) { p.y = H + 5; p.x = Math.random() * W; }
                    if (p.x < 0) p.x = W; if (p.x > W) p.x = 0;

                    const twinkle = 0.3 + Math.sin(t * p.twinkleSpeed * 60 + p.twinkleOffset) * 0.7;
                    const alpha = Math.min(1, p.baseAlpha * twinkle * pBrightness);

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${hasSubs && p.bright ? pStr : gStr},${alpha})`;
                    ctx.fill();

                    // Glow halo on bright particles
                    if (p.bright && alpha > 0.3) {
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.r * 3, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(${hasSubs ? pStr : gStr},${alpha * 0.12})`;
                        ctx.fill();
                    }
                });

                // Data streaks
                spawnStreak(isActive);
                for (let i = streaks.length - 1; i >= 0; i--) {
                    const s = streaks[i];
                    s.x += s.speed * (isActive ? 2 : 1);
                    s.life -= 0.008;
                    if (s.life <= 0 || s.x > W + 40) { streaks.splice(i, 1); continue; }
                    const grad = ctx.createLinearGradient(s.x, s.y, s.x - s.len, s.y);
                    grad.addColorStop(0, `rgba(${cStr},${s.alpha * s.life})`);
                    grad.addColorStop(1, `rgba(${cStr},0)`);
                    ctx.strokeStyle = grad;
                    ctx.lineWidth = 0.8;
                    ctx.beginPath();
                    ctx.moveTo(s.x, s.y);
                    ctx.lineTo(s.x - s.len, s.y);
                    ctx.stroke();
                }

                // Scan line ‚Äî slow sweep
                scanY += hasSubs ? 0.55 : isActive ? 0.4 : 0.15;
                if (scanY > H) scanY = 0;
                const scanAlpha = hasSubs ? 0.08 : isActive ? 0.06 : 0.025;
                const scanGrad = ctx.createLinearGradient(0, scanY - 8, 0, scanY + 8);
                scanGrad.addColorStop(0, 'rgba(0,0,0,0)');
                scanGrad.addColorStop(0.5, `rgba(${cStr},${scanAlpha})`);
                scanGrad.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = scanGrad;
                ctx.fillRect(0, scanY - 8, W, 16);

                requestAnimationFrame(render);
            }
            requestAnimationFrame(render);
        })();

        // Pull to refresh ‚Äî spinning Jane icon
        let ptrStart = 0, ptrActive = false, ptrRefreshing = false;
        const ptrSpacer = document.getElementById('ptr-spacer');
        const ptrIcon = document.getElementById('ptr');

        document.addEventListener('touchstart', e => {
            if (window.scrollY === 0 && !ptrRefreshing) {
                ptrStart = e.touches[0].clientY;
                ptrActive = true;
            }
        }, { passive: true });

        document.addEventListener('touchmove', e => {
            if (!ptrActive) return;
            const dy = e.touches[0].clientY - ptrStart;
            if (dy > 10 && dy < 120) {
                const h = Math.min(dy - 10, 60);
                ptrSpacer.style.transition = 'none';
                ptrSpacer.style.height = h + 'px';
                const progress = h / 60;
                ptrIcon.style.opacity = progress;
                ptrIcon.style.transform = 'scale(' + (0.5 + progress * 0.5) + ') rotate(' + (progress * 360) + 'deg)';
            }
        }, { passive: true });

        document.addEventListener('touchend', () => {
            if (!ptrActive) return;
            ptrActive = false;
            const h = parseFloat(ptrSpacer.style.height) || 0;
            if (h >= 45) {
                // Trigger refresh ‚Äî open spacer fully, Jane spins in the gap
                ptrRefreshing = true;
                ptrSpacer.style.transition = 'height 0.3s cubic-bezier(0.2,0,0,1)';
                ptrSpacer.classList.add('open');
                ptrIcon.style.opacity = '1';
                ptrIcon.style.transform = 'scale(1)';
                ptrIcon.classList.add('loading');
                Promise.all([refreshStatus(), refreshMind(), refreshTicker(), refreshXStats(), refreshTweetFeed(), refreshSorare()]).then(() => {
                    // Data loaded ‚Äî hold 400ms, then close
                    setTimeout(() => {
                        ptrIcon.classList.remove('loading');
                        ptrSpacer.classList.remove('open');
                        ptrSpacer.style.height = '';
                        setTimeout(() => {
                            ptrIcon.style.opacity = '';
                            ptrIcon.style.transform = '';
                            ptrSpacer.style.transition = '';
                            ptrRefreshing = false;
                        }, 400);
                    }, 400);
                });
            } else {
                // Cancel ‚Äî snap closed
                ptrSpacer.style.transition = 'height 0.25s ease';
                ptrSpacer.style.height = '0';
                ptrIcon.style.opacity = '0';
                ptrIcon.style.transform = 'scale(0.5)';
                setTimeout(() => {
                    ptrSpacer.style.transition = '';
                    ptrIcon.style.transform = '';
                }, 250);
            }
        });
    </script>

    <!-- WhatsApp FAB -->
    <a href="https://wa.me/17175759384" id="wa-fab" style="
        position: fixed;
        bottom: 1.2rem;
        right: 1.2rem;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: rgba(74,222,128,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 12px rgba(74,222,128,0.35);
        z-index: 1000;
        text-decoration: none;
        transition: transform 0.2s, box-shadow 0.2s;
    " ontouchstart="this.style.transform='scale(0.92)'" ontouchend="this.style.transform=''">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="white" stroke="none">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.2L4 17.2V4h16v12z"/>
            <circle cx="8" cy="10" r="1.2"/>
            <circle cx="12" cy="10" r="1.2"/>
            <circle cx="16" cy="10" r="1.2"/>
        </svg>
    </a>
<script>
// Cron schedule widget ‚Äî redesigned HUD style
var cronExpanded=false, cronPage=0, cronTouchX=null;
function toggleCronWidget(e){
    if(e&&e.target.closest('#cron-pages'))return; // don't toggle when swiping
    cronExpanded=!cronExpanded;
    const exp=document.getElementById('cron-expanded');
    const chev=document.getElementById('cron-chevron');
    const hint=document.getElementById('cron-hint');
    if(cronExpanded){
        const list=document.getElementById('cron-list');
        const maxH=Math.max(list.scrollHeight,300)+60;
        exp.style.maxHeight=maxH+'px';
        chev.style.transform='rotate(180deg)';
        hint.textContent='tap to collapse';
    } else {
        exp.style.maxHeight='0';
        chev.style.transform='';
        hint.textContent='tap to expand';
    }
}
function cronGoPage(p){}
function cronTouchStart(e){}
function cronTouchMove(e){}
function cronTouchEnd(e){
    const dx=e.changedTouches[0].clientX-cronTouchX;
    cronTouchX=null;
    if(Math.abs(dx)<30)return;
    if(dx<0&&cronPage<1)cronGoPage(1);
    if(dx>0&&cronPage>0)cronGoPage(0);
}
function buildGantt(data){return; // Gantt chart removed
    const now=new Date(), nowH=now.getHours()+now.getMinutes()/60;
    const typeColors={
        thread:{bg:'#4ade80',text:'#0a2e14',label:'Thread Posts'},
        replies:{bg:'#38bdf8',text:'#0c2d4a',label:'Replies'},
        data:{bg:'#a78bfa',text:'#1e1245',label:'Data / Analytics'},
        ops:{bg:'#fb923c',text:'#3d1f00',label:'Ops (Sorare, etc)'}
    };
    // Parse jobs
    const bars=[];
    data.groups.forEach(g=>{
        g.jobs.forEach(j=>{
            const typ=typeColors[j.type]||typeColors.data;
            const times=j.time.split(',').map(s=>s.trim());
            let hasTimed=false;
            times.forEach(t=>{
                const m=t.match(/^(\d{1,2})(?::(\d{2}))?\s*(AM|PM)$/i);
                if(!m)return;
                let hr=parseInt(m[1]),mi=parseInt(m[2]||'0');
                if(m[3].toUpperCase()==='PM'&&hr!==12)hr+=12;
                if(m[3].toUpperCase()==='AM'&&hr===12)hr=0;
                hasTimed=true;
                bars.push({name:j.name,start:hr+mi/60,dur:0.5,done:j.done,cat:typ,time:t,group:g.label,
                    threadNum:j.threadNum||null,tweets:j.tweets||null,count:j.count||null,type:j.type});
            });
        });
    });
    bars.sort((a,b)=>a.start-b.start);

    // Filter to visible window only
    const winStart=Math.max(0,Math.floor(nowH)), winEnd=Math.min(24,winStart+6);
    const visibleBars=bars.filter(b=>b.start+b.dur>winStart&&b.start<winEnd);

    // Rolling 6-hour window from now
    const tStart=Math.max(0,Math.floor(nowH)), tEnd=Math.min(24,tStart+6), tRange=tEnd-tStart;
    const rowH=38, rowGap=6, headerH=24;
    const el=document.getElementById('cron-gantt');

    let html='<div style="position:relative;font-family:-apple-system,BlinkMacSystemFont,sans-serif;">';

    // Title
    html+='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.4rem;">';
    html+='<span style="font-size:10px;font-weight:700;color:rgba(255,255,255,0.7);text-transform:uppercase;letter-spacing:0.8px;">Next 6 Hours</span>';
    const fmtTime=(h)=>{const hr=h%12||12;const ap=h>=12?'PM':'AM';return hr+' '+ap;};
    html+=`<span style="font-size:8px;color:rgba(255,255,255,0.3);">${fmtTime(tStart)} ‚Äì ${fmtTime(tEnd)} ¬∑ ${visibleBars.length} jobs</span>`;
    html+='</div>';

    // Legend
    html+='<div style="display:flex;gap:0.6rem;margin-bottom:0.5rem;flex-wrap:wrap;">';
    Object.values(typeColors).forEach(c=>{
        html+=`<div style="display:flex;align-items:center;gap:3px;">`;
        html+=`<div style="width:8px;height:8px;border-radius:2px;background:${c.bg};opacity:0.8;"></div>`;
        html+=`<span style="font-size:7px;color:rgba(255,255,255,0.4);font-weight:500;">${c.label}</span>`;
        html+=`</div>`;
    });
    html+='</div>';

    // Chart area
    html+=`<div style="position:relative;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:6px;padding:0.3rem 0.4rem 0.4rem;">`;

    // Time axis header
    html+='<div style="position:relative;height:'+headerH+'px;margin-bottom:4px;border-bottom:1px solid rgba(255,255,255,0.06);">';
    for(let t=tStart;t<=tEnd;t+=1){
        const pct=((t-tStart)/tRange)*100;
        const label=t===0?'12A':t===12?'12P':t===24?'12A':t>12?(t-12)+'P':t+'A';
        html+=`<span style="position:absolute;left:${pct}%;transform:translateX(-50%);top:2px;font-size:9px;font-weight:700;color:rgba(255,255,255,0.5);">${label}</span>`;
        html+=`<div style="position:absolute;left:${pct}%;bottom:0;width:1px;height:6px;background:rgba(255,255,255,0.12);"></div>`;
    }
    html+='</div>';

    // Grid lines
    const trackH=visibleBars.length*(rowH+rowGap);
    html+=`<div style="position:relative;height:${Math.max(trackH,120)}px;">`;
    for(let t=tStart;t<=tEnd;t+=1){
        const pct=((t-tStart)/tRange)*100;
        html+=`<div style="position:absolute;left:${pct}%;top:0;height:100%;width:1px;background:rgba(255,255,255,0.04);"></div>`;
    }

    // Now indicator
    if(nowH>=tStart&&nowH<=tEnd){
        const nowPct=((nowH-tStart)/tRange)*100;
        html+=`<div style="position:absolute;left:${nowPct}%;top:-${headerH+4}px;bottom:-4px;width:1.5px;background:linear-gradient(180deg,var(--accent),rgba(74,222,128,0.1));z-index:5;"></div>`;
        html+=`<div style="position:absolute;left:${nowPct}%;top:-${headerH+8}px;transform:translateX(-50%);z-index:6;">`;
        html+=`<div style="background:var(--accent);color:#000;font-size:6px;font-weight:800;padding:1px 4px;border-radius:3px;white-space:nowrap;">NOW</div>`;
        html+=`</div>`;
    }

    // No jobs message
    if(visibleBars.length===0){
        html+=`<div style="display:flex;align-items:center;justify-content:center;height:120px;color:rgba(255,255,255,0.25);font-size:11px;">No scheduled jobs in this window</div>`;
    }
    // Bars with row labels
    visibleBars.forEach((b,i)=>{
        const top=i*(rowH+rowGap);
        const left=Math.max(0,((b.start-tStart)/tRange)*100);
        const width=Math.max(12,(b.dur/tRange)*100);
        const isPast=b.start+b.dur<nowH;
        const isActive=b.start<=nowH&&b.start+b.dur>nowH;
        const isFuture=b.start>nowH;
        let barBg=b.cat.bg;
        let barOpacity=isFuture?0.7:isActive?1:0.25;
        if(b.done){barOpacity=0.2;}
        const glow=isActive?`box-shadow:0 0 8px ${b.cat.bg}40, 0 1px 3px rgba(0,0,0,0.3);`:'box-shadow:0 1px 2px rgba(0,0,0,0.2);';
        const stripeStyle=b.done?`background-image:repeating-linear-gradient(45deg,transparent,transparent 3px,rgba(0,0,0,0.1) 3px,rgba(0,0,0,0.1) 6px);`:'';

        // Bar
        html+=`<div class="gantt-bar" data-name="${b.name}" data-time="${b.time}" data-cat="${b.cat.label}" data-done="${b.done}" data-type="${b.type||''}" data-threadnum="${b.threadNum||''}" data-tweets="${b.tweets||''}" data-count="${b.count||''}" `;
        html+=`style="position:absolute;left:${left}%;top:${top+2}px;width:${width}%;height:${rowH-4}px;`;
        html+=`background:${barBg};opacity:${barOpacity};border-radius:5px;${glow}${stripeStyle}`;
        html+=`cursor:pointer;display:flex;align-items:center;padding:0 8px;overflow:hidden;transition:all 0.2s ease;z-index:3;" `;
        html+=`onclick="event.stopPropagation();showGanttTooltip(this,event)">`;

        // Bar content
        const textColor=b.cat.text;
        let barLabel=b.name;
        if(b.type==='thread'&&b.threadNum) barLabel=`#${b.threadNum} ${b.name}`;
        if(b.type==='replies'&&b.count) barLabel=`${b.name} √ó${b.count}`;
        html+=`<span style="font-size:9px;color:${textColor};font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">`;
        if(b.done)html+='‚úì ';
        if(isActive)html+='‚ñ∏ ';
        html+=`${barLabel}</span>`;
        if(b.type==='thread'&&b.tweets){
            html+=`<span style="margin-left:auto;font-size:7px;color:${textColor};opacity:0.8;font-weight:800;flex-shrink:0;padding-left:4px;background:rgba(0,0,0,0.15);padding:1px 4px;border-radius:3px;">${b.tweets}tw</span>`;
        }
        html+=`</div>`;
    });

    html+='</div>'; // end track
    html+='</div>'; // end chart area

    // Summary bar
    const done=visibleBars.filter(b=>b.done).length;
    const active=visibleBars.filter(b=>{return b.start<=nowH&&b.start+b.dur>nowH&&!b.done;}).length;
    const upcoming=visibleBars.filter(b=>b.start>nowH&&!b.done).length;
    html+='<div style="display:flex;justify-content:space-between;margin-top:0.4rem;padding:0.25rem 0.4rem;background:rgba(255,255,255,0.03);border-radius:4px;font-size:8px;">';
    html+=`<span style="color:rgba(255,255,255,0.3);">‚úì ${done} done</span>`;
    html+=`<span style="color:var(--accent);font-weight:600;">${active>0?'‚ñ∏ '+active+' active':'‚Äî'}</span>`;
    html+=`<span style="color:rgba(255,255,255,0.3);">${upcoming} upcoming</span>`;
    html+='</div>';

    html+='</div>'; // end wrapper

    // Tooltip container
    html+='<div id="gantt-tooltip" style="display:none;position:fixed;z-index:999;background:rgba(20,20,30,0.95);border:1px solid rgba(74,222,128,0.3);border-radius:8px;padding:0.5rem 0.6rem;backdrop-filter:blur(8px);box-shadow:0 4px 20px rgba(0,0,0,0.5);max-width:200px;pointer-events:none;"></div>';

    el.innerHTML=html;
}
function showGanttTooltip(bar,e){
    const tip=document.getElementById('gantt-tooltip');
    const name=bar.dataset.name, time=bar.dataset.time, cat=bar.dataset.cat, done=bar.dataset.done==='true';
    const statusIcon=done?'‚úÖ Complete':'üîÑ Scheduled';
    const typ=bar.dataset.type||'';
    const threadNum=bar.dataset.threadnum||'';
    const tweets=bar.dataset.tweets||'';
    const count=bar.dataset.count||'';
    let detail='';
    if(typ==='thread'&&threadNum) detail=`<div style="font-size:8px;color:rgba(255,255,255,0.5);">üìù Thread #${threadNum} ¬∑ ${tweets} tweets</div>`;
    if(typ==='replies'&&count) detail=`<div style="font-size:8px;color:rgba(255,255,255,0.5);">üí¨ ${count} replies this batch</div>`;
    tip.innerHTML=`
        <div style="font-size:10px;font-weight:700;color:var(--accent);margin-bottom:3px;">${name}</div>
        <div style="font-size:8px;color:rgba(255,255,255,0.5);margin-bottom:2px;">‚è∞ ${time} ¬∑ ${cat}</div>
        ${detail}
        <div style="font-size:8px;color:rgba(255,255,255,0.6);">${statusIcon}</div>
    `;
    tip.style.display='block';
    const rect=bar.getBoundingClientRect();
    tip.style.left=Math.min(rect.left,window.innerWidth-210)+'px';
    tip.style.top=(rect.top-tip.offsetHeight-8)+'px';
    if(parseInt(tip.style.top)<0)tip.style.top=(rect.bottom+8)+'px';
    setTimeout(()=>{tip.style.display='none';},2500);
}
// Cron schedule rendering + auto-refresh
function renderCronSchedule(d){
    const groupColors={'üåÖ Morning':'#4ade80','‚òÄÔ∏è Midday':'#4ade80','üåô Evening':'#4ade80','üîÑ Recurring':'#4ade80'};
    let total=0, doneCount=0, nextJob=null;
    const now=new Date();
    d.groups.forEach(g=>{
        g.jobs.forEach(j=>{
            if(g.label !== 'üîÑ Recurring') { total++; if(j.done) doneCount++; }
            if(!j.done && !nextJob){
                const m=j.time.match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i);
                if(m){let h=parseInt(m[1]),mi=parseInt(m[2]);if(m[3].toUpperCase()==='PM'&&h!==12)h+=12;if(m[3].toUpperCase()==='AM'&&h===12)h=0;
                    const t=new Date(now);t.setHours(h,mi,0,0);if(t>now)nextJob=j;}
            }
        });
    });
    document.getElementById('cron-count').textContent=doneCount+'/'+total;
    const el=document.getElementById('cron-list');
    let h='';
    d.groups.forEach(g=>{
        const c=groupColors[g.label]||'#888';
        h+=`<div style="margin-top:0.35rem;margin-bottom:0.15rem;"><span style="color:${c};font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;">${g.label}</span></div>`;
        g.jobs.forEach(j=>{
            const isDone=j.done;
            const isNext=(!isDone && nextJob && j.name===nextJob.name && j.time===nextJob.time);
            const bg=isNext?'rgba(74,222,128,0.08)':'transparent';
            const border=isNext?'border-left:2px solid #4ade80;padding-left:0.4rem;':'padding-left:0.5rem;';
            const nameStyle=isDone?'text-decoration:line-through;color:rgba(255,255,255,0.25);':'color:rgba(255,255,255,0.7);';
            const timeStyle=isDone?'color:rgba(255,255,255,0.15);':'color:rgba(255,255,255,0.6);';
            const icon=isDone?'‚úÖ':'';
            const nextBadge=isNext?'<span style="font-size:7px;background:rgba(74,222,128,0.2);color:#4ade80;padding:0.05rem 0.25rem;border-radius:3px;font-weight:600;margin-left:0.3rem;">NEXT</span>':'';
            h+=`<div style="display:flex;align-items:center;gap:0.3rem;font-size:10px;padding:0.12rem 0;${border}background:${bg};border-radius:2px;">`;
            h+=`<span style="${timeStyle}font-size:9px;min-width:52px;">${j.time}</span>`;
            h+=`<span style="${nameStyle}">${isDone?icon+' ':''}${j.name}${nextBadge}</span>`;
            h+=`</div>`;
        });
    });
    el.innerHTML=h;
    buildGantt(d);
    window._lastCronData=d;
}
function fetchCronSchedule(){
    fetch('cron-schedule.json?_='+Date.now()).then(r=>r.json()).then(renderCronSchedule).catch(()=>{document.getElementById('cron-count').textContent='!';});
}
fetchCronSchedule();
// Poll every 60s + WebSocket push for instant updates
setInterval(()=>{ if(!document.hidden) fetchCronSchedule(); }, 60000);
document.addEventListener('visibilitychange',()=>{ if(!document.hidden) fetchCronSchedule(); });
// WebSocket cron-schedule updates handled via batch handler in main WS setup above
// Gantt NOW-line refresh every 60s
(function(){
    function tick(){ if(!document.hidden && window._lastCronData) buildGantt(window._lastCronData); }
    setInterval(tick,60000);
})();
</script>
</body>
</html>